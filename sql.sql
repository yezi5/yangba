/*
SQLyog Enterprise v12.09 (64 bit)
MySQL - 5.5.40 : Database - guli
*********************************************************************
*/

/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`guli` /*!40100 DEFAULT CHARACTER SET utf8 */;

USE `guli`;

/*Table structure for table `acl_user` */

DROP TABLE IF EXISTS `acl_user`;

CREATE TABLE `acl_user` (
  `user_id` varchar(255) NOT NULL COMMENT '用户主键',
  `username` varchar(255) NOT NULL COMMENT '用户名',
  `pass_word` varchar(255) NOT NULL COMMENT '用户密码',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像',
  `sex` int(2) DEFAULT NULL COMMENT '性别',
  `address` varchar(255) DEFAULT NULL COMMENT '住址',
  `qq` varchar(255) DEFAULT NULL COMMENT 'QQ',
  `phone` varchar(255) DEFAULT NULL COMMENT '手机号',
  `email` varchar(255) DEFAULT NULL COMMENT '邮箱',
  `gmt_create` datetime DEFAULT NULL COMMENT '创建时间',
  `gmt_modified` datetime DEFAULT NULL COMMENT '修改时间',
  PRIMARY KEY (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

/*Data for the table `acl_user` */

insert  into `acl_user`(`user_id`,`username`,`pass_word`,`avatar`,`sex`,`address`,`qq`,`phone`,`email`,`gmt_create`,`gmt_modified`) values ('0cc70bb29e0541a7a2a261404e7adec5','admin','0f3fbdcfc57d38b5c31cd32c58db8b48','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',1,'河南省郑州市','294187139','19384721458','294187139@qq.com','2020-12-30 11:11:11','2020-12-30 11:11:11');

/*Table structure for table `blog_comment` */

DROP TABLE IF EXISTS `blog_comment`;

CREATE TABLE `blog_comment` (
  `id` varchar(255) NOT NULL DEFAULT '' COMMENT '主键',
  `blog_id` varchar(255) NOT NULL COMMENT '博客主键',
  `common_parent_id` varchar(255) DEFAULT '0' COMMENT '被回复评论id',
  `user_id` varchar(255) DEFAULT NULL COMMENT '用户id',
  `avatar` varchar(255) DEFAULT NULL COMMENT '用户头像',
  `username` varchar(255) DEFAULT NULL COMMENT '用户名',
  `context` varchar(500) DEFAULT NULL COMMENT '评论内容',
  `like_count` bigint(10) unsigned DEFAULT '0' COMMENT '点赞人数',
  `averse_count` bigint(10) unsigned DEFAULT '0' COMMENT '点踩人数',
  `gmt_create` datetime DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='博客评论';

/*Data for the table `blog_comment` */

insert  into `blog_comment`(`id`,`blog_id`,`common_parent_id`,`user_id`,`avatar`,`username`,`context`,`like_count`,`averse_count`,`gmt_create`) values ('13214xvsgte54342123','1376528283254898689','1385158360095965186','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','二级子评论',1,0,'2021-04-22 18:20:11'),('1381582933943259137','1376528283254898689','0','1340183806198362113','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','叶子',NULL,0,0,'2021-04-12 20:37:08'),('1381583904308072450','1376528283254898689','0','1340183806198362113','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','叶子',NULL,0,0,'2021-04-12 20:37:12'),('1381584730745389058','1376528283254898689','0','1340183806198362113','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','叶子',NULL,0,0,'2021-04-12 20:37:19'),('1381588297082384385','1376528283254898689','1381582933943259137','1340183806198362113','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','叶子',NULL,0,0,'2021-04-12 20:41:33'),('1381599693526478850','1376528283254898689','0','1340183806198362113','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','叶子',NULL,0,0,'2021-04-12 21:26:50'),('1381600331605946370','1376528283254898689','0','1340183806198362113','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','叶子',NULL,0,0,'2021-04-12 21:29:22'),('1381602095054864385','1376528283254898689','0','1340183806198362113','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','叶子','敖德萨多',0,0,'2021-04-12 21:36:23'),('1382671469849255938','1376528283254898689','0','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','1111111',0,0,'2021-04-15 20:25:41'),('1382672818330574849','1376528283254898689','0','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','111111',0,0,'2021-04-15 20:31:03'),('1385158360095965186','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','11111',0,0,'2021-04-22 17:07:42'),('1385158424071684098','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','21132',0,0,'2021-04-22 17:07:57'),('1385159052483280898','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','4323',0,0,'2021-04-22 17:10:27'),('1385163160430809089','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','其味无穷',0,0,'2021-04-22 17:26:47'),('1385164470601355266','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','颠三倒四',0,0,'2021-04-22 17:31:59'),('1385165838766542850','1376528283254898689','1381583904308072450','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','21343',0,0,'2021-04-22 17:37:25'),('1385165940105121793','1376528283254898689','1381583904308072450','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','21343',0,0,'2021-04-22 17:37:49'),('1385166412266311682','1376528283254898689','1381583904308072450','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','萨达',0,0,'2021-04-22 17:39:42'),('1385167394358398978','1376528283254898689','1381583904308072450','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','萨达安抚',0,0,'2021-04-22 17:43:36'),('1385167743345463297','1376528283254898689','1381583904308072450','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','111111',0,0,'2021-04-22 17:44:59'),('1385168747570892801','1376528283254898689','1381584730745389058','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','3424',0,0,'2021-04-22 17:48:59'),('1385168794710675457','1376528283254898689','1381584730745389058','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','3424555',0,0,'2021-04-22 17:49:10'),('1385169485642567682','1376528283254898689','1381599693526478850','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','王企鹅',0,0,'2021-04-22 17:51:55'),('1385169809585442817','1376528283254898689','1381599693526478850','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','V型从去',0,0,'2021-04-22 17:53:12'),('1385172501472972802','1376528283254898689','1381599693526478850','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','affect',0,0,'2021-04-22 18:03:54'),('1385173539051507714','1376528283254898689','1381599693526478850','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','ZCZ·',0,0,'2021-04-22 18:08:01'),('1385173717485588481','1376528283254898689','1381599693526478850','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','ZCZ·11',0,0,'2021-04-22 18:08:44'),('1385175625906475010','1376528283254898689','1381584730745389058','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','但是广东省',0,0,'2021-04-22 18:16:19'),('1385184833775292417','1376528283254898689','1381599693526478850','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','的确1',0,0,'2021-04-22 18:52:54'),('1385184943993212929','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','3224242',0,0,'2021-04-22 18:53:20'),('1385185167671250945','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','阿达',0,0,'2021-04-22 18:54:14'),('1385185899262726146','1376528283254898689','1381582933943259137','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','第三方',0,0,'2021-04-22 18:57:08'),('1385186052501622785','1376528283254898689','1381599693526478850','1369634113126825985','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','the star','发范德萨',0,0,'2021-04-22 18:57:45'),('24332541325sdfa','1376528283254898689','0','1328626229761146881','https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg','冰蓝','你好啊',1,0,'2021-04-08 20:23:09');

/*Table structure for table `course_comment` */

DROP TABLE IF EXISTS `course_comment`;

CREATE TABLE `course_comment` (
  `id` varchar(255) NOT NULL DEFAULT '' COMMENT '主键',
  `course_id` varchar(255) NOT NULL COMMENT '课程主键',
  `common_parent_id` varchar(255) DEFAULT '0' COMMENT '被回复评论id',
  `user_id` varchar(255) DEFAULT NULL COMMENT '用户id',
  `avatar` varchar(255) DEFAULT NULL COMMENT '用户头像',
  `username` varchar(255) DEFAULT NULL COMMENT '用户名',
  `context` varchar(500) DEFAULT NULL COMMENT '评论内容',
  `like_count` bigint(10) unsigned DEFAULT '0' COMMENT '点赞人数',
  `averse_count` bigint(10) unsigned DEFAULT '0' COMMENT '点踩人数',
  `gmt_create` datetime DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='课程评论';

/*Data for the table `course_comment` */

/*Table structure for table `course_view_count` */

DROP TABLE IF EXISTS `course_view_count`;

CREATE TABLE `course_view_count` (
  `id` varchar(255) NOT NULL COMMENT '主键',
  `course_id` varchar(255) DEFAULT NULL COMMENT '课程id',
  `view_count` mediumtext COMMENT '浏览量',
  PRIMARY KEY (`id`),
  UNIQUE KEY `course_view_count_id_uindex` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='课程访问量';

/*Data for the table `course_view_count` */

insert  into `course_view_count`(`id`,`course_id`,`view_count`) values ('1378925447453016065','1315616768420605954','3'),('1378925447977304066','1314919286954803202','5'),('1378925448119910401','1314921747421630466','3'),('1378925448245739521','1192252213659774977','144'),('1378925448379957250','1314831776845168641','23'),('1378925448480620546','1314918891247386626','9'),('1378925448572895234','1315615202082942978','7');

/*Table structure for table `crm_banner` */

DROP TABLE IF EXISTS `crm_banner`;

CREATE TABLE `crm_banner` (
  `id` char(19) NOT NULL DEFAULT '' COMMENT 'ID',
  `title` varchar(20) DEFAULT '' COMMENT '标题',
  `image_url` varchar(500) NOT NULL DEFAULT '' COMMENT '图片地址',
  `link_url` varchar(500) DEFAULT '' COMMENT '链接地址',
  `sort` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '排序',
  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_name` (`title`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='首页banner表';

/*Data for the table `crm_banner` */

insert  into `crm_banner`(`id`,`title`,`image_url`,`link_url`,`sort`,`is_deleted`,`gmt_create`,`gmt_modified`) values ('1194556896025845762','test1','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/banner/JAVA%20%281%29.jpg','/course/1192252213659774977',1,0,'2019-11-13 18:05:32','2019-11-18 10:28:22'),('1194607458461216213','test3','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/banner/08151348649%20%281%29.png','#',3,0,'2021-03-28 16:15:42','2021-03-28 16:15:46'),('1194607458461216769','test2','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/banner/banner-1%20%281%29.jpg','#',2,0,'2019-11-13 21:26:27','2019-11-14 09:12:15');

/*Table structure for table `edu_blog` */

DROP TABLE IF EXISTS `edu_blog`;

CREATE TABLE `edu_blog` (
  `blog_id` varchar(255) NOT NULL COMMENT '博客主键',
  `blog_member_id` varchar(255) DEFAULT NULL COMMENT '用户主键',
  `title` varchar(255) DEFAULT NULL COMMENT '文章标题',
  `context_mk` mediumtext COMMENT '文章内容(markdown语法)',
  `context_html` mediumtext COMMENT '文章内容（html格式）',
  `blog_view` bigint(20) DEFAULT '0' COMMENT '浏览数',
  `blog_star` bigint(20) DEFAULT '0' COMMENT '收藏数',
  `gmt_create` datetime DEFAULT NULL COMMENT '创建时间',
  `gmt_modified` datetime DEFAULT NULL COMMENT '修改时间',
  `blog_like` bigint(20) DEFAULT '0' COMMENT '点赞数',
  PRIMARY KEY (`blog_id`),
  UNIQUE KEY `edu_blog_blog_id_uindex` (`blog_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='博客';

/*Data for the table `edu_blog` */

insert  into `edu_blog`(`blog_id`,`blog_member_id`,`title`,`context_mk`,`context_html`,`blog_view`,`blog_star`,`gmt_create`,`gmt_modified`,`blog_like`) values ('1374959393844465665','1369634113126825985','JavaSE基础课程','::: hljs-center\n\n# 一级标题 \n\n:::\n双腿瘫痪后，我的脾气变得暴怒无常。望着望着天上北归的雁阵，我会突然把面前的玻璃砸碎；听着听着李谷一甜美的歌声，我会猛地把手边的东西摔向四周的墙壁。母亲就悄悄地躲出去，在我看不见的地方偷偷地听着我的动静。当一切恢复沉寂，她又悄悄地进来，眼边红红的，看着我。“听说北海的花儿都开了，我推着你去走走。”她总是这么说。母亲喜欢花，可自从我的腿瘫痪后，她侍弄的那些花都死了。“不，我不去！”我狠命地>```\n\n捶打这两条可恨的腿，喊着：“我活着有什么劲！”母亲扑过来抓住我的手，忍住哭声说：“咱娘儿俩在一块儿，好好儿活，好好儿活……”可我却一直都不知道，她的病已经到了那步田地。后来妹妹告诉我，她常常肝疼得整宿整宿翻来覆去地睡不了觉。\n::: hljs-center\n\n## 二级标题\n\n:::\n那天*我又独自坐在屋里，看着窗外的树叶*“唰唰拉拉”地飘落。母亲进来了，挡在窗前：“北海的菊花开了，我推着你去看看吧。”她憔悴的脸上现出央求般的神色。“什么**时候？”“你要是愿意，就**明天。”她说。我的回答已经让她喜出望外了。“好吧，就明天。”我说。她高兴得一会坐下，一会站起：“那就赶紧准备准备。”“唉呀，烦不烦？几步路，有什么好准备的！”她也笑了，坐在我**身边，絮絮叨叨地说着：“看完菊花**，咱们就去‘仿膳’，你小时候最爱吃那儿的豌豆黄儿。还记得那回我带你去北海吗？你偏说那杨树花是毛毛虫，跑着，一脚踩扁一个……”她忽然不说了。对于“跑”和“踩”一类的字眼儿。她比我还敏感。她又悄悄地出去了。\n|column1|column2|column3|\n|-|-|-|\n|content1|content2|content3|\n```\npublic class Demo8 {\n    public static void main(String[] args) {\n        int[] arr={10,20,5,60,100};\n        int max=arr[0];\n        for (int i = 1; i < arr.length; i++) {\n            if (arr[i]>max){\n                max=arr[i];\n            }\n        }\n        System.out.println(max);\n    }\n}\n\n```\nsdsadsadsadsadasd\n\n\n\n\n\n\n\n\n','&lt;div class=&quot;hljs-center&quot;&gt;\n&lt;h1&gt;&lt;a id=&quot;_2&quot;&gt;&lt;/a&gt;一级标题&lt;/h1&gt;\n&lt;/div&gt;\n&lt;p&gt;双腿瘫痪后，我的脾气变得暴怒无常。望着望着天上北归的雁阵，我会突然把面前的玻璃砸碎；听着听着李谷一甜美的歌声，我会猛地把手边的东西摔向四周的墙壁。母亲就悄悄地躲出去，在我看不见的地方偷偷地听着我的动静。当一切恢复沉寂，她又悄悄地进来，眼边红红的，看着我。&ldquo;听说北海的花儿都开了，我推着你去走走。&rdquo;她总是这么说。母亲喜欢花，可自从我的腿瘫痪后，她侍弄的那些花都死了。&ldquo;不，我不去！&rdquo;我狠命地&amp;gt;```&lt;/p&gt;\n&lt;p&gt;捶打这两条可恨的腿，喊着：&ldquo;我活着有什么劲！&rdquo;母亲扑过来抓住我的手，忍住哭声说：&ldquo;咱娘儿俩在一块儿，好好儿活，好好儿活&hellip;&hellip;&rdquo;可我却一直都不知道，她的病已经到了那步田地。后来妹妹告诉我，她常常肝疼得整宿整宿翻来覆去地睡不了觉。&lt;/p&gt;\n&lt;div class=&quot;hljs-center&quot;&gt;\n&lt;h2&gt;&lt;a id=&quot;_10&quot;&gt;&lt;/a&gt;二级标题&lt;/h2&gt;\n&lt;/div&gt;\n&lt;p&gt;那天&lt;em&gt;我又独自坐在屋里，看着窗外的树叶&lt;/em&gt;&ldquo;唰唰拉拉&rdquo;地飘落。母亲进来了，挡在窗前：&ldquo;北海的菊花开了，我推着你去看看吧。&rdquo;她憔悴的脸上现出央求般的神色。&ldquo;什么&lt;strong&gt;时候？&rdquo;&ldquo;你要是愿意，就&lt;/strong&gt;明天。&rdquo;她说。我的回答已经让她喜出望外了。&ldquo;好吧，就明天。&rdquo;我说。她高兴得一会坐下，一会站起：&ldquo;那就赶紧准备准备。&rdquo;&ldquo;唉呀，烦不烦？几步路，有什么好准备的！&rdquo;她也笑了，坐在我&lt;strong&gt;身边，絮絮叨叨地说着：&ldquo;看完菊花&lt;/strong&gt;，咱们就去&lsquo;仿膳&rsquo;，你小时候最爱吃那儿的豌豆黄儿。还记得那回我带你去北海吗？你偏说那杨树花是毛毛虫，跑着，一脚踩扁一个&hellip;&hellip;&rdquo;她忽然不说了。对于&ldquo;跑&rdquo;和&ldquo;踩&rdquo;一类的字眼儿。她比我还敏感。她又悄悄地出去了。&lt;/p&gt;\n&lt;table&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th&gt;column1&lt;/th&gt;\n&lt;th&gt;column2&lt;/th&gt;\n&lt;th&gt;column3&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td&gt;content1&lt;/td&gt;\n&lt;td&gt;content2&lt;/td&gt;\n&lt;td&gt;content3&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n&lt;pre&gt;&lt;code class=&quot;lang-&quot;&gt;public class Demo8 {\n    public static void main(String[] args) {\n        int[] arr={10,20,5,60,100};\n        int max=arr[0];\n        for (int i = 1; i &amp;lt; arr.length; i++) {\n            if (arr[i]&amp;gt;max){\n                max=arr[i];\n            }\n        }\n        System.out.println(max);\n    }\n}\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;sdsadsadsadsadasd&lt;/p&gt;\n',0,0,'2021-03-25 13:40:39','2021-03-25 13:40:39',0),('1376527139761799169','1369634113126825985','Windows下nginx部分问题解决','# Windows下nginx部分问题解决\n\n## 1. 重载配置无法生效\n\n产生原因：nginx进程没有彻底杀死。\n\n杀死所有nginx进程的命令：\n\n````bash\ntaskkill /f /t /im nginx.exe\n````\n\n## 2. SpringBoot项目整合swagger后，nginx无法代理swagger\n\n产生原因：访问swagger文档不止访问了==swagger-ui==这一个路径，简单的配置会导致swagger的资源访问被拦截。\n\n解决方案：添加如下配置：\n\n````xml\nlocation ~* ^(/v3|/webjars|/swagger-resources|/swagger-ui.html) {\n		    proxy_pass 代理url;\n		}\n````\n\n注意：==v3==是swagger的版本号，如果你用的是Swagger2，那就改成==v2==','&lt;h1&gt;&lt;a id=&quot;Windowsnginx_0&quot;&gt;&lt;/a&gt;Windows下nginx部分问题解决&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;1__2&quot;&gt;&lt;/a&gt;1. 重载配置无法生效&lt;/h2&gt;\n&lt;p&gt;产生原因：nginx进程没有彻底杀死。&lt;/p&gt;\n&lt;p&gt;杀死所有nginx进程的命令：&lt;/p&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-bash&quot;&gt;taskkill /f /t /im nginx.exe\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;2_SpringBootswaggernginxswagger_12&quot;&gt;&lt;/a&gt;2. SpringBoot项目整合swagger后，nginx无法代理swagger&lt;/h2&gt;\n&lt;p&gt;产生原因：访问swagger文档不止访问了&lt;mark&gt;swagger-ui&lt;/mark&gt;这一个路径，简单的配置会导致swagger的资源访问被拦截。&lt;/p&gt;\n&lt;p&gt;解决方案：添加如下配置：&lt;/p&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-xml&quot;&gt;location ~* ^(/v3|/webjars|/swagger-resources|/swagger-ui.html) {\n		    proxy_pass 代理url;\n		}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;注意：&lt;mark&gt;v3&lt;/mark&gt;是swagger的版本号，如果你用的是Swagger2，那就改成&lt;mark&gt;v2&lt;/mark&gt;&lt;/p&gt;\n',0,0,'2021-03-29 21:30:19','2021-03-29 21:30:19',0),('1376527530645766145','1369634113126825985','Windows下nginx部分问题解决','# Windows下nginx部分问题解决\n\n## 1. 重载配置无法生效\n\n产生原因：nginx进程没有彻底杀死。\n\n杀死所有nginx进程的命令：\n\n````bash\ntaskkill /f /t /im nginx.exe\n````\n\n## 2. SpringBoot项目整合swagger后，nginx无法代理swagger\n\n产生原因：访问swagger文档不止访问了==swagger-ui==这一个路径，简单的配置会导致swagger的资源访问被拦截。\n\n解决方案：添加如下配置：\n\n````xml\nlocation ~* ^(/v3|/webjars|/swagger-resources|/swagger-ui.html) {\n		    proxy_pass 代理url;\n		}\n````\n\n注意：==v3==是swagger的版本号，如果你用的是Swagger2，那就改成==v2==','&lt;h1&gt;&lt;a id=&quot;Windowsnginx_0&quot;&gt;&lt;/a&gt;Windows下nginx部分问题解决&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;1__2&quot;&gt;&lt;/a&gt;1. 重载配置无法生效&lt;/h2&gt;\n&lt;p&gt;产生原因：nginx进程没有彻底杀死。&lt;/p&gt;\n&lt;p&gt;杀死所有nginx进程的命令：&lt;/p&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-bash&quot;&gt;taskkill /f /t /im nginx.exe\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;2_SpringBootswaggernginxswagger_12&quot;&gt;&lt;/a&gt;2. SpringBoot项目整合swagger后，nginx无法代理swagger&lt;/h2&gt;\n&lt;p&gt;产生原因：访问swagger文档不止访问了&lt;mark&gt;swagger-ui&lt;/mark&gt;这一个路径，简单的配置会导致swagger的资源访问被拦截。&lt;/p&gt;\n&lt;p&gt;解决方案：添加如下配置：&lt;/p&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-xml&quot;&gt;location ~* ^(/v3|/webjars|/swagger-resources|/swagger-ui.html) {\n		    proxy_pass 代理url;\n		}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;注意：&lt;mark&gt;v3&lt;/mark&gt;是swagger的版本号，如果你用的是Swagger2，那就改成&lt;mark&gt;v2&lt;/mark&gt;&lt;/p&gt;\n',0,0,'2021-03-29 21:31:52','2021-03-29 21:31:52',0),('1376527773944758274','1369634113126825985','SpringBoot中Cache的使用及源码分析','# SpringBoot中Cache的使用及源码分析\n\n>参考资料：尚硅谷雷封阳SpringBoot视频\n>\n>https://www.bilibili.com/video/BV1NT4y1J76v\n\n# 一、缓存的作用\n\n​	随着用户群体的扩展，系统所需要处理的数据请求将成几何式增长，数据库很容易会因为无法处理庞大的请求而产生宕机现象，这对一个软件来说是十分可怕的，而缓存就是解决这一问题的一个方案。缓存的使用将大大提高数据库的承载能力，提高系统的承载力和安全性。\n\n## 1. JSR107\n\n​		Java Caching定义了5个核心接口，分别是==CachingProvider==, ==CacheManager==, ==Cache==, ==Entry== 和 ==Expiry==。\n\n\n- ==CachingProvider==定义了创建、配置、获取、管理和控制多个**CacheManager**。一个应用可以在运行期访问多个CachingProvider。\n\n- ==CacheManager==定义了创建、配置、获取、管理和控制多个唯一命名的**Cache**，这些Cache存在于CacheManager的上下文中。一个CacheManager仅被一个CachingProvider所拥有。\n\n- ==Cache==是一个类似Map的数据结构并临时存储以Key为索引的值。一个Cache仅被一个CacheManager所拥有。\n\n- ==Entry==是一个存储在Cache中的key-value对。\n\n- ==Expiry== 每一个存储在Cache中的条目有一个定义的有效期。一旦超过这个时间，条目为过期的状态。一旦过期，条目将不可访问、更新和删除。缓存有效期可以通过ExpiryPolicy设置。\n\n  ​	其中，==CacheManager==和==Cache==是最常用的。他们的关系类似于MySQL数据库中数据库和表的关系，和MySQl不同的是：==Cache==中存储的是key-value形式的Entry。\n\n> 类继承图如下\n\n![JSR](https://gitee.com/yezio/images/raw/master/img/20210112144228.png)\n\n# 二、Spring缓存抽象\n\n​		Spring从3.1开始定义了**org.springframework.cache.Cache**\n和**org.springframework.cache.CacheManager**接口来统一不同的缓存技术；\n并支持使用JCache（JSR-107）注解简化我们开发；\n\n==Cache==接口为缓存的组件规范定义，包含缓存的各种操作集合；\n==Cache==接口下Spring提供了各种xxxCache的实现；如RedisCache，EhCacheCache , ConcurrentMapCache等；\n每次调用需要缓存功能的方法时，Spring会检查检查指定参数的指定的目标方法是否已经被调过；如果有就直接从缓存中获取方法调用后的结果，如果没有就调用方法并缓存结果后返回给用户。下次调用直接从缓存中获取。\n使用Spring缓存抽象时我们需要关注以下两点；\n\n1. 确定方法需要被缓存以及他们的缓存策略\n2. 从缓存中读取之前缓存存储的数据\n\n> 图解如下：\n\n![SpringCache](https://gitee.com/yezio/images/raw/master/img/20210112144231.png)\n\n# 三、几个重要概念&缓存注解\n\n## 1. 重要概念&缓存注解\n\n| **Cache**          | **缓存接口，定义缓存操作。实现有：**==RedisCache==、==EhCacheCache==、==ConcurrentMapCache==等 |\n| :----------------- | ------------------------------------------------------------ |\n| **CacheManager**   | **缓存管理器，管理各种缓存（Cache组件）**                    |\n| **@Cacheable**     | **主要针对方法配置，能够根据方法的请求参数对其结果进行缓存** |\n| **@CacheEvict**    | **清空缓存（和==@Cacheable==配合使用才有意义）**             |\n| **@CachePut**      | **保证方法被调用，又希望结果被缓存。（和==@Cacheable==配合使用才有意义）** |\n| **@Caching**       | **组合注解，可同时使用上面三个注解。用于实现复杂的缓存策略** |\n| **@CacheConfig**   | **一般用在类上，抽取配置其他注解的共有属性，例如==cacheNames==** |\n| **@EnableCaching** | **开启基于注解的缓存**                                       |\n| **keyGenerator**   | **缓存数据时key生成策略**                                    |\n| **serialize**      | **缓存数据时value序列化策略**                                |\n\n## 2.  @Cacheable/@CachePut/@CacheEvict注解下的常用属性\n\n|                  属性名                   |                             详解                             |                             示例                             |\n| :---------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |\n|                cacheNames                 |   缓存的名称，在  spring 配置文件中定义，必须指定至少一个    | 例如：     @Cacheable(cacheNames=”mycache”) 或者      @Cacheable(cacheNames={”cache1”,”cache2”} |\n|                   value                   |                       等效于cacheNames                       | 例如：     @Cacheable(value=”mycache”) 或者      @Cacheable(value={”cache1”,”cache2”} |\n|                    key                    | 缓存的  key，可以为空，如果指定要按照  SpEL 表达式编写，如果不指定，则默认使用==SimpleKeyGenerator==策略生成key |   例如：     @Cacheable(value=”testcache”,key=”#userName”)   |\n|               keyGenerator                |                      指定key的生成策略                       |            例如：keyGenerator = \"myKeyGenerator\"             |\n|                 condition                 | 缓存的条件，可以为空，使用  SpEL 编写，返回  true 或者 false，只有为  true 才进行缓存/清除缓存，在调用方法之前之后都能判断 | 例如：     @Cacheable(value=”testcache”,condition=”#userName.length()>2”) |\n|      allEntries  (**@CacheEvict**  )      | 是否清空所有缓存内容，缺省为  false，如果指定为 true，则方法调用后将立即清空所有缓存 （指定CacheName下的缓存） |   例如：     @CachEvict(value=”testcache”,allEntries=true)   |\n|    beforeInvocation  **(@CacheEvict)**    | 是否在方法执行前就清空，缺省为  false，如果指定为 true，则在方法还没有执行的时候就清空缓存，缺省情况下，如果方法执行抛出异常，则不会清空缓存 | 例如：  @CachEvict(value=”testcache”，beforeInvocation=true) |\n| unless  **(@CachePut)**  **(@Cacheable)** | 用于否决缓存的，不像condition，该表达式只在方法执行之后判断，此时可以拿到返回值result进行判断。条件为true不会缓存，fasle才缓存 | 例如：     @Cacheable(value=”testcache”,unless=”#result  == null”) |\n\n==需注意==：\n\n>1. key和keyGenerator二选一使用\n\n## 3. SpEL表达式详解\n\n|    **名字**     |      **位置**      |                           **描述**                           |       **示例**       |\n| :-------------: | :----------------: | :----------------------------------------------------------: | :------------------: |\n|   methodName    |    root.object     |                      当前被调用的方法名                      |   #root.methodName   |\n|     method      |    root.object     |                       当前被调用的方法                       |  #root.method.name   |\n|     target      |    root.object     |                     当前被调用的目标对象                     |     #root.target     |\n|   targetClass   |    root.object     |                    当前被调用的目标对象类                    |  #root.targetClass   |\n|      args       |    root.object     |                  当前被调用的方法的参数列表                  |    #root.args[0]     |\n|     caches      |    root  object    | 当前方法调用使用的缓存列表（如@Cacheable(value={\"cache1\",  \"cache2\"})），则有两个cache | #root.caches[0].name |\n| *argument name* | evaluation context | 方法参数的名字. 可以直接==#参数名==，也可以使用 ==#p0==或==#a0== 的形式，**0代表参数的索引**； | #iban 、 #a0 、 #p0  |\n|     result      | evaluation context | 方法执行后的返回值（仅当方法执行之后的判断有效，如‘unless’，’cache put’的表达式 ’cache evict’的表达式beforeInvocation=false） |       #result        |\n\n# 四、缓存使用\n\n> 部分注释看不懂没有关系，第五部分将会依据测试代码进行源码解析。不要放弃！\n\n## 1. 环境搭建\n\n### 1. 测试环境\n\n- JDK：1.8\n- IDE：IntelliJ IDEA 2019.3 x64\n- maven：apache-maven-3.5.2\n- mysql：MySQl Server 5.5\n- swagger：2.7.0\n- mybatisplus：3.4.0\n\n> 1. 整合Swagger2便于测试\n> 2. 整合lombok+mybatis-plus减少代码书写量（偷个懒）\n\n### 2. 数据库构建\n\n> 缓存注解推荐在Service层使用，因为Service层是负责业务逻辑操作数据的\n\n```sql\n/*\nSQLyog Enterprise v12.09 (64 bit)\nMySQL - 5.5.40 : Database - springboot_cache\n*********************************************************************\n*/\n\n\n/*!40101 SET NAMES utf8 */;\n\n/*!40101 SET SQL_MODE=\'\'*/;\n\n/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;\n/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;\n/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=\'NO_AUTO_VALUE_ON_ZERO\' */;\n/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;\nCREATE DATABASE /*!32312 IF NOT EXISTS*/`springboot_cache` /*!40100 DEFAULT CHARACTER SET utf8 */;\n\nUSE `springboot_cache`;\n\n/*Table structure for table `employee` */\n\nDROP TABLE IF EXISTS `employee`;\n\nCREATE TABLE `employee` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `lastName` varchar(255) DEFAULT NULL,\n  `email` varchar(255) DEFAULT NULL,\n  `gender` int(2) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;\n\n/*Data for the table `employee` */\n\ninsert  into `employee`(`id`,`lastName`,`email`,`gender`) values (1,\'花花\',\'232342@\',2),(2,\'叶子\',\'2342432323@\',3);\n\n/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;\n/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;\n/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;\n/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;\n```\n\n### 3. 依赖导入\n\n```xml\n<dependencies>\n\n        <dependency>\n            <groupId>org.mybatis.spring.boot</groupId>\n            <artifactId>mybatis-spring-boot-starter</artifactId>\n            <version>2.1.3</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <!-- Spring缓存依赖 -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-cache</artifactId>\n        </dependency>\n        <!-- MySQL连接 -->\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n            <version>5.1.37</version>\n            <scope>runtime</scope>\n        </dependency>\n        <!-- Lombok -->\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n\n        <!-- Mybatis-plus依赖 -->\n        <dependency>\n            <groupId>com.baomidou</groupId>\n            <artifactId>mybatis-plus-boot-starter</artifactId>\n            <version>3.4.0</version>\n        </dependency>\n    	<!-- mp代码生成器依赖 -->\n        <dependency>\n            <groupId>com.baomidou</groupId>\n            <artifactId>mybatis-plus-generator</artifactId>\n            <version>3.4.0</version>\n        </dependency>\n        <dependency>\n            <groupId>org.apache.velocity</groupId>\n            <artifactId>velocity-engine-core</artifactId>\n            <version>2.2</version>\n        </dependency>\n        <!-- Swagger2 -->\n        <dependency>\n            <groupId>io.springfox</groupId>\n            <artifactId>springfox-swagger2</artifactId>\n            <version>2.7.0</version>\n        </dependency>\n        <dependency>\n            <groupId>io.springfox</groupId>\n            <artifactId>springfox-swagger-ui</artifactId>\n            <version>2.7.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n            <exclusions>\n                <exclusion>\n                    <groupId>org.junit.vintage</groupId>\n                    <artifactId>junit-vintage-engine</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n    </dependencies>\n```\n\n### 4. 配置文件设置\n\n> dev2的环境将在整合redis时使用\n\n```yaml\nspring:\n  profiles:\n    active: dev1\n\n---\nspring:\n  profiles: dev1\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/springboot_cache\n    username: root\n    password: root\nserver:\n  port: 8080\n#控制台打印配置信息\nmybatis-plus:\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n  type-aliases-package: com.yezi.redistest.pojo\n  mapper-locations: classpath:com/yezi/redistest/mapper/xml/*.xml\ndebug: true\n---\n\nspring:\n  profiles: dev2\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/springboot_cache\n    username: root\n    password: root\n  redis:\n    host: localhost\n    port: 6379\n    database: 0\n    timeout: 1800000\n    lettuce:\n      pool:\n        max-active: 20\n        max-wait: -1  # 最大阻塞时间，负数表示没有限制\n        max-idle: 5\n        min-idle: 0\nserver:\n  port: 8080\n#控制台打印配置信息\nmybatis-plus:\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n  type-aliases-package: com.yezi.redistest.pojo\n  mapper-locations: classpath:com/yezi/redistest/mapper/xml/*.xml\n\n```\n\n\n\n### 5. 代码生成器配置\n\n```java\nimport com.baomidou.mybatisplus.annotation.DbType;\nimport com.baomidou.mybatisplus.annotation.IdType;\nimport com.baomidou.mybatisplus.generator.AutoGenerator;\nimport com.baomidou.mybatisplus.generator.config.DataSourceConfig;\nimport com.baomidou.mybatisplus.generator.config.GlobalConfig;\nimport com.baomidou.mybatisplus.generator.config.PackageConfig;\nimport com.baomidou.mybatisplus.generator.config.StrategyConfig;\nimport com.baomidou.mybatisplus.generator.config.rules.DateType;\nimport com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;\nimport org.junit.jupiter.api.Test;\n\n/**\n *\n * @author 叶子\n * @since 2020/10/28\n */\npublic class CodeGenerator {\n\n    @Test\n    public void run() {\n\n        // 1、创建代码生成器\n        AutoGenerator mpg = new AutoGenerator();\n\n        // 2、全局配置\n        GlobalConfig gc = new GlobalConfig();\n        String projectPath = System.getProperty(\"user.dir\");//得到当前文件夹路径\n        gc.setOutputDir(projectPath + \"/src/main/java\");//代码生成目录\n        gc.setAuthor(\"叶子\");\n        gc.setOpen(false); //生成后是否打开资源管理器\n        gc.setFileOverride(false); //重新生成时文件是否覆盖\n        gc.setServiceName(\"%sService\");	//去掉Service接口的首字母I\n        gc.setIdType(IdType.ID_WORKER_STR); //主键策略\n        gc.setDateType(DateType.ONLY_DATE);//定义生成的实体类中日期类型\n        gc.setSwagger2(true);//开启Swagger2模式\n\n        mpg.setGlobalConfig(gc);\n\n        // 3、数据源配置\n        DataSourceConfig dsc = new DataSourceConfig();\n        dsc.setUrl(\"jdbc:mysql://localhost:3306/springboot_cache\");\n        dsc.setDriverName(\"com.mysql.jdbc.Driver\");\n        dsc.setUsername(\"root\");\n        dsc.setPassword(\"root\");\n        dsc.setDbType(DbType.MYSQL);\n        mpg.setDataSource(dsc);\n\n        // 4、包配置\n        PackageConfig pc = new PackageConfig();\n        pc.setParent(\"com.yezi.redistest\");\n        /*pc.setModuleName(\"ucenter\"); //模块名*/\n        pc.setController(\"controller\");\n        pc.setEntity(\"pojo\");\n        pc.setService(\"service\");\n        pc.setMapper(\"mapper\");\n        mpg.setPackageInfo(pc);\n\n        // 5、策略配置\n        StrategyConfig strategy = new StrategyConfig();\n        strategy.setInclude(\"department\",\"employee\");//表名称\n        strategy.setNaming(NamingStrategy.underline_to_camel);//数据库表映射到实体的命名策略\n        strategy.setTablePrefix(pc.getModuleName() + \"_\"); //生成实体时去掉表前缀\n\n        strategy.setColumnNaming(NamingStrategy.underline_to_camel);//数据库表字段映射到实体的命名策略\n        strategy.setEntityLombokModel(true); // lombok 模型 @Accessors(chain = true) setter链式操作\n\n        strategy.setRestControllerStyle(true); //restful api风格控制器\n        strategy.setControllerMappingHyphenStyle(true); //url中驼峰转连字符\n\n        mpg.setStrategy(strategy);\n\n\n        // 6、执行\n        mpg.execute();\n    }\n}\n```\n\n### 6. 项目结构如下\n\n![SpringCache测试目录](https://gitee.com/yezio/images/raw/master/img/20210112144241.png)\n\n### 7. 开启缓存注解\n\n```java\n@SpringBootApplication\n@MapperScan(basePackages = \"com.yezi.redistest.mapper\")\n@EnableCaching /* 开启缓存注解 */\npublic class SpringbootRedisCatchApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringbootRedisCatchApplication.class, args);\n    }\n\n}\n```\n\n## 2. @CacheConfig&@Cacheable注解的使用\n\n### 1. 运行流程\n\n> @Cacheable：\n> 		1、service方法运行之前，先去查询Cache（缓存组件），按照cacheNames指定的名字获取；\n> 		（CacheManager先获取相应的缓存），第一次获取缓存如果没有Cache组件会自动创建。\n> 		2、去Cache中查找缓存的内容，使用一个key，默认就是方法的参数；\n> 			key是按照某种策略生成的；默认是使用keyGenerator生成的，默认使用SimpleKeyGenerator生 > 成key；\n> 				SimpleKeyGenerator生成key的默认策略；\n>            			如果没有参数；key=new SimpleKey()；\n>            			如果有一个参数：key=参数的值\n>           		 	如果有多个参数：key=new SimpleKey(params)；\n> 		3、没有查到缓存就调用目标方法；\n> 		4、将目标方法返回的结果，放进缓存中\n\n### 2. 详细代码\n\n```java\npackage com.yezi.redistest.service.impl;\n\nimport com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;\nimport com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;\nimport com.yezi.redistest.pojo.Employee;\nimport com.yezi.redistest.mapper.EmployeeMapper;\nimport com.yezi.redistest.service.EmployeeService;\nimport com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;\nimport org.springframework.cache.annotation.*;\nimport org.springframework.stereotype.Service;\n\n/**\n * <p>\n *  服务实现类\n * </p>\n *\n * @author 叶子\n * @since 2020-10-27\n */\n@Service\n@CacheConfig(cacheNames = \"employee\") /* 指定Cache组件名，本类的所有缓存都会被存储在名为employee的缓存组件中 */\npublic class EmployeeServiceImpl extends ServiceImpl<EmployeeMapper, Employee> implements EmployeeService {\n\n    /**\n     * 将方法的运行结果进行缓存；以后再要相同的数据，直接从缓存中获取，不用调用方法；\n     * CacheManager管理多个Cache组件的，对缓存的真正CRUD操作在Cache组件中，每一个缓存组件有自己唯一一个名字；\n     * CacheManager和Cache的关系类似于MySQL数据库中 数据库和表的关系\n     *   @Cacheable标注的方法执行之前先来检查缓存中有没有这个数据，默认按照参数的值作为key去查询缓存，\n     *   如果没有就运行方法并将结果放入缓存；以后再来调用就可以直接使用缓存中的数据；\n     *\n     *   核心：\n     *      1）、使用CacheManager【ConcurrentMapCacheManager】按照名字得到Cache【ConcurrentMapCache】组件\n     *      2）、key使用keyGenerator生成的，默认是SimpleKeyGenerator\n     * @param id\n     * @return\n     */\n    @Override\n    @Cacheable(key = \"#id\")\n    public Employee getEmployeeById(Integer id) {\n        return baseMapper.selectById(id);\n    }\n}\n\n```\n\n## 3. @CachePut注解的使用\n\n==请注意：==\n\n> 此注解需和@Cacheable注解配合使用才有意义\n>\n> 作用：更新数据后缓存中相应的数据也被更新，再次查询该数据时依然是从缓存中获取(已更新)，提高了效率\n\n### 1. 运行流程\n\n> @CachePut\n>\n> 	1. 首先执行service方法，查询数据库得到数据\n> 	2. 查询Cache（缓存组件），按照cacheNames指定的名字获取；（CacheManager先获取相应的缓存）\n> 	3. 使用指定的key查询Cache中是否有对应数据，如果有就进行更新，没有就创建\n\n### 2. 详细代码\n\n> 本方法在EmployeeServiceImpl类中\n\n```java\n    /**\n     * unless = \"#result == null\"\n     *  当返回值为null时就不进行缓存\n     * @param employee\n     * @return\n     */\n    @Override\n    @CachePut(key = \"#employee.id\",unless = \"#result == null\")\n    public Employee update(Employee employee) {\n        System.out.println(employee.getId());\n        UpdateWrapper<Employee> wrapper = new UpdateWrapper<>();\n        \n        int i = baseMapper.updateById(employee);\n        if (i > 0){\n            return employee;\n        }\n\n        return null;\n    }\n```\n\n## 4. @CacheEvict注解使用\n\n==请注意：==\n\n> 此注解需和@Cacheable注解配合使用才有意义\n>\n> 作用：删除数据后缓存中相应的数据也被删除\n\n### 1. 运行流程\n\n> @CacheEvict\n>\n> 1. 先执行service方法\n> 2. 如果service方法成功执行就移除指定Cache下的==指定key==的数据，不成功就不进行移除操作\n\n### 2. 详细代码\n\n> 本方法在EmployeeServiceImpl类中\n\n```java\n    @Override\n    @CacheEvict(key = \"#id\")\n    public void deleteById(Integer id) {\n        baseMapper.deleteById(id);\n    }\n```\n\n## 5. @Caching注解的使用\n\n> 本方法在EmployeeServiceImpl类中\n\n### 1. 详细代码\n\n```java\n    /**\n     * 这里我没有具体指定缓存策略\n     * 但是我们可以看到：\n     *      使用这个注解可以同时使用@Cacheable、@CachePut和@CacheEvict注解\n     *      从而实现一些复杂的缓存策略\n     * @param lastName\n     * @return\n     */\n    @Override\n    @Caching(cacheable = {\n            @Cacheable\n    },put = {\n            @CachePut\n    },evict = {\n            @CacheEvict\n    })\n    public Employee getByLastName(String lastName) {\n        QueryWrapper<Employee> wrapper = new QueryWrapper<>();\n        wrapper.eq(\"lastName\",lastName);\n        Employee employee = baseMapper.selectOne(wrapper);\n\n        return employee;\n    }\n```\n\n# 五、Cache原理解析（深入源码）\n\n> 这一部分主要通过对以下两方面的分析来学习SpringBoot缓存的原理\n>\n> 1. SpringBoot启动过程中对Cache的自动导入\n> 2. @Cacheable注解的执行流程\n\n## 1. SpringBoot自动配置Cache原理分析\n\n​		根据SpringBoot的自动配置原理，我们肯定要去找一个叫做**×××AutoConfiguration**的类，在此就应该是==CacheAutoConfiguration==自动配置类\n\n>CacheAutoConfiguration类截图\n\n![CacheAutoConfiguration](https://gitee.com/yezio/images/raw/master/img/20210112144247.png)\n\n可以看到，这个类导入了一个==CacheConfigurationImportSelector==类（翻译过来就是：缓存配置导入选择器），那么它导入了那些配置类呢？进入CacheConfigurationImportSelector源码进行查看\n\n> CacheConfigurationImportSelector源码\n\n```java\n/**\n	 * {@link ImportSelector} to add {@link CacheType} configuration classes.\n	 */\nstatic class CacheConfigurationImportSelector implements ImportSelector {\n\n    @Override\n    public String[] selectImports(AnnotationMetadata importingClassMetadata) {\n        CacheType[] types = CacheType.values();\n        String[] imports = new String[types.length];\n        for (int i = 0; i < types.length; i++) {\n            imports[i] = CacheConfigurations.getConfigurationClass(types[i]);\n        }\n        return imports;\n    }\n\n}\n```\n\n可以看到，==CacheConfigurationImportSelector==通过调用==CacheConfigurations==类的==getConfigurationClass()==方法拿到需要导入的配置类的名单（封装配置类全限定名的String数组）\n\n我们通过debug模式查看导入的配置类有哪些：\n\n![imports](https://gitee.com/yezio/images/raw/master/img/20210112144249.png)\n\n一共导入了10个缓存配置类，包括==RedisCacheConfiguration==、==SimpleCacheConfiguration==等，这其中有许多是用来自动配置一些缓存中间件的，比如==RedisCacheConfiguration==，当Redis的依赖被引入时，这个配置类就会生效，帮我们自动配置使用Redis实现缓存技术。\n\n> 关于SpringBoot集成redis实现缓存的操作以及原理，我将在另一篇博客中进行具体介绍。\n\n那么在我们没有使用任何缓存中间件的情况下，SpringBoot默认使用哪个缓存配置类呢？\n\n我们关闭程序，在yml（或者properties）文件中配置以debug级别打印日志，然后启动\n\n```yaml\ndebug: true\n```\n\n![debug](https://gitee.com/yezio/images/raw/master/img/20210112144252.png)\n\n通过日志信息我们知道了：SpringBoot自动帮我们注入了==SimpleCacheConfiguration==配置类\n\n==SimpleCacheConfiguration==配置类帮我们配置了哪些内容呢？我们通过他的源码来分析：\n\n```java\n/**\n * Simplest cache configuration, usually used as a fallback.\n *\n * @author Stephane Nicoll\n */\n@Configuration(proxyBeanMethods = false)\n@ConditionalOnMissingBean(CacheManager.class)\n@Conditional(CacheCondition.class)\nclass SimpleCacheConfiguration {\n\n	@Bean\n	ConcurrentMapCacheManager cacheManager(CacheProperties cacheProperties,\n			CacheManagerCustomizers cacheManagerCustomizers) {\n		ConcurrentMapCacheManager cacheManager = new ConcurrentMapCacheManager();\n		List<String> cacheNames = cacheProperties.getCacheNames();\n		if (!cacheNames.isEmpty()) {\n			cacheManager.setCacheNames(cacheNames);\n		}\n		return cacheManagerCustomizers.customize(cacheManager);\n	}\n\n}\n```\n\n可以看到，他帮我们注册了一个**cacheManager**(缓存管理器) --> ==ConcurrentMapCacheManager==\n\n> 经过前面的学习，我们知道，一个**cacheManager**管理多个**Cache**，在这里SpringBoot帮我们自动注册了一个**cacheManager**-->  ==ConcurrentMapCacheManager==，那么我们可以大胆推测：之后的缓存操作都将使用==ConcurrentMapCacheManager==这个类。事实上正是如此，我们将在对**@Cacheable**注解的分析中来证实这一点。\n\n## 2. ConcurrentMapCachemanager类分析\n\n> 源码过长，在此只针对部分代码进行分析。小伙伴们可自行==点开源码结合博客一起食用==。\n>\n> 如果你看到这一部分感到吃力，请结合**@Cacheable注解原理分析**一起食用\n\n### 1. 获取Cache的方法\n\n==ConcurrentMapCachemanager==类中有一个方法用来通过Cache的名称来获取Cache。\n\n> 源码如下\n\n```java\n    /**\n     * 非源码注释\n     * @param name cache名称，即由cacheNames和value属性指定的那个名称\n     * @return 如果不存在指定Cache，就根据名称创建Cache。如果存在，就返回该Cache\n     */\n    @Override\n    @Nullable\n    public Cache getCache(String name) {\n        Cache cache = this.cacheMap.get(name);\n        if (cache == null && this.dynamic) {\n            synchronized (this.cacheMap) {\n                cache = this.cacheMap.get(name);\n                if (cache == null) {\n                    cache = createConcurrentMapCache(name);//其实就是创建了一个Map集合，后面会讲到\n                    this.cacheMap.put(name, cache);\n                }\n            }\n        }\n        return cache;\n    }\n```\n\n​		通过这个方法我们可以知道：cache是被存储在==ConcurrentMapCachemanager==类中的==cacheMap==属性中的，那这个==cacheMap==具体是什么呢？我们继续来查看源码。\n\n![ConcurrentMap](https://gitee.com/yezio/images/raw/master/img/20210112144256.png)\n\n​		在==ConcurrentMapCachemanager==类中找到这个属性后，我们发现他就是一个HashMap集合！\n\n由此我们可以得出结论：\n\n> ==ConcurrentMapCachemanager==默认使用一个HashMap集合来实现缓存。在这个集合中：==key==就是==Cache的名称==，==value==就是==具体的Cache==\n\n### 2. 创建Cache的方法\n\n> createConcurrentMapCache(String name)方法源码：\n\n```java\n	/**\n	 * Create a new ConcurrentMapCache instance for the specified cache name.\n	 * @param name the name of the cache\n	 * @return the ConcurrentMapCache (or a decorator thereof)\n	 */\n	protected Cache createConcurrentMapCache(String name) {\n		SerializationDelegate actualSerialization = (isStoreByValue() ? this.serialization : null);\n		return new ConcurrentMapCache(name, new ConcurrentHashMap<>(256), isAllowNullValues(), actualSerialization);\n	}\n```\n\n我们可以看到在这里，Cache其实是用的是：==ConcurrentMapCache==实现类。那我们继续来分析==ConcurrentMapCache==源码\n\n![ConcurrentMapCache](https://gitee.com/yezio/images/raw/master/img/20210112144301.png)\n\n这里我们重点来关注这个==store==属性，其实他存储的就是我们前面所说的==Entry==\n\n至此，我们就可以明白SpringBoot默认使用的Cache实现机制了，下面我用一幅图来展现以上这两个类的关系（==ConcurrentMapCachemanager==和==ConcurrentMapCache==）\n\n![SpringBoot默认Cache缓存原理详解](https://gitee.com/yezio/images/raw/master/img/20210112144301.png)\n\n在这里，我们使用的缓存管理器就是==ConcurrentMapCachemanager==，而具体的缓存接口实现类就是==ConcurrentMapCache==。\n\n> 这两个类中还有其他方法未做讲解。有一部分会在**@Cacheable注解原理分析**中进行讲解，而另一部分则不再赘述。\n\n## 3. @Cacheable注解原理分析\n\n### 1. 尝试获取cache\n\n​		在之前使用此注解的时候，我们提到他会先查询Cache(缓存组件)，所以这个注解肯定会首先调用==ConcurrentMapCachemanager==类中的==getCache==方法，我们为这个方法打上断点，进行调试。\n\n> 补充：这里我使用Swagger接口文档对获取employee的接口进行了调用（还是上面的测试项目）\n\n![getCache](../img/getCache.png)\n\n可以看到，@Cacheable注解调用了这个方法，并使用我们指定的==cacheName==（employee）去查询是否存在这个Cache（缓存组件）。由于是第一次调用，所以缓存中是肯定没有这个Cache的，它将为我创建一个名为**employee**的缓存组件。\n\n> 点击下一步，正如我们预测的，它创建了这个cache\n\n![createConcurrentMapCache](../img/createConcurrentMapCache.png)\n\n> 至此，获取缓存组件的过程就结束了。接下来根据我们之前对@Cacheable执行过程的分析，他将会使用我们指定的==key==（在这里就是员工的id）来获取对应的value。在==ConcurrentMapCache==类中有一个对应的方法：==lookup(Object key)==。建议提前为其打上断点！\n\n### 2. 使用指定key在cache中查找数据\n\n我们对程序进行放行，得到：\n\n![lookup](../img/lookup.png)\n\n​		由于这是第一次调用，所以缓存中肯定是没有这个数据的。此时@Cacheable注解将会调用service方法，获取数据\n\n> 我们继续放行\n\n![调用service方法](../img/调用service方法.png)\n\n### 3. 将数据添加到cache中（缓存中没有对应数据时执行）\n\n> 添加数据（==Entry==）的操作将会调用==ConcurrentMapCache==类中的==put(Object key, @Nullable Object value)==方法，建议提前打上断点\n>\n> 继续放行\n\n![put](https://gitee.com/yezio/images/raw/master/img/20210112144314.png)\n\n这样，查询得到的数据就被添加到缓存中了。下次调用就会直接从缓存中获取数据而不用再次调用service方法\n\n### 4. @Cacheable注解执行流程图\n\n![@Cacheable执行流程](https://gitee.com/yezio/images/raw/master/img/20210112144316.png)\n\n>如有不当之处，请各位指教\n>\n>转载请注明出处\n\n','&lt;h1&gt;&lt;a id=&quot;SpringBootCache_0&quot;&gt;&lt;/a&gt;SpringBoot中Cache的使用及源码分析&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;参考资料：尚硅谷雷封阳SpringBoot视频&lt;/p&gt;\n&lt;p&gt;https://www.bilibili.com/video/BV1NT4y1J76v&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h1&gt;&lt;a id=&quot;_6&quot;&gt;&lt;/a&gt;一、缓存的作用&lt;/h1&gt;\n&lt;p&gt;​	随着用户群体的扩展，系统所需要处理的数据请求将成几何式增长，数据库很容易会因为无法处理庞大的请求而产生宕机现象，这对一个软件来说是十分可怕的，而缓存就是解决这一问题的一个方案。缓存的使用将大大提高数据库的承载能力，提高系统的承载力和安全性。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;1_JSR107_10&quot;&gt;&lt;/a&gt;1. JSR107&lt;/h2&gt;\n&lt;p&gt;​		Java Caching定义了5个核心接口，分别是&lt;mark&gt;CachingProvider&lt;/mark&gt;, &lt;mark&gt;CacheManager&lt;/mark&gt;, &lt;mark&gt;Cache&lt;/mark&gt;, &lt;mark&gt;Entry&lt;/mark&gt; 和 &lt;mark&gt;Expiry&lt;/mark&gt;。&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;mark&gt;CachingProvider&lt;/mark&gt;定义了创建、配置、获取、管理和控制多个&lt;strong&gt;CacheManager&lt;/strong&gt;。一个应用可以在运行期访问多个CachingProvider。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;mark&gt;CacheManager&lt;/mark&gt;定义了创建、配置、获取、管理和控制多个唯一命名的&lt;strong&gt;Cache&lt;/strong&gt;，这些Cache存在于CacheManager的上下文中。一个CacheManager仅被一个CachingProvider所拥有。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;mark&gt;Cache&lt;/mark&gt;是一个类似Map的数据结构并临时存储以Key为索引的值。一个Cache仅被一个CacheManager所拥有。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;mark&gt;Entry&lt;/mark&gt;是一个存储在Cache中的key-value对。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;mark&gt;Expiry&lt;/mark&gt; 每一个存储在Cache中的条目有一个定义的有效期。一旦超过这个时间，条目为过期的状态。一旦过期，条目将不可访问、更新和删除。缓存有效期可以通过ExpiryPolicy设置。&lt;/p&gt;\n&lt;p&gt;​	其中，&lt;mark&gt;CacheManager&lt;/mark&gt;和&lt;mark&gt;Cache&lt;/mark&gt;是最常用的。他们的关系类似于MySQL数据库中数据库和表的关系，和MySQl不同的是：&lt;mark&gt;Cache&lt;/mark&gt;中存储的是key-value形式的Entry。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;\n&lt;p&gt;类继承图如下&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144228.png&quot; alt=&quot;JSR&quot; /&gt;&lt;/p&gt;\n&lt;h1&gt;&lt;a id=&quot;Spring_31&quot;&gt;&lt;/a&gt;二、Spring缓存抽象&lt;/h1&gt;\n&lt;p&gt;​		Spring从3.1开始定义了&lt;strong&gt;org.springframework.cache.Cache&lt;/strong&gt;&lt;br /&gt;\n和&lt;strong&gt;org.springframework.cache.CacheManager&lt;/strong&gt;接口来统一不同的缓存技术；&lt;br /&gt;\n并支持使用JCache（JSR-107）注解简化我们开发；&lt;/p&gt;\n&lt;p&gt;&lt;mark&gt;Cache&lt;/mark&gt;接口为缓存的组件规范定义，包含缓存的各种操作集合；&lt;br /&gt;\n&lt;mark&gt;Cache&lt;/mark&gt;接口下Spring提供了各种xxxCache的实现；如RedisCache，EhCacheCache , ConcurrentMapCache等；&lt;br /&gt;\n每次调用需要缓存功能的方法时，Spring会检查检查指定参数的指定的目标方法是否已经被调过；如果有就直接从缓存中获取方法调用后的结果，如果没有就调用方法并缓存结果后返回给用户。下次调用直接从缓存中获取。&lt;br /&gt;\n使用Spring缓存抽象时我们需要关注以下两点；&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;确定方法需要被缓存以及他们的缓存策略&lt;/li&gt;\n&lt;li&gt;从缓存中读取之前缓存存储的数据&lt;/li&gt;\n&lt;/ol&gt;\n&lt;blockquote&gt;\n&lt;p&gt;图解如下：&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144231.png&quot; alt=&quot;SpringCache&quot; /&gt;&lt;/p&gt;\n&lt;h1&gt;&lt;a id=&quot;_49&quot;&gt;&lt;/a&gt;三、几个重要概念&amp;amp;缓存注解&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;1__51&quot;&gt;&lt;/a&gt;1. 重要概念&amp;amp;缓存注解&lt;/h2&gt;\n&lt;table&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th style=&quot;text-align:left&quot;&gt;&lt;strong&gt;Cache&lt;/strong&gt;&lt;/th&gt;\n&lt;th&gt;&lt;strong&gt;缓存接口，定义缓存操作。实现有：&lt;/strong&gt;&lt;mark&gt;RedisCache&lt;/mark&gt;、&lt;mark&gt;EhCacheCache&lt;/mark&gt;、&lt;mark&gt;ConcurrentMapCache&lt;/mark&gt;等&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;CacheManager&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;缓存管理器，管理各种缓存（Cache组件）&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;@Cacheable&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;主要针对方法配置，能够根据方法的请求参数对其结果进行缓存&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;@CacheEvict&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;清空缓存（和==@Cacheable==配合使用才有意义）&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;@CachePut&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;保证方法被调用，又希望结果被缓存。（和==@Cacheable==配合使用才有意义）&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;@Caching&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;组合注解，可同时使用上面三个注解。用于实现复杂的缓存策略&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;@CacheConfig&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;一般用在类上，抽取配置其他注解的共有属性，例如&lt;mark&gt;cacheNames&lt;/mark&gt;&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;@EnableCaching&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;开启基于注解的缓存&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;keyGenerator&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;缓存数据时key生成策略&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:left&quot;&gt;&lt;strong&gt;serialize&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;缓存数据时value序列化策略&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n&lt;h2&gt;&lt;a id=&quot;2__CacheableCachePutCacheEvict_65&quot;&gt;&lt;/a&gt;2.  @Cacheable/@CachePut/@CacheEvict注解下的常用属性&lt;/h2&gt;\n&lt;table&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th style=&quot;text-align:center&quot;&gt;属性名&lt;/th&gt;\n&lt;th style=&quot;text-align:center&quot;&gt;详解&lt;/th&gt;\n&lt;th style=&quot;text-align:center&quot;&gt;示例&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;cacheNames&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;缓存的名称，在  spring 配置文件中定义，必须指定至少一个&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：     @Cacheable(cacheNames=&rdquo;mycache&rdquo;) 或者      @Cacheable(cacheNames={&rdquo;cache1&rdquo;,&rdquo;cache2&rdquo;}&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;value&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;等效于cacheNames&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：     @Cacheable(value=&rdquo;mycache&rdquo;) 或者      @Cacheable(value={&rdquo;cache1&rdquo;,&rdquo;cache2&rdquo;}&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;key&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;缓存的  key，可以为空，如果指定要按照  SpEL 表达式编写，如果不指定，则默认使用&lt;mark&gt;SimpleKeyGenerator&lt;/mark&gt;策略生成key&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：     @Cacheable(value=&rdquo;testcache&rdquo;,key=&rdquo;#userName&rdquo;)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;keyGenerator&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;指定key的生成策略&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：keyGenerator = &ldquo;myKeyGenerator&rdquo;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;condition&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;缓存的条件，可以为空，使用  SpEL 编写，返回  true 或者 false，只有为  true 才进行缓存/清除缓存，在调用方法之前之后都能判断&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：     @Cacheable(value=&rdquo;testcache&rdquo;,condition=&rdquo;#userName.length()&amp;gt;2&rdquo;)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;allEntries  (&lt;strong&gt;@CacheEvict&lt;/strong&gt;  )&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;是否清空所有缓存内容，缺省为  false，如果指定为 true，则方法调用后将立即清空所有缓存 （指定CacheName下的缓存）&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：     @CachEvict(value=&rdquo;testcache&rdquo;,allEntries=true)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;beforeInvocation  &lt;strong&gt;(@CacheEvict)&lt;/strong&gt;&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;是否在方法执行前就清空，缺省为  false，如果指定为 true，则在方法还没有执行的时候就清空缓存，缺省情况下，如果方法执行抛出异常，则不会清空缓存&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：  @CachEvict(value=&rdquo;testcache&rdquo;，beforeInvocation=true)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;unless  &lt;strong&gt;(@CachePut)&lt;/strong&gt;  &lt;strong&gt;(@Cacheable)&lt;/strong&gt;&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;用于否决缓存的，不像condition，该表达式只在方法执行之后判断，此时可以拿到返回值result进行判断。条件为true不会缓存，fasle才缓存&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;例如：     @Cacheable(value=&rdquo;testcache&rdquo;,unless=&rdquo;#result  == null&rdquo;)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n&lt;p&gt;&lt;mark&gt;需注意&lt;/mark&gt;：&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;key和keyGenerator二选一使用&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h2&gt;&lt;a id=&quot;3_SpEL_82&quot;&gt;&lt;/a&gt;3. SpEL表达式详解&lt;/h2&gt;\n&lt;table&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th style=&quot;text-align:center&quot;&gt;&lt;strong&gt;名字&lt;/strong&gt;&lt;/th&gt;\n&lt;th style=&quot;text-align:center&quot;&gt;&lt;strong&gt;位置&lt;/strong&gt;&lt;/th&gt;\n&lt;th style=&quot;text-align:center&quot;&gt;&lt;strong&gt;描述&lt;/strong&gt;&lt;/th&gt;\n&lt;th style=&quot;text-align:center&quot;&gt;&lt;strong&gt;示例&lt;/strong&gt;&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;methodName&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;root.object&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;当前被调用的方法名&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#root.methodName&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;method&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;root.object&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;当前被调用的方法&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#root.method.name&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;target&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;root.object&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;当前被调用的目标对象&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#root.target&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;targetClass&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;root.object&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;当前被调用的目标对象类&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#root.targetClass&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;args&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;root.object&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;当前被调用的方法的参数列表&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#root.args[0]&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;caches&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;root  object&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;当前方法调用使用的缓存列表（如@Cacheable(value={&ldquo;cache1&rdquo;,  &ldquo;cache2&rdquo;})），则有两个cache&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#root.caches[0].name&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;&lt;em&gt;argument name&lt;/em&gt;&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;evaluation context&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;方法参数的名字. 可以直接==#参数名==，也可以使用 &lt;mark&gt;#p0&lt;/mark&gt;或==#a0== 的形式，&lt;strong&gt;0代表参数的索引&lt;/strong&gt;；&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#iban 、 #a0 、 #p0&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;result&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;evaluation context&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;方法执行后的返回值（仅当方法执行之后的判断有效，如&lsquo;unless&rsquo;，&rsquo;cache put&rsquo;的表达式 &rsquo;cache evict&rsquo;的表达式beforeInvocation=false）&lt;/td&gt;\n&lt;td style=&quot;text-align:center&quot;&gt;#result&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n&lt;h1&gt;&lt;a id=&quot;_95&quot;&gt;&lt;/a&gt;四、缓存使用&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;部分注释看不懂没有关系，第五部分将会依据测试代码进行源码解析。不要放弃！&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2&gt;&lt;a id=&quot;1__99&quot;&gt;&lt;/a&gt;1. 环境搭建&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__101&quot;&gt;&lt;/a&gt;1. 测试环境&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;JDK：1.8&lt;/li&gt;\n&lt;li&gt;IDE：IntelliJ IDEA 2019.3 x64&lt;/li&gt;\n&lt;li&gt;maven：apache-maven-3.5.2&lt;/li&gt;\n&lt;li&gt;mysql：MySQl Server 5.5&lt;/li&gt;\n&lt;li&gt;swagger：2.7.0&lt;/li&gt;\n&lt;li&gt;mybatisplus：3.4.0&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;整合Swagger2便于测试&lt;/li&gt;\n&lt;li&gt;整合lombok+mybatis-plus减少代码书写量（偷个懒）&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;2__113&quot;&gt;&lt;/a&gt;2. 数据库构建&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;缓存注解推荐在Service层使用，因为Service层是负责业务逻辑操作数据的&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-sql&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/*\nSQLyog Enterprise v12.09 (64 bit)\nMySQL - 5.5.40 : Database - springboot_cache\n*********************************************************************\n*/&lt;/span&gt;\n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40101 SET NAMES utf8 */&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40101 SET SQL_MODE=&#39;&#39;*/&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */&lt;/span&gt;;\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */&lt;/span&gt;;\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */&lt;/span&gt;;\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DATABASE&lt;/span&gt; &lt;span class=&quot;hljs-comment&quot;&gt;/*!32312 IF NOT EXISTS*/&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;`springboot_cache`&lt;/span&gt; &lt;span class=&quot;hljs-comment&quot;&gt;/*!40100 DEFAULT CHARACTER SET utf8 */&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`springboot_cache`&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*Table structure for table `employee` */&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`employee`&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`employee`&lt;/span&gt; (\n  &lt;span class=&quot;hljs-string&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;int&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;NULL&lt;/span&gt; AUTO_INCREMENT,\n  &lt;span class=&quot;hljs-string&quot;&gt;`lastName`&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;255&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;NULL&lt;/span&gt;,\n  &lt;span class=&quot;hljs-string&quot;&gt;`email`&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;255&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;NULL&lt;/span&gt;,\n  &lt;span class=&quot;hljs-string&quot;&gt;`gender`&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;int&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;NULL&lt;/span&gt;,\n  PRIMARY &lt;span class=&quot;hljs-keyword&quot;&gt;KEY&lt;/span&gt; (&lt;span class=&quot;hljs-string&quot;&gt;`id`&lt;/span&gt;)\n) &lt;span class=&quot;hljs-keyword&quot;&gt;ENGINE&lt;/span&gt;=&lt;span class=&quot;hljs-keyword&quot;&gt;InnoDB&lt;/span&gt; AUTO_INCREMENT=&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;CHARSET&lt;/span&gt;=utf8;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*Data for the table `employee` */&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;insert&lt;/span&gt;  &lt;span class=&quot;hljs-keyword&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`employee`&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;`id`&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;`lastName`&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;`email`&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;`gender`&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;values&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&#39;花花&#39;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&#39;232342@&#39;&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;),(&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&#39;叶子&#39;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&#39;2342432323@&#39;&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;);\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40101 SET SQL_MODE=@OLD_SQL_MODE */&lt;/span&gt;;\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */&lt;/span&gt;;\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */&lt;/span&gt;;\n&lt;span class=&quot;hljs-comment&quot;&gt;/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */&lt;/span&gt;;\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;3__159&quot;&gt;&lt;/a&gt;3. 依赖导入&lt;/h3&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependencies&lt;/span&gt;&amp;gt;&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.mybatis.spring.boot&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;mybatis-spring-boot-starter&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.1.3&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-web&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;&amp;lt;!-- Spring缓存依赖 --&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-cache&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;&amp;lt;!-- MySQL连接 --&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;mysql&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;mysql-connector-java&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;5.1.37&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;scope&lt;/span&gt;&amp;gt;&lt;/span&gt;runtime&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;scope&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;&amp;lt;!-- Lombok --&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.projectlombok&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;lombok&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;optional&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;optional&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;&amp;lt;!-- Mybatis-plus依赖 --&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.baomidou&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;mybatis-plus-boot-starter&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.4.0&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    	&lt;span class=&quot;hljs-comment&quot;&gt;&amp;lt;!-- mp代码生成器依赖 --&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.baomidou&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;mybatis-plus-generator&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.4.0&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.apache.velocity&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;velocity-engine-core&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.2&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;&amp;lt;!-- Swagger2 --&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;io.springfox&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;springfox-swagger2&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.7.0&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;io.springfox&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;springfox-swagger-ui&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.7.0&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-test&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;scope&lt;/span&gt;&amp;gt;&lt;/span&gt;test&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;scope&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;exclusions&lt;/span&gt;&amp;gt;&lt;/span&gt;\n                &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;exclusion&lt;/span&gt;&amp;gt;&lt;/span&gt;\n                    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.junit.vintage&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n                    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;junit-vintage-engine&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n                &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;exclusion&lt;/span&gt;&amp;gt;&lt;/span&gt;\n            &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;exclusions&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependencies&lt;/span&gt;&amp;gt;&lt;/span&gt;\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;4__235&quot;&gt;&lt;/a&gt;4. 配置文件设置&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;dev2的环境将在整合redis时使用&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=&quot;lang-yaml&quot;&gt;spring:\n  profiles:\n    active: dev1\n\n---\nspring:\n  profiles: dev1\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/springboot_cache\n    username: root\n    password: root\nserver:\n  port: 8080\n#控制台打印配置信息\nmybatis-plus:\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n  type-aliases-package: com.yezi.redistest.pojo\n  mapper-locations: classpath:com/yezi/redistest/mapper/xml/*.xml\ndebug: true\n---\n\nspring:\n  profiles: dev2\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/springboot_cache\n    username: root\n    password: root\n  redis:\n    host: localhost\n    port: 6379\n    database: 0\n    timeout: 1800000\n    lettuce:\n      pool:\n        max-active: 20\n        max-wait: -1  # 最大阻塞时间，负数表示没有限制\n        max-idle: 5\n        min-idle: 0\nserver:\n  port: 8080\n#控制台打印配置信息\nmybatis-plus:\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n  type-aliases-package: com.yezi.redistest.pojo\n  mapper-locations: classpath:com/yezi/redistest/mapper/xml/*.xml\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;5__294&quot;&gt;&lt;/a&gt;5. 代码生成器配置&lt;/h3&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.annotation.DbType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.annotation.IdType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.generator.AutoGenerator;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.generator.config.DataSourceConfig;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.generator.config.GlobalConfig;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.generator.config.PackageConfig;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.generator.config.StrategyConfig;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.generator.config.rules.DateType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@since&lt;/span&gt; 2020/10/28\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CodeGenerator&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Test&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// 1、创建代码生成器&lt;/span&gt;\n        AutoGenerator mpg = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; AutoGenerator();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// 2、全局配置&lt;/span&gt;\n        GlobalConfig gc = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; GlobalConfig();\n        String projectPath = System.getProperty(&lt;span class=&quot;hljs-string&quot;&gt;&quot;user.dir&quot;&lt;/span&gt;);&lt;span class=&quot;hljs-comment&quot;&gt;//得到当前文件夹路径&lt;/span&gt;\n        gc.setOutputDir(projectPath + &lt;span class=&quot;hljs-string&quot;&gt;&quot;/src/main/java&quot;&lt;/span&gt;);&lt;span class=&quot;hljs-comment&quot;&gt;//代码生成目录&lt;/span&gt;\n        gc.setAuthor(&lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子&quot;&lt;/span&gt;);\n        gc.setOpen(&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;); &lt;span class=&quot;hljs-comment&quot;&gt;//生成后是否打开资源管理器&lt;/span&gt;\n        gc.setFileOverride(&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;); &lt;span class=&quot;hljs-comment&quot;&gt;//重新生成时文件是否覆盖&lt;/span&gt;\n        gc.setServiceName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;%sService&quot;&lt;/span&gt;);	&lt;span class=&quot;hljs-comment&quot;&gt;//去掉Service接口的首字母I&lt;/span&gt;\n        gc.setIdType(IdType.ID_WORKER_STR); &lt;span class=&quot;hljs-comment&quot;&gt;//主键策略&lt;/span&gt;\n        gc.setDateType(DateType.ONLY_DATE);&lt;span class=&quot;hljs-comment&quot;&gt;//定义生成的实体类中日期类型&lt;/span&gt;\n        gc.setSwagger2(&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;);&lt;span class=&quot;hljs-comment&quot;&gt;//开启Swagger2模式&lt;/span&gt;\n\n        mpg.setGlobalConfig(gc);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// 3、数据源配置&lt;/span&gt;\n        DataSourceConfig dsc = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DataSourceConfig();\n        dsc.setUrl(&lt;span class=&quot;hljs-string&quot;&gt;&quot;jdbc:mysql://localhost:3306/springboot_cache&quot;&lt;/span&gt;);\n        dsc.setDriverName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;com.mysql.jdbc.Driver&quot;&lt;/span&gt;);\n        dsc.setUsername(&lt;span class=&quot;hljs-string&quot;&gt;&quot;root&quot;&lt;/span&gt;);\n        dsc.setPassword(&lt;span class=&quot;hljs-string&quot;&gt;&quot;root&quot;&lt;/span&gt;);\n        dsc.setDbType(DbType.MYSQL);\n        mpg.setDataSource(dsc);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// 4、包配置&lt;/span&gt;\n        PackageConfig pc = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; PackageConfig();\n        pc.setParent(&lt;span class=&quot;hljs-string&quot;&gt;&quot;com.yezi.redistest&quot;&lt;/span&gt;);\n        &lt;span class=&quot;hljs-comment&quot;&gt;/*pc.setModuleName(&quot;ucenter&quot;); //模块名*/&lt;/span&gt;\n        pc.setController(&lt;span class=&quot;hljs-string&quot;&gt;&quot;controller&quot;&lt;/span&gt;);\n        pc.setEntity(&lt;span class=&quot;hljs-string&quot;&gt;&quot;pojo&quot;&lt;/span&gt;);\n        pc.setService(&lt;span class=&quot;hljs-string&quot;&gt;&quot;service&quot;&lt;/span&gt;);\n        pc.setMapper(&lt;span class=&quot;hljs-string&quot;&gt;&quot;mapper&quot;&lt;/span&gt;);\n        mpg.setPackageInfo(pc);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// 5、策略配置&lt;/span&gt;\n        StrategyConfig strategy = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; StrategyConfig();\n        strategy.setInclude(&lt;span class=&quot;hljs-string&quot;&gt;&quot;department&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;employee&quot;&lt;/span&gt;);&lt;span class=&quot;hljs-comment&quot;&gt;//表名称&lt;/span&gt;\n        strategy.setNaming(NamingStrategy.underline_to_camel);&lt;span class=&quot;hljs-comment&quot;&gt;//数据库表映射到实体的命名策略&lt;/span&gt;\n        strategy.setTablePrefix(pc.getModuleName() + &lt;span class=&quot;hljs-string&quot;&gt;&quot;_&quot;&lt;/span&gt;); &lt;span class=&quot;hljs-comment&quot;&gt;//生成实体时去掉表前缀&lt;/span&gt;\n\n        strategy.setColumnNaming(NamingStrategy.underline_to_camel);&lt;span class=&quot;hljs-comment&quot;&gt;//数据库表字段映射到实体的命名策略&lt;/span&gt;\n        strategy.setEntityLombokModel(&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;); &lt;span class=&quot;hljs-comment&quot;&gt;// lombok 模型 @Accessors(chain = true) setter链式操作&lt;/span&gt;\n\n        strategy.setRestControllerStyle(&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;); &lt;span class=&quot;hljs-comment&quot;&gt;//restful api风格控制器&lt;/span&gt;\n        strategy.setControllerMappingHyphenStyle(&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;); &lt;span class=&quot;hljs-comment&quot;&gt;//url中驼峰转连字符&lt;/span&gt;\n\n        mpg.setStrategy(strategy);\n\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// 6、执行&lt;/span&gt;\n        mpg.execute();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;6__375&quot;&gt;&lt;/a&gt;6. 项目结构如下&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144241.png&quot; alt=&quot;SpringCache测试目录&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;7__379&quot;&gt;&lt;/a&gt;7. 开启缓存注解&lt;/h3&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@SpringBootApplication&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@MapperScan&lt;/span&gt;(basePackages = &lt;span class=&quot;hljs-string&quot;&gt;&quot;com.yezi.redistest.mapper&quot;&lt;/span&gt;)\n&lt;span class=&quot;hljs-meta&quot;&gt;@EnableCaching&lt;/span&gt; &lt;span class=&quot;hljs-comment&quot;&gt;/* 开启缓存注解 */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;SpringbootRedisCatchApplication&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;{\n        SpringApplication.run(SpringbootRedisCatchApplication.class, args);\n    }\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;2_CacheConfigCacheable_394&quot;&gt;&lt;/a&gt;2. @CacheConfig&amp;amp;@Cacheable注解的使用&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__396&quot;&gt;&lt;/a&gt;1. 运行流程&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;@Cacheable：&lt;br /&gt;\n1、service方法运行之前，先去查询Cache（缓存组件），按照cacheNames指定的名字获取；&lt;br /&gt;\n（CacheManager先获取相应的缓存），第一次获取缓存如果没有Cache组件会自动创建。&lt;br /&gt;\n2、去Cache中查找缓存的内容，使用一个key，默认就是方法的参数；&lt;br /&gt;\nkey是按照某种策略生成的；默认是使用keyGenerator生成的，默认使用SimpleKeyGenerator生 &amp;gt; 成key；&lt;br /&gt;\nSimpleKeyGenerator生成key的默认策略；&lt;br /&gt;\n如果没有参数；key=new SimpleKey()；&lt;br /&gt;\n如果有一个参数：key=参数的值&lt;br /&gt;\n如果有多个参数：key=new SimpleKey(params)；&lt;br /&gt;\n3、没有查到缓存就调用目标方法；&lt;br /&gt;\n4、将目标方法返回的结果，放进缓存中&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;2__410&quot;&gt;&lt;/a&gt;2. 详细代码&lt;/h3&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; com.yezi.redistest.service.impl;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.yezi.redistest.pojo.Employee;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.yezi.redistest.mapper.EmployeeMapper;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.yezi.redistest.service.EmployeeService;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.cache.annotation.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.stereotype.Service;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &amp;lt;p&amp;gt;\n *  服务实现类\n * &amp;lt;/p&amp;gt;\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@since&lt;/span&gt; 2020-10-27\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Service&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@CacheConfig&lt;/span&gt;(cacheNames = &lt;span class=&quot;hljs-string&quot;&gt;&quot;employee&quot;&lt;/span&gt;) &lt;span class=&quot;hljs-comment&quot;&gt;/* 指定Cache组件名，本类的所有缓存都会被存储在名为employee的缓存组件中 */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;EmployeeServiceImpl&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ServiceImpl&lt;/span&gt;&amp;lt;&lt;span class=&quot;hljs-title&quot;&gt;EmployeeMapper&lt;/span&gt;, &lt;span class=&quot;hljs-title&quot;&gt;Employee&lt;/span&gt;&amp;gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;EmployeeService&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 将方法的运行结果进行缓存；以后再要相同的数据，直接从缓存中获取，不用调用方法；\n     * CacheManager管理多个Cache组件的，对缓存的真正CRUD操作在Cache组件中，每一个缓存组件有自己唯一一个名字；\n     * CacheManager和Cache的关系类似于MySQL数据库中 数据库和表的关系\n     *   &lt;span class=&quot;hljs-doctag&quot;&gt;@Cacheable&lt;/span&gt;标注的方法执行之前先来检查缓存中有没有这个数据，默认按照参数的值作为key去查询缓存，\n     *   如果没有就运行方法并将结果放入缓存；以后再来调用就可以直接使用缓存中的数据；\n     *\n     *   核心：\n     *      1）、使用CacheManager【ConcurrentMapCacheManager】按照名字得到Cache【ConcurrentMapCache】组件\n     *      2）、key使用keyGenerator生成的，默认是SimpleKeyGenerator\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; id\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt;\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Cacheable&lt;/span&gt;(key = &lt;span class=&quot;hljs-string&quot;&gt;&quot;#id&quot;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Employee &lt;span class=&quot;hljs-title&quot;&gt;getEmployeeById&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Integer id)&lt;/span&gt; &lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; baseMapper.selectById(id);\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;3_CachePut_458&quot;&gt;&lt;/a&gt;3. @CachePut注解的使用&lt;/h2&gt;\n&lt;p&gt;&lt;mark&gt;请注意：&lt;/mark&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;此注解需和@Cacheable注解配合使用才有意义&lt;/p&gt;\n&lt;p&gt;作用：更新数据后缓存中相应的数据也被更新，再次查询该数据时依然是从缓存中获取(已更新)，提高了效率&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;1__466&quot;&gt;&lt;/a&gt;1. 运行流程&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;@CachePut&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;首先执行service方法，查询数据库得到数据&lt;/li&gt;\n&lt;li&gt;查询Cache（缓存组件），按照cacheNames指定的名字获取；（CacheManager先获取相应的缓存）&lt;/li&gt;\n&lt;li&gt;使用指定的key查询Cache中是否有对应数据，如果有就进行更新，没有就创建&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;2__474&quot;&gt;&lt;/a&gt;2. 详细代码&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;本方法在EmployeeServiceImpl类中&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * unless = &quot;#result == null&quot;\n     *  当返回值为null时就不进行缓存\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; employee\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt;\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@CachePut&lt;/span&gt;(key = &lt;span class=&quot;hljs-string&quot;&gt;&quot;#employee.id&quot;&lt;/span&gt;,unless = &lt;span class=&quot;hljs-string&quot;&gt;&quot;#result == null&quot;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Employee &lt;span class=&quot;hljs-title&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Employee employee)&lt;/span&gt; &lt;/span&gt;{\n        System.out.println(employee.getId());\n        UpdateWrapper&amp;lt;Employee&amp;gt; wrapper = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; UpdateWrapper&amp;lt;&amp;gt;();\n        \n        &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; i = baseMapper.updateById(employee);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (i &amp;gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;){\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; employee;\n        }\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;;\n    }\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;4_CacheEvict_500&quot;&gt;&lt;/a&gt;4. @CacheEvict注解使用&lt;/h2&gt;\n&lt;p&gt;&lt;mark&gt;请注意：&lt;/mark&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;此注解需和@Cacheable注解配合使用才有意义&lt;/p&gt;\n&lt;p&gt;作用：删除数据后缓存中相应的数据也被删除&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;1__508&quot;&gt;&lt;/a&gt;1. 运行流程&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;@CacheEvict&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;先执行service方法&lt;/li&gt;\n&lt;li&gt;如果service方法成功执行就移除指定Cache下的&lt;mark&gt;指定key&lt;/mark&gt;的数据，不成功就不进行移除操作&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;2__515&quot;&gt;&lt;/a&gt;2. 详细代码&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;本方法在EmployeeServiceImpl类中&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@CacheEvict&lt;/span&gt;(key = &lt;span class=&quot;hljs-string&quot;&gt;&quot;#id&quot;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;deleteById&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Integer id)&lt;/span&gt; &lt;/span&gt;{\n        baseMapper.deleteById(id);\n    }\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;5_Caching_527&quot;&gt;&lt;/a&gt;5. @Caching注解的使用&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;本方法在EmployeeServiceImpl类中&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;1__531&quot;&gt;&lt;/a&gt;1. 详细代码&lt;/h3&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 这里我没有具体指定缓存策略\n     * 但是我们可以看到：\n     *      使用这个注解可以同时使用&lt;span class=&quot;hljs-doctag&quot;&gt;@Cacheable&lt;/span&gt;、&lt;span class=&quot;hljs-doctag&quot;&gt;@CachePut&lt;/span&gt;和&lt;span class=&quot;hljs-doctag&quot;&gt;@CacheEvict&lt;/span&gt;注解\n     *      从而实现一些复杂的缓存策略\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; lastName\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt;\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Caching&lt;/span&gt;(cacheable = {\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Cacheable&lt;/span&gt;\n    },put = {\n            &lt;span class=&quot;hljs-meta&quot;&gt;@CachePut&lt;/span&gt;\n    },evict = {\n            &lt;span class=&quot;hljs-meta&quot;&gt;@CacheEvict&lt;/span&gt;\n    })\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Employee &lt;span class=&quot;hljs-title&quot;&gt;getByLastName&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String lastName)&lt;/span&gt; &lt;/span&gt;{\n        QueryWrapper&amp;lt;Employee&amp;gt; wrapper = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; QueryWrapper&amp;lt;&amp;gt;();\n        wrapper.eq(&lt;span class=&quot;hljs-string&quot;&gt;&quot;lastName&quot;&lt;/span&gt;,lastName);\n        Employee employee = baseMapper.selectOne(wrapper);\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; employee;\n    }\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h1&gt;&lt;a id=&quot;Cache_559&quot;&gt;&lt;/a&gt;五、Cache原理解析（深入源码）&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;这一部分主要通过对以下两方面的分析来学习SpringBoot缓存的原理&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;SpringBoot启动过程中对Cache的自动导入&lt;/li&gt;\n&lt;li&gt;@Cacheable注解的执行流程&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h2&gt;&lt;a id=&quot;1_SpringBootCache_566&quot;&gt;&lt;/a&gt;1. SpringBoot自动配置Cache原理分析&lt;/h2&gt;\n&lt;p&gt;​		根据SpringBoot的自动配置原理，我们肯定要去找一个叫做&lt;strong&gt;&times;&times;&times;AutoConfiguration&lt;/strong&gt;的类，在此就应该是&lt;mark&gt;CacheAutoConfiguration&lt;/mark&gt;自动配置类&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;CacheAutoConfiguration类截图&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144247.png&quot; alt=&quot;CacheAutoConfiguration&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;可以看到，这个类导入了一个&lt;mark&gt;CacheConfigurationImportSelector&lt;/mark&gt;类（翻译过来就是：缓存配置导入选择器），那么它导入了那些配置类呢？进入CacheConfigurationImportSelector源码进行查看&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;CacheConfigurationImportSelector源码&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/**\n	 * {&lt;span class=&quot;hljs-doctag&quot;&gt;@link&lt;/span&gt; ImportSelector} to add {&lt;span class=&quot;hljs-doctag&quot;&gt;@link&lt;/span&gt; CacheType} configuration classes.\n	 */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CacheConfigurationImportSelector&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ImportSelector&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; String[] selectImports(AnnotationMetadata importingClassMetadata) {\n        CacheType[] types = CacheType.values();\n        String[] imports = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String[types.length];\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;; i &amp;lt; types.length; i++) {\n            imports[i] = CacheConfigurations.getConfigurationClass(types[i]);\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; imports;\n    }\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;可以看到，&lt;mark&gt;CacheConfigurationImportSelector&lt;/mark&gt;通过调用&lt;mark&gt;CacheConfigurations&lt;/mark&gt;类的==getConfigurationClass()==方法拿到需要导入的配置类的名单（封装配置类全限定名的String数组）&lt;/p&gt;\n&lt;p&gt;我们通过debug模式查看导入的配置类有哪些：&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144249.png&quot; alt=&quot;imports&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;一共导入了10个缓存配置类，包括&lt;mark&gt;RedisCacheConfiguration&lt;/mark&gt;、&lt;mark&gt;SimpleCacheConfiguration&lt;/mark&gt;等，这其中有许多是用来自动配置一些缓存中间件的，比如&lt;mark&gt;RedisCacheConfiguration&lt;/mark&gt;，当Redis的依赖被引入时，这个配置类就会生效，帮我们自动配置使用Redis实现缓存技术。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;关于SpringBoot集成redis实现缓存的操作以及原理，我将在另一篇博客中进行具体介绍。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;那么在我们没有使用任何缓存中间件的情况下，SpringBoot默认使用哪个缓存配置类呢？&lt;/p&gt;\n&lt;p&gt;我们关闭程序，在yml（或者properties）文件中配置以debug级别打印日志，然后启动&lt;/p&gt;\n&lt;pre&gt;&lt;code class=&quot;lang-yaml&quot;&gt;debug: true\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144252.png&quot; alt=&quot;debug&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;通过日志信息我们知道了：SpringBoot自动帮我们注入了&lt;mark&gt;SimpleCacheConfiguration&lt;/mark&gt;配置类&lt;/p&gt;\n&lt;p&gt;&lt;mark&gt;SimpleCacheConfiguration&lt;/mark&gt;配置类帮我们配置了哪些内容呢？我们通过他的源码来分析：&lt;/p&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * Simplest cache configuration, usually used as a fallback.\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; Stephane Nicoll\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Configuration&lt;/span&gt;(proxyBeanMethods = &lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;)\n&lt;span class=&quot;hljs-meta&quot;&gt;@ConditionalOnMissingBean&lt;/span&gt;(CacheManager.class)\n&lt;span class=&quot;hljs-meta&quot;&gt;@Conditional&lt;/span&gt;(CacheCondition.class)\n&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;SimpleCacheConfiguration&lt;/span&gt; &lt;/span&gt;{\n\n	&lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;\n	&lt;span class=&quot;hljs-function&quot;&gt;ConcurrentMapCacheManager &lt;span class=&quot;hljs-title&quot;&gt;cacheManager&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(CacheProperties cacheProperties,\n			CacheManagerCustomizers cacheManagerCustomizers)&lt;/span&gt; &lt;/span&gt;{\n		ConcurrentMapCacheManager cacheManager = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ConcurrentMapCacheManager();\n		List&amp;lt;String&amp;gt; cacheNames = cacheProperties.getCacheNames();\n		&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!cacheNames.isEmpty()) {\n			cacheManager.setCacheNames(cacheNames);\n		}\n		&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; cacheManagerCustomizers.customize(cacheManager);\n	}\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;可以看到，他帮我们注册了一个&lt;strong&gt;cacheManager&lt;/strong&gt;(缓存管理器) --&amp;gt; &lt;mark&gt;ConcurrentMapCacheManager&lt;/mark&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;经过前面的学习，我们知道，一个&lt;strong&gt;cacheManager&lt;/strong&gt;管理多个&lt;strong&gt;Cache&lt;/strong&gt;，在这里SpringBoot帮我们自动注册了一个&lt;strong&gt;cacheManager&lt;/strong&gt;&ndash;&amp;gt;  &lt;mark&gt;ConcurrentMapCacheManager&lt;/mark&gt;，那么我们可以大胆推测：之后的缓存操作都将使用&lt;mark&gt;ConcurrentMapCacheManager&lt;/mark&gt;这个类。事实上正是如此，我们将在对**@Cacheable**注解的分析中来证实这一点。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2&gt;&lt;a id=&quot;2_ConcurrentMapCachemanager_650&quot;&gt;&lt;/a&gt;2. ConcurrentMapCachemanager类分析&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;源码过长，在此只针对部分代码进行分析。小伙伴们可自行&lt;mark&gt;点开源码结合博客一起食用&lt;/mark&gt;。&lt;/p&gt;\n&lt;p&gt;如果你看到这一部分感到吃力，请结合**@Cacheable注解原理分析**一起食用&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;1_Cache_656&quot;&gt;&lt;/a&gt;1. 获取Cache的方法&lt;/h3&gt;\n&lt;p&gt;&lt;mark&gt;ConcurrentMapCachemanager&lt;/mark&gt;类中有一个方法用来通过Cache的名称来获取Cache。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;源码如下&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 非源码注释\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; name cache名称，即由cacheNames和value属性指定的那个名称\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt; 如果不存在指定Cache，就根据名称创建Cache。如果存在，就返回该Cache\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Nullable&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Cache &lt;span class=&quot;hljs-title&quot;&gt;getCache&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String name)&lt;/span&gt; &lt;/span&gt;{\n        Cache cache = &lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.cacheMap.get(name);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (cache == &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.dynamic) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.cacheMap) {\n                cache = &lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.cacheMap.get(name);\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (cache == &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;) {\n                    cache = createConcurrentMapCache(name);&lt;span class=&quot;hljs-comment&quot;&gt;//其实就是创建了一个Map集合，后面会讲到&lt;/span&gt;\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.cacheMap.put(name, cache);\n                }\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; cache;\n    }\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;​		通过这个方法我们可以知道：cache是被存储在&lt;mark&gt;ConcurrentMapCachemanager&lt;/mark&gt;类中的&lt;mark&gt;cacheMap&lt;/mark&gt;属性中的，那这个&lt;mark&gt;cacheMap&lt;/mark&gt;具体是什么呢？我们继续来查看源码。&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144256.png&quot; alt=&quot;ConcurrentMap&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;​		在&lt;mark&gt;ConcurrentMapCachemanager&lt;/mark&gt;类中找到这个属性后，我们发现他就是一个HashMap集合！&lt;/p&gt;\n&lt;p&gt;由此我们可以得出结论：&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;mark&gt;ConcurrentMapCachemanager&lt;/mark&gt;默认使用一个HashMap集合来实现缓存。在这个集合中：&lt;mark&gt;key&lt;/mark&gt;就是&lt;mark&gt;Cache的名称&lt;/mark&gt;，&lt;mark&gt;value&lt;/mark&gt;就是&lt;mark&gt;具体的Cache&lt;/mark&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;2_Cache_695&quot;&gt;&lt;/a&gt;2. 创建Cache的方法&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;createConcurrentMapCache(String name)方法源码：&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;	&lt;span class=&quot;hljs-comment&quot;&gt;/**\n	 * Create a new ConcurrentMapCache instance for the specified cache name.\n	 * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; name the name of the cache\n	 * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt; the ConcurrentMapCache (or a decorator thereof)\n	 */&lt;/span&gt;\n	&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; Cache &lt;span class=&quot;hljs-title&quot;&gt;createConcurrentMapCache&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String name)&lt;/span&gt; &lt;/span&gt;{\n		SerializationDelegate actualSerialization = (isStoreByValue() ? &lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.serialization : &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n		&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ConcurrentMapCache(name, &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;&amp;gt;(&lt;span class=&quot;hljs-number&quot;&gt;256&lt;/span&gt;), isAllowNullValues(), actualSerialization);\n	}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;我们可以看到在这里，Cache其实是用的是：&lt;mark&gt;ConcurrentMapCache&lt;/mark&gt;实现类。那我们继续来分析&lt;mark&gt;ConcurrentMapCache&lt;/mark&gt;源码&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144301.png&quot; alt=&quot;ConcurrentMapCache&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;这里我们重点来关注这个&lt;mark&gt;store&lt;/mark&gt;属性，其实他存储的就是我们前面所说的&lt;mark&gt;Entry&lt;/mark&gt;&lt;/p&gt;\n&lt;p&gt;至此，我们就可以明白SpringBoot默认使用的Cache实现机制了，下面我用一幅图来展现以上这两个类的关系（&lt;mark&gt;ConcurrentMapCachemanager&lt;/mark&gt;和&lt;mark&gt;ConcurrentMapCache&lt;/mark&gt;）&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144301.png&quot; alt=&quot;SpringBoot默认Cache缓存原理详解&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;在这里，我们使用的缓存管理器就是&lt;mark&gt;ConcurrentMapCachemanager&lt;/mark&gt;，而具体的缓存接口实现类就是&lt;mark&gt;ConcurrentMapCache&lt;/mark&gt;。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;这两个类中还有其他方法未做讲解。有一部分会在**@Cacheable注解原理分析**中进行讲解，而另一部分则不再赘述。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2&gt;&lt;a id=&quot;3_Cacheable_725&quot;&gt;&lt;/a&gt;3. @Cacheable注解原理分析&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1_cache_727&quot;&gt;&lt;/a&gt;1. 尝试获取cache&lt;/h3&gt;\n&lt;p&gt;​		在之前使用此注解的时候，我们提到他会先查询Cache(缓存组件)，所以这个注解肯定会首先调用&lt;mark&gt;ConcurrentMapCachemanager&lt;/mark&gt;类中的&lt;mark&gt;getCache&lt;/mark&gt;方法，我们为这个方法打上断点，进行调试。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;补充：这里我使用Swagger接口文档对获取employee的接口进行了调用（还是上面的测试项目）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;../img/getCache.png&quot; alt=&quot;getCache&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;可以看到，@Cacheable注解调用了这个方法，并使用我们指定的&lt;mark&gt;cacheName&lt;/mark&gt;（employee）去查询是否存在这个Cache（缓存组件）。由于是第一次调用，所以缓存中是肯定没有这个Cache的，它将为我创建一个名为&lt;strong&gt;employee&lt;/strong&gt;的缓存组件。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;点击下一步，正如我们预测的，它创建了这个cache&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;../img/createConcurrentMapCache.png&quot; alt=&quot;createConcurrentMapCache&quot; /&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;至此，获取缓存组件的过程就结束了。接下来根据我们之前对@Cacheable执行过程的分析，他将会使用我们指定的&lt;mark&gt;key&lt;/mark&gt;（在这里就是员工的id）来获取对应的value。在&lt;mark&gt;ConcurrentMapCache&lt;/mark&gt;类中有一个对应的方法：&lt;mark&gt;lookup(Object key)&lt;/mark&gt;。建议提前为其打上断点！&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;2_keycache_743&quot;&gt;&lt;/a&gt;2. 使用指定key在cache中查找数据&lt;/h3&gt;\n&lt;p&gt;我们对程序进行放行，得到：&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;../img/lookup.png&quot; alt=&quot;lookup&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;​		由于这是第一次调用，所以缓存中肯定是没有这个数据的。此时@Cacheable注解将会调用service方法，获取数据&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;我们继续放行&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;../img/%E8%B0%83%E7%94%A8service%E6%96%B9%E6%B3%95.png&quot; alt=&quot;调用service方法&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;3_cache_755&quot;&gt;&lt;/a&gt;3. 将数据添加到cache中（缓存中没有对应数据时执行）&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;添加数据（&lt;mark&gt;Entry&lt;/mark&gt;）的操作将会调用&lt;mark&gt;ConcurrentMapCache&lt;/mark&gt;类中的==put(Object key, @Nullable Object value)==方法，建议提前打上断点&lt;/p&gt;\n&lt;p&gt;继续放行&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144314.png&quot; alt=&quot;put&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;这样，查询得到的数据就被添加到缓存中了。下次调用就会直接从缓存中获取数据而不用再次调用service方法&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;4_Cacheable_765&quot;&gt;&lt;/a&gt;4. @Cacheable注解执行流程图&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144316.png&quot; alt=&quot;@Cacheable执行流程&quot; /&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;如有不当之处，请各位指教&lt;/p&gt;\n&lt;p&gt;转载请注明出处&lt;/p&gt;\n&lt;/blockquote&gt;\n',0,0,'2021-03-29 21:32:50','2021-03-29 21:32:50',0),('1376528283254898689','1369634113126825985','RabbitMQ基础学习','# RabbitMQ基础学习\n\n> 参考资料：黑马RabbitMQ\n\n# 一、 消息队列概述\n\n## 1. 什么是消息中间件\n\n​		MQ全称为Message Queue，消息队列是应用程序和应用程序之间的通信方法。消息队列是一种异步的服务间通信方式，适用于无服务器和微服务架构。消息在被处理和删除之前一直存储在队列上。每条消息仅可被一位用户处理一次。消息队列可被用于分离重量级处理、缓冲或批处理工作以及缓解高峰期工作负载。是一种典型的生产者-消费者模型。\n\n## 2. 为什么使用消息中间件\n\n​		在项目中，可将一些无需即时返回且耗时的操作提取出来，进行**异步处理**，而这种异步处理的方式大大的节省了服务器的请求响应时间，从而**提高**了**系统**的**吞吐量**。\n\n## 3. MQ常用应用场景\n\n### 1. 任务异步处理\n\n​		将不需要同步处理的并且耗时长的操作由消息队列通知消息接收方进行异步处理。提高了应用程序的响应时间。\n\n### 2. 应用程序解耦合\n\n​		MQ相当于一个中介，生产方通过MQ与消费方交互，它将应用程序进行解耦合。\n\n### 3. 削峰填谷\n\n​		如订单系统，在下单的时候就会往数据库写数据。但是数据库只能支撑每秒1000左右的并发写入，并发量再高就容易宕机。低峰期的时候并发也就100多个，但是在高峰期时候，并发量会突然激增到5000以上，这个时候数据库肯定卡死了。此时，我们可以采用MQ来进行**削峰填谷**，具体就是：\n​		由MQ来将消息存储起来，服务器根据自己的处理能力慢慢处理，这样，服务器就不会因为突发的高并发访问而挂掉了。**削峰**：高并发时期的处理请求被保存，没有立即执行。**填谷**：高并发后，服务器慢慢处理MQ保存的请求。\n\n- 使用MQ前\n\n![削峰填谷前](https://gitee.com/yezio/images/raw/master/img/20210112144011.jpg)\n\n- 使用MQ后\n\n![削峰填谷后](https://gitee.com/yezio/images/raw/master/img/20210112144016.jpg)\n\n- **削峰填谷**图解\n\n![03](https://gitee.com/yezio/images/raw/master/img/20210112144022.jpg)\n\n## 4. AMQP 和 JMS\n\n​		MQ是消息通信的模型；实现MQ的大致有两种主流方式：AMQP、JMS。\n\n### 1. AMQP\n\n​		AMQP是一种协议，更准确的说是一种binary wire-level protocol（链接协议）。这是其和JMS的**本质差别**，AMQP不从API层进行限定，而是直接定义网络交换的数据格式。\n\n### 2. JMS\n\n​	JMS即Java消息服务（JavaMessage Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。\n\n### 3. AMQP 和 JMS 的区别\n\n- JMS是定义了统一的接口，来对消息操作进行统一；AMQP是通过规定协议来统一数据交互的格式\n- JMS限定了必须使用Java语言；AMQP只是协议，不规定实现方式，因此是跨语言的。\n- JMS规定了两种消息模式；而AMQP的消息模式更加丰富\n\n## 5. 常见的MQ产品\n\n目前市场上常见的消息队列产品如下：\n\n- ActiveMQ：基于JMS\n- ZeroMQ：基于C语言开发\n- RabbitMQ：基于AMQP协议，erlang语言开发，稳定性好\n- RocketMQ：基于JMS，阿里巴巴产品\n- Kafka：类似MQ的产品；分布式消息系统，高吞吐量\n\n## 6. RabbitMQ\n\n​		RabbitMQ是由erlang语言开发，基于AMQP（Advanced Message Queue 高级消息队列协议）协议实现的消息队列，它是一种应用程序之间的通信方法，消息队列在分布式系统开发中应用非常广泛。\n\n> [RabbitMQ官方地址]: http://www.rabbitmq.com/\n\nRabbitMQ提供了6种模式：\n\n- 基本消息模型\n- work工作模式\n- publish/subscribe（发布/订阅模式，也称 广播模式）\n- routing（路由模式）\n- Topics（通配符模式）\n- RPC远程调用模式（暂不作记录）\n\n> [官网对应模式介绍]: https://www.rabbitmq.com/getstarted.html\n\n# 二、安装及配置RabbitMQ\n\n> [参考博客]: https://blog.csdn.net/qq_39246334/article/details/109486441?biz_id=102&amp;utm_term=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85RabbitMQ&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-109486441&amp;spm=1018.2118.3001.4449\n>\n> \n\n# 三、RabbitMQ六种工作模式\n\n## 入门项目搭建\n\n### 1. 创建项目\n\n​		分别创建两个项目，一个作为生产者，一个作为消费者。项目结构如下：\n\n![RabbitMQ入门环境搭建](https://gitee.com/yezio/images/raw/master/img/20210112144027.png)\n\n### 2. 导入依赖\n\n> 在两个项目中分别导入以下依赖\n\n```xml\n    <dependency>\n        <groupId>com.rabbitmq</groupId>\n        <artifactId>amqp-client</artifactId>\n        <version>5.7.1</version>\n    </dependency>\n```\n\n### 3. 编写获取连接工具类\n\n> 两个工程都需要这个工具类，复制一份即可\n\n```java\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n\n/**\n * @author 叶子\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.util\n * @Data 2020/11/19 星期四 14:49\n */\npublic class ConnectionUtil {\n    /**\n     * RabbitMQ主机地址\n     */\n    private static final String HOSt = \"Linux主机地址\";\n    /**\n     * 端口\n     */\n    private static final Integer PORT = 5672;\n    /**\n     * 虚拟机\n     * 一个RabbitMQ服务可以设置多个虚拟机\n     */\n    private static final String VIRTUALHOST = \"/test\";\n    /**\n     * 用户名\n     */\n    private static final String USERNAME = \"叶子\";\n    /**\n     * 密码\n     */\n    private static final String PASSWORD = \"yezi\";\n\n\n    /**\n     * 创建连接\n     * @return\n     * @throws Exception\n     */\n    public static Connection getConnection(){\n        ConnectionFactory factory = new ConnectionFactory();\n\n        factory.setHost(HOSt);\n        factory.setPort(PORT);\n        factory.setVirtualHost(VIRTUALHOST);\n        factory.setUsername(USERNAME);\n        factory.setPassword(PASSWORD);\n        Connection connection = null;\n        try {\n            connection = factory.newConnection();\n        } catch (IOException e) {\n            e.printStackTrace();\n        } catch (TimeoutException e) {\n            e.printStackTrace();\n        }\n\n        return connection;\n    }\n}\n\n```\n\n注意导包是否正确！！！\n\n## 1. 基本消息模型（简单模式）\n\n### 1. 官网图解\n\n![基本消息模型](https://gitee.com/yezio/images/raw/master/img/20210112144034.png)\n\n- ==P== ：生产者\n- 红格：消息队列\n- ==C== ：消费者\n\n### 2. 处理流程\n\n1. 生产者向消息队列发送消息\n2. 消费者通过监听指定消息队列获取消息\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n\n/**\n * 演示基本消息模型\n * 案例：\n *      叶子给A用户发了一条私聊消息\n *\n *  基本消息模型：\n *      组成：\n *          1. 一个生产者\n *          2. 一个消费者\n *          3. 一个消息队列\n *      生产者 和 消费者 通过消息队列进行消息处理\n *      这个模型实际上使用了默认的交换机\n *\n * 这里使用的是部署在阿里云上的RabbitMQ服务，所以记得开放使用到的端口！！！\n *  启动这个类后可以在RabbitMQ控制面板上看到一个新的消息队列\n *\n * @author 叶子\n * @Description 基本消息模型-生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.basic\n * @Data 2020/11/19 星期四 15:02\n */\npublic class BasicProducer {\n    private static final String QUEUE_NAME = \"basic_test\";\n    private static final String MESSAGE = \"Hello,RabbitMQ!\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建连接通道，只有使用通道才能完成消息相关操作\n        Channel channel = conn.createChannel();\n        /**\n         * ③ 声明消息队列，假如没有这个消息队列，就会自动创建\n         * queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. durable 是否持久化（关闭后消息不丢失）\n         *      3. exclusive 是否独占连接，队列只允许在该连接中访问，如果connection连接关闭队列则自动删除,如果将此参数设置true可用于临时队列的创建\n         *      4. autoDelete 是否自动删除，队列不再使用时是否自动删除此队列，如果将此参数和exclusive参数设置为true就可以实现临时队列（队列不用了就自动删除）\n         *      5. arguments 参数，可以设置一个队列的扩展参数，比如：可设置存活时间\n         */\n        channel.queueDeclare(QUEUE_NAME,false,false,true,null);\n\n        /**\n         * ④ 向指定消息队列中发送消息\n         * basicPublish(String exchange, String routingKey, boolean mandatory, boolean immediate, BasicProperties props, byte[] body)\n         * 参数说明：\n         *      1. exchange 指定交换机名称，如果不指定将使用mq的默认交换机（需要设置为\"\"）\n         *      2. routingKey 指定路由key，交换机根据路由key来将消息转发到指定的队列，如果使用默认交换机，routingKey设置为队列的名称\n         *      3. mandatory\n         *      4. immediate\n         *      5. props 消息属性\n         *      6. body 要发送的消息\n         *\n         * 注意：\n         *  1. 这里使用的是basicPublish方法的重载形式，只需要参数 1 2 5 6\n         *  2. 使用默认交换机，所以交换机名称设置为 \"\"\n         *  3. 使用默认交换机，所以路由key设置为队列名称\n         */\n        channel.basicPublish(\"\",QUEUE_NAME,null,MESSAGE.getBytes());\n\n        // ⑤ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n#### 2. 消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * 启动这个类后，可以在RabbitMQ控制台的Channels项下看到一个新的Channel\n *\n * @author 叶子\n * @Description 基本消息模型-消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.basic\n * @Data 2020/11/19 星期四 15:51\n */\npublic class BasicConsumer {\n    private static final String QUEUE_NAME = \"basic_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建连接通道，没有通道就无法进行消息处理\n        Channel channel = conn.createChannel();\n\n        /**\n         * ③ 声明消息队列\n         *      假如没有指定消息队列，就会自动创建\n         *      如果生产者已经创建了指定队列，就可以不在此处进行声明\n         * 此处不再进行声明\n         *\n         * 注意：\n         *  如果在生产者中声明了队列，而在消费者中没有声明队列\n         *  那么，不要先启动消费者，否则会因为不存在指定队列而抛出异常\n         */\n\n        // ④ 重写处理消息的方法（消费方法）\n        Consumer consumer = new DefaultConsumer(channel){\n            /**\n             * 消费方法\n             * @param consumerTag 消费者标签，用来标识消费者\n             * @param envelope 信封 封装了DeliveryTag、exchange(交换机)、RoutingKey(路由key) 三个信息\n             * @param properties 消息属性，这里生产者没有进行设置，所以很多为null\n             * @param body 接收的消息\n             * @throws IOException\n             */\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"consumerTag--->\"+consumerTag);\n                System.out.println(\"DeliveryTag--->\"+envelope.getDeliveryTag());\n                // 交换机\n                System.out.println(\"exchange------>\"+envelope.getExchange());\n                //路由key\n                System.out.println(\"RoutingKey---->\"+envelope.getRoutingKey());\n                System.out.println(\"properties---->\"+properties);\n                System.out.println(\"接受的消息是--->\"+new String(body));\n            }\n        };\n\n        /**\n         * ⑤ 设置监听队列\n         * 参数明细：\n         * 1、queue 队列名称\n         * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n         * 3、callback，消费方法，当消费者接收到消息要执行的方法\n         */\n        channel.basicConsume(QUEUE_NAME,true,consumer);\n\n        /**\n         * 注意：\n         *  消费者要一直监听生产者的动作，所以在此不要关闭连接！\n         *  不要关闭连接！\n         */\n    }\n}\n\n```\n\n## 2. Work工作模式\n\n#### 1. 官网图解\n\n![Work工作模式](https://gitee.com/yezio/images/raw/master/img/20210112144041.png)\n\n#### 2. 处理流程\n\n1. 生产者向消息队列发送消息\n2. 多个消费者通过监听同一个指定的消息队列获取消息\n\n注意：这些消费者之间是竞争关系！\n\n#### 3. 应用\n\n可以通过创建多个消费者的方式提高消息处理效率。\n\n#### 4. 代码编写\n\n##### 1. 生产者\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示Work工作模式\n *  案例：\n *      叶子在游戏上发布了一系列任务，任务完成数量越多，奖励越多\n *\n * Work工作模式\n *  组成：一个生产者 + 多个消费者 + 一个消息队列\n *  多个消费者共同竞争一个消息队列中待处理的消息，提高了处理效率\n *\n * @author 叶子\n * @Description Work模式-生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.work\n * @Data 2020/11/19 星期四 17:24\n */\npublic class WorkProducer {\n    private static final String QUEUE_NAME = \"work_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n        channel.queueDeclare(QUEUE_NAME,false,false,true,null);\n        // ④ 发送多条消息\n        for (int i = 1; i <= 20; i++) {\n            String message = \"第\" + i + \"条消息\";\n            channel.basicPublish(\"\",QUEUE_NAME,null,message.getBytes());\n        }\n\n        // ⑤ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n##### 2. 两个消费者\n\n> ①号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description Work模式-①号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.work\n * @Data 2020/11/19 星期四 17:34\n */\npublic class WorkConsumer1 {\n    private static final String QUEUE_NAME = \"work_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"一号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME,true,consumer);\n    }\n}\n\n```\n\n> ②号消费者\n\n````java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description Work模式-②号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.work\n * @Data 2020/11/19 星期四 17:39\n */\npublic class WorkConsumer2 {\n    private static final String QUEUE_NAME = \"work_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"二号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME,true,consumer);\n    }\n}\n````\n\n## 3. Publish/Subscribe（发布/订阅模式，也称 广播模式）\n\n### 1. 官网图解\n\n![PublishSubscribe](https://gitee.com/yezio/images/raw/master/img/20210112144047.png)\n\n### 2. 处理流程\n\n1. 创建交换机 + 声明队列\n\n2. 交换机绑定队列 （泛式绑定，没有指定路由key）\n\n3. 生产者发送消息给交换机，交换机将消息转发给所有绑定的消息队列\n\n4. 消费者通过监听消息队列获取消息\n\n   ​	因为在这里消息会被同等转发给所有消息队列，不存在差异（即部分消息队列可以收到消息，部分收不到），类似于广播，所以被称为**广播/订阅模式**。\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n```java\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示发布/订阅模式（广播模式）\n *  案例：\n *      叶子的个人博客更新时，所有订阅用户都会收到推送\n * 发布/订阅 模式\n * 组成：\n *      1. 一个交换机，类型为 fanout\n *      2. 多个消息队列 ，和交换机进行绑定（routingKey 设置为 \"\"）\n *      3. 多个消费者\n * 信息发送给交换机，交换机将信息转发给所有绑定的消息队列，所有 \"订阅\" 绑定消息队列的消费者都能接收到消息\n * 注意：\n *      1. 这里的 消息队列和交换机 之间属于任意绑定模式，不存在路由分发，所以所有绑定的消息队列可以接收到相同消息\n *      2. 路由模式采用路由分发的方式实现：不同的信息交给不同的消息队列\n *\n * 尚不了解的问题：\n *      1. 订阅者处理消息是否有先后顺序，能否同时处理同一个消息？\n * @author 叶子\n * @Description 发布/订阅模式 - 生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.publish_subscribe\n * @Data 2020/11/19 星期四 18:23\n */\npublic class PublishProducer {\n    private static final String EXCHANGE_NAME = \"exchange_fanout\";\n    private static final String QUEUE_NAME_1 = \"fanout_test_1\";\n    private static final String QUEUE_NAME_2 = \"fanout_test_2\";\n    private static final String MESSAGE = \"叶子博客更新了！\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n\n        /**\n         * ③ 声明exchange（交换机），指定类型为fanout\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);\n\n        // ④ 声明队列\n        channel.queueDeclare(QUEUE_NAME_1,false,false,true,null);\n        channel.queueDeclare(QUEUE_NAME_2,false,false,true,null);\n\n        /**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 \"\"\n         *      4. arguments 参数\n         */\n        channel.queueBind(QUEUE_NAME_1,EXCHANGE_NAME,\"\");\n        channel.queueBind(QUEUE_NAME_2,EXCHANGE_NAME,\"\");\n\n        /**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */\n        channel.basicPublish(EXCHANGE_NAME,\"\",null,MESSAGE.getBytes());\n        // ⑥ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n#### 2. 两个消费者\n\n> ①号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 发布/订阅模式 - ①号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * @Data 2020/11/19 星期四 18:53\n */\npublic class SubscribeConsumer1 {\n    private static final String QUEUE_NAME_1 = \"fanout_test_1\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"一号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_1,true,consumer);\n    }\n}\n```\n\n> ②号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 发布/订阅模式 - ②号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * @Data 2020/11/19 星期四 18:53\n */\npublic class SubscribeConsumer2 {\n    private static final String QUEUE_NAME_2 = \"fanout_test_2\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"二号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_2,true,consumer);\n    }\n}\n```\n\n## 4. Routing（路由模式）\n\n### 1. 官网图解\n\n![Routing](https://gitee.com/yezio/images/raw/master/img/20210112144054.png)\n\n### 2. 处理流程\n\n1. 创建交换机 + 消息队列\n2. 交换机通过不同的 ==routingkey== 绑定到不同的消息队列（路由key）\n3. 生产者将消息发送给交换机，指定 ==routingkey==\n4. 交换机通过 ==routingkey== 确定将消息发送给哪些消息队列\n5. 不同消费者通过监听不同消息队列可能收到不同的消息\n\n核心：**依据 routingkey 实现了消息的选择性发送**\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n````java\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示路由模式：\n *  案例：\n *      叶子开辟了个人的付费专栏，该专栏发布的博客只有VIP用户可以查看\n *      免费博客所有人都可以查看\n *\n * 路由模式：\n *  组成：\n *      1. 一个生产者\n *      2. 一个交换机\n *      3. 多个消息队列 （通过不同的routingKey绑定到交换机上）\n *      4. 多个消费者\n *  流程分析：\n *      1. 生产者发送消息时指定交换机+routingKey\n *      2. 交换机根据 routingKey 将消息发送到对应的消息队列\n *      3. 消费者接收绑定消息队列的消息\n *  核心：根据 routingKey 实现路由分发\n *      消息指定的 routingKey 和消息队列绑定的 routingKey 匹配时，该消息队列才能收到该消息\n *\n * @author 叶子\n * @Description 路由模式 - 生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.routing\n * @Data 2020/11/19 星期四 19:28\n */\npublic class RoutingProducer {\n    private static final String EXCHANGE_NAME = \"exchange_direct\";\n\n    private static final String QUEUE_NAME_USER = \"direct_user\";\n    private static final String QUEUE_NAME_USER_VIP = \"direct_user_vip\";\n\n    private static final String ROUTING_KEY_USER = \"user\";\n    private static final String ROUTING_KEY_USER_VIP = \"user_vip\";\n\n    private static final String MESSAGE_USER = \"叶子的免费博客！\";\n    private static final String MESSAGE_USER_VIP = \"叶子的vip付费专栏博客！\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n\n        /**\n         * ③ 声明exchange（交换机），指定类型为direct\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n\n        // ④ 声明队列\n        channel.queueDeclare(QUEUE_NAME_USER,false,false,true,null);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,false,false,true,null);\n\n        /**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 \"\"\n         *      4. arguments 参数\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         */\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        /**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,null,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,null,MESSAGE_USER_VIP.getBytes());\n        // ⑥ 关闭连接\n        channel.close();\n        conn.close();\n    }\n\n}\n\n````\n\n#### 1. 两个消费者\n\n> ①号消费者\n\n````java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 路由模式 - ①号消费者（普通用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class RoutingConsumerUser {\n    private static final String QUEUE_NAME_USER = \"direct_user\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"普通用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER,true,consumer);\n    }\n}\n\n````\n\n> ②号消费者\n\n````java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 路由模式 - ②号消费者（VIP用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class RoutingConsumerUserVip {\n    private static final String QUEUE_NAME_USER_VIP = \"direct_user_vip\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"VIP用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER_VIP,true,consumer);\n    }\n}\n````\n\n## 5. topic（通配符模式）\n\n### 1. 官网图解\n\n![topic](https://gitee.com/yezio/images/raw/master/img/20210112144101.png)\n\n### 2. 处理流程\n\ntopic的处理流程和routing的处理流程其实差不多，只是topic的 ==routingkey== 使用了更强大、更灵活的通配符\n\n- ==*== ：恰好匹配一个**单词**\n- ==#== ：匹配一个或多个**单词**\n\n例如：*.user 可以匹配 admin.user 但不能匹配 vip.admin.user。  而 #.user 就可以匹配。\n\n1. 创建交换机 + 消息队列\n2. 交换机通过不同的 ==routingkey== 绑定到不同的消息队列（路由key）\n3. 生产者将消息发送给交换机，指定 ==routingkey==\n4. 交换机通过 ==routingkey== 确定将消息发送给哪些消息队列\n5. 不同消费者通过监听不同消息队列可能收到不同的消息\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n```java\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示通配符模式\n * 实现routing模式的案例\n *\n * 其实通配符和路由模式都是基于路由分发实现的，只是通配符模式引入了两个通配符\n * 使用起来更加方便，功能更强大\n *\n * @author 叶子\n * @Description 通配符匹配模式 - 生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.topic\n * @Data 2020/11/19 星期四 20:12\n */\npublic class TopicProducer {\n    private static final String EXCHANGE_NAME = \"topic.direct\";\n\n    private static final String QUEUE_NAME_USER = \"topic.user\";\n    private static final String QUEUE_NAME_USER_VIP = \"topic.user.vip\";\n\n    private static final String ROUTING_KEY_USER = \"*.user\";    //可以匹配到普通用户和VIP用户\n    private static final String ROUTING_KEY_USER_VIP = \"#.vip\"; //只能匹配到VIP用户\n\n    private static final String MESSAGE_USER = \"叶子的免费博客！\";\n    private static final String MESSAGE_USER_VIP = \"叶子的vip付费专栏博客！\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n\n        // ③ 声明exchange（交换机），指定类型为topic\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);\n\n        // ④ 声明队列\n        channel.queueDeclare(QUEUE_NAME_USER,false,false,true,null);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,false,false,true,null);\n\n        /**\n         * ⑤ 队列绑定交换机\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         *\n         *  * 恰好匹配一个单词\n         *  # 匹配一个及以上的单词\n         */\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        /**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,null,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,null,MESSAGE_USER_VIP.getBytes());\n        // ⑥ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n### 2. 两个消费者\n\n> ①号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 通配符匹配模式 - ①号消费者（普通用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class TopicConsumerUser {\n    private static final String QUEUE_NAME_USER = \"topic.user\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"普通用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER,true,consumer);\n    }\n}\n```\n\n>②号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 通配符匹配模式 - ②号消费者（VIP用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class TopicConsumerUserVip {\n    private static final String QUEUE_NAME_USER_VIP = \"topic.user.vip\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"VIP用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER_VIP,true,consumer);\n    }\n}\n```\n\n## 6. **工作模式总结**\n\n### 1. 分类\n\n其实，依据前面的介绍，我们可以将5种工作模式大致分为两类：\n\n- 非路由模式\n\n  1. 基本消息模型\n  2. work工作模式\n- 路由模式\n  1. Publish/subscribe\n  2. routing\n  3. topic\n\n> 非路由模式和路由模式的区别\n\n1. 非路由模式不使用交换机，直接向消息队列发送消息（其实内部使用了默认的交换机）。而路由模式使用交换机，信息发送给交换机，由交换机负责转发给消息队列\n2. 非路由模式会将消息发给所有绑定的监听队列，而路由模式会由交换机根据==rongtingkey==来确定将消息发送给哪个消息队列。即：就消息发送而言**路由模式具有选择差异性**（Publish/subscribe除外，它使用了默认的==rongtingkey==，也是将消息推送给所有绑定的消息队列）\n3. 路由模式由于使用了==rongtingkey==分发模式而更加灵活\n\n# 四、SpringBoot整合RabbitMQ\n\n## 1. 项目搭建\n\n> 分别创建两个Spring Boot项目，一个作为生产者，一个作为消费者\n\n![SpringBootxiao消息队列](https://gitee.com/yezio/images/raw/master/img/20210112144109.png)\n\n> 导入依赖\n\n````xml\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-amqp</artifactId>\n</dependency>\n````\n\n## 2. 编写生产者代码\n\n> yml文件配置\n\n```yaml\nspring:\n  rabbitmq:\n    host: 主机IP地址\n    port: 5672\n    username: 叶子\n    password: 密码\n    virtual-host: /test\n```\n\n> RabbitMQ配置类\n\n```java\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author 叶子\n * @Description RabbitMQ - 生产者配置类\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.producer.conig\n * @Data 2020/11/20 星期五 16:07\n */\n@Configuration\npublic class RabbitMQConfig {\n    public static final String EXCHANGE = \"boot.exchange\";\n    private static final String QUEUE = \"boot.queue\";\n\n    @Bean(name = EXCHANGE)\n    public Exchange exchange(){\n        return ExchangeBuilder.topicExchange(EXCHANGE).durable(false).autoDelete().build();\n    }\n\n    @Bean(name = QUEUE)\n    public Queue queue(){\n        return QueueBuilder.durable(QUEUE).build();\n    }\n\n    @Bean\n    public Binding binding(@Qualifier(EXCHANGE) Exchange exchange, @Qualifier(QUEUE) Queue queue){\n        return BindingBuilder.bind(queue).to(exchange).with(\"vip.*\").noargs();\n    }\n\n}\n```\n\n> 在测试类中进行测试\n\n````java\n@SpringBootTest\nclass ProducerApplicationTests {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @Test\n    void contextLoads() {\n        rabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE,\"vip.user\",\"Hello,SpringBoot and RabbitMQ!\");\n    }\n\n}\n````\n\n## 3. 编写消费者代码\n\n> yml文件配置和生产者一样\n\n> 编写消息队列监听类\n\n````java\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author 叶子\n * @Description RabbitMQ - 消息队列监听类\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.consumer.listener\n * @Data 2020/11/20 星期五 16:20\n */\n@Component\npublic class RabbitMQListener {\n\n    @RabbitListener(queues = \"boot.queue\")\n    public void listenerQueue(Message message){\n        System.out.println(new String(message.getBody()));\n    }\n}\n````\n\n注意：消费者可以不添加配置类\n\n## 4. 总结\n\n- 生产者\n\n1. 配置yml文件\n2. 编写配置类\n3. 编写测试类\n\n- 消费者\n\n1. 配置yml文件\n2. 编写消息队列监听类\n\n> 入门学习笔记，如有错误，请于评论区指出，非常感谢！','&lt;h1&gt;&lt;a id=&quot;RabbitMQ_0&quot;&gt;&lt;/a&gt;RabbitMQ基础学习&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;参考资料：黑马RabbitMQ&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h1&gt;&lt;a id=&quot;__4&quot;&gt;&lt;/a&gt;一、 消息队列概述&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;1__6&quot;&gt;&lt;/a&gt;1. 什么是消息中间件&lt;/h2&gt;\n&lt;p&gt;​		MQ全称为Message Queue，消息队列是应用程序和应用程序之间的通信方法。消息队列是一种异步的服务间通信方式，适用于无服务器和微服务架构。消息在被处理和删除之前一直存储在队列上。每条消息仅可被一位用户处理一次。消息队列可被用于分离重量级处理、缓冲或批处理工作以及缓解高峰期工作负载。是一种典型的生产者-消费者模型。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;2__10&quot;&gt;&lt;/a&gt;2. 为什么使用消息中间件&lt;/h2&gt;\n&lt;p&gt;​		在项目中，可将一些无需即时返回且耗时的操作提取出来，进行&lt;strong&gt;异步处理&lt;/strong&gt;，而这种异步处理的方式大大的节省了服务器的请求响应时间，从而&lt;strong&gt;提高&lt;/strong&gt;了&lt;strong&gt;系统&lt;/strong&gt;的&lt;strong&gt;吞吐量&lt;/strong&gt;。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;3_MQ_14&quot;&gt;&lt;/a&gt;3. MQ常用应用场景&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__16&quot;&gt;&lt;/a&gt;1. 任务异步处理&lt;/h3&gt;\n&lt;p&gt;​		将不需要同步处理的并且耗时长的操作由消息队列通知消息接收方进行异步处理。提高了应用程序的响应时间。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__20&quot;&gt;&lt;/a&gt;2. 应用程序解耦合&lt;/h3&gt;\n&lt;p&gt;​		MQ相当于一个中介，生产方通过MQ与消费方交互，它将应用程序进行解耦合。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;3__24&quot;&gt;&lt;/a&gt;3. 削峰填谷&lt;/h3&gt;\n&lt;p&gt;​		如订单系统，在下单的时候就会往数据库写数据。但是数据库只能支撑每秒1000左右的并发写入，并发量再高就容易宕机。低峰期的时候并发也就100多个，但是在高峰期时候，并发量会突然激增到5000以上，这个时候数据库肯定卡死了。此时，我们可以采用MQ来进行&lt;strong&gt;削峰填谷&lt;/strong&gt;，具体就是：&lt;br /&gt;\n​		由MQ来将消息存储起来，服务器根据自己的处理能力慢慢处理，这样，服务器就不会因为突发的高并发访问而挂掉了。&lt;strong&gt;削峰&lt;/strong&gt;：高并发时期的处理请求被保存，没有立即执行。&lt;strong&gt;填谷&lt;/strong&gt;：高并发后，服务器慢慢处理MQ保存的请求。&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;使用MQ前&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144011.jpg&quot; alt=&quot;削峰填谷前&quot; /&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;使用MQ后&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144016.jpg&quot; alt=&quot;削峰填谷后&quot; /&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;削峰填谷&lt;/strong&gt;图解&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144022.jpg&quot; alt=&quot;03&quot; /&gt;&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;4_AMQP__JMS_41&quot;&gt;&lt;/a&gt;4. AMQP 和 JMS&lt;/h2&gt;\n&lt;p&gt;​		MQ是消息通信的模型；实现MQ的大致有两种主流方式：AMQP、JMS。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;1_AMQP_45&quot;&gt;&lt;/a&gt;1. AMQP&lt;/h3&gt;\n&lt;p&gt;​		AMQP是一种协议，更准确的说是一种binary wire-level protocol（链接协议）。这是其和JMS的&lt;strong&gt;本质差别&lt;/strong&gt;，AMQP不从API层进行限定，而是直接定义网络交换的数据格式。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2_JMS_49&quot;&gt;&lt;/a&gt;2. JMS&lt;/h3&gt;\n&lt;p&gt;​	JMS即Java消息服务（JavaMessage Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;3_AMQP__JMS__53&quot;&gt;&lt;/a&gt;3. AMQP 和 JMS 的区别&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;JMS是定义了统一的接口，来对消息操作进行统一；AMQP是通过规定协议来统一数据交互的格式&lt;/li&gt;\n&lt;li&gt;JMS限定了必须使用Java语言；AMQP只是协议，不规定实现方式，因此是跨语言的。&lt;/li&gt;\n&lt;li&gt;JMS规定了两种消息模式；而AMQP的消息模式更加丰富&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2&gt;&lt;a id=&quot;5_MQ_59&quot;&gt;&lt;/a&gt;5. 常见的MQ产品&lt;/h2&gt;\n&lt;p&gt;目前市场上常见的消息队列产品如下：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;ActiveMQ：基于JMS&lt;/li&gt;\n&lt;li&gt;ZeroMQ：基于C语言开发&lt;/li&gt;\n&lt;li&gt;RabbitMQ：基于AMQP协议，erlang语言开发，稳定性好&lt;/li&gt;\n&lt;li&gt;RocketMQ：基于JMS，阿里巴巴产品&lt;/li&gt;\n&lt;li&gt;Kafka：类似MQ的产品；分布式消息系统，高吞吐量&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2&gt;&lt;a id=&quot;6_RabbitMQ_69&quot;&gt;&lt;/a&gt;6. RabbitMQ&lt;/h2&gt;\n&lt;p&gt;​		RabbitMQ是由erlang语言开发，基于AMQP（Advanced Message Queue 高级消息队列协议）协议实现的消息队列，它是一种应用程序之间的通信方法，消息队列在分布式系统开发中应用非常广泛。&lt;/p&gt;\n&lt;blockquote&gt;&lt;/blockquote&gt;\n&lt;p&gt;RabbitMQ提供了6种模式：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;基本消息模型&lt;/li&gt;\n&lt;li&gt;work工作模式&lt;/li&gt;\n&lt;li&gt;publish/subscribe（发布/订阅模式，也称 广播模式）&lt;/li&gt;\n&lt;li&gt;routing（路由模式）&lt;/li&gt;\n&lt;li&gt;Topics（通配符模式）&lt;/li&gt;\n&lt;li&gt;RPC远程调用模式（暂不作记录）&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;&lt;/blockquote&gt;\n&lt;h1&gt;&lt;a id=&quot;RabbitMQ_86&quot;&gt;&lt;/a&gt;二、安装及配置RabbitMQ&lt;/h1&gt;\n&lt;blockquote&gt;&lt;/blockquote&gt;\n&lt;h1&gt;&lt;a id=&quot;RabbitMQ_92&quot;&gt;&lt;/a&gt;三、RabbitMQ六种工作模式&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;_94&quot;&gt;&lt;/a&gt;入门项目搭建&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__96&quot;&gt;&lt;/a&gt;1. 创建项目&lt;/h3&gt;\n&lt;p&gt;​		分别创建两个项目，一个作为生产者，一个作为消费者。项目结构如下：&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144027.png&quot; alt=&quot;RabbitMQ入门环境搭建&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__102&quot;&gt;&lt;/a&gt;2. 导入依赖&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在两个项目中分别导入以下依赖&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-xml&quot;&gt;    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.rabbitmq&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;amqp-client&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;5.7.1&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;3__114&quot;&gt;&lt;/a&gt;3. 编写获取连接工具类&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;两个工程都需要这个工具类，复制一份即可&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.ConnectionFactory;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.TimeoutException;\n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.util\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 14:49\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ConnectionUtil&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * RabbitMQ主机地址\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String HOSt = &lt;span class=&quot;hljs-string&quot;&gt;&quot;Linux主机地址&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 端口\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; Integer PORT = &lt;span class=&quot;hljs-number&quot;&gt;5672&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 虚拟机\n     * 一个RabbitMQ服务可以设置多个虚拟机\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String VIRTUALHOST = &lt;span class=&quot;hljs-string&quot;&gt;&quot;/test&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 用户名\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String USERNAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 密码\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String PASSWORD = &lt;span class=&quot;hljs-string&quot;&gt;&quot;yezi&quot;&lt;/span&gt;;\n\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 创建连接\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt;\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@throws&lt;/span&gt; Exception\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Connection &lt;span class=&quot;hljs-title&quot;&gt;getConnection&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n        ConnectionFactory factory = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ConnectionFactory();\n\n        factory.setHost(HOSt);\n        factory.setPort(PORT);\n        factory.setVirtualHost(VIRTUALHOST);\n        factory.setUsername(USERNAME);\n        factory.setPassword(PASSWORD);\n        Connection connection = &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;try&lt;/span&gt; {\n            connection = factory.newConnection();\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {\n            e.printStackTrace();\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt; (TimeoutException e) {\n            e.printStackTrace();\n        }\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; connection;\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;注意导包是否正确！！！&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;1__186&quot;&gt;&lt;/a&gt;1. 基本消息模型（简单模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__188&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144034.png&quot; alt=&quot;基本消息模型&quot; /&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;mark&gt;P&lt;/mark&gt; ：生产者&lt;/li&gt;\n&lt;li&gt;红格：消息队列&lt;/li&gt;\n&lt;li&gt;&lt;mark&gt;C&lt;/mark&gt; ：消费者&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3&gt;&lt;a id=&quot;2__196&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;生产者向消息队列发送消息&lt;/li&gt;\n&lt;li&gt;消费者通过监听指定消息队列获取消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;3__201&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__203&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示基本消息模型\n * 案例：\n *      叶子给A用户发了一条私聊消息\n *\n *  基本消息模型：\n *      组成：\n *          1. 一个生产者\n *          2. 一个消费者\n *          3. 一个消息队列\n *      生产者 和 消费者 通过消息队列进行消息处理\n *      这个模型实际上使用了默认的交换机\n *\n * 这里使用的是部署在阿里云上的RabbitMQ服务，所以记得开放使用到的端口！！！\n *  启动这个类后可以在RabbitMQ控制面板上看到一个新的消息队列\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 基本消息模型-生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.basic\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 15:02\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;BasicProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;basic_test&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;Hello,RabbitMQ!&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建连接通道，只有使用通道才能完成消息相关操作&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明消息队列，假如没有这个消息队列，就会自动创建\n         * queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. durable 是否持久化（关闭后消息不丢失）\n         *      3. exclusive 是否独占连接，队列只允许在该连接中访问，如果connection连接关闭队列则自动删除,如果将此参数设置true可用于临时队列的创建\n         *      4. autoDelete 是否自动删除，队列不再使用时是否自动删除此队列，如果将此参数和exclusive参数设置为true就可以实现临时队列（队列不用了就自动删除）\n         *      5. arguments 参数，可以设置一个队列的扩展参数，比如：可设置存活时间\n         */&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ④ 向指定消息队列中发送消息\n         * basicPublish(String exchange, String routingKey, boolean mandatory, boolean immediate, BasicProperties props, byte[] body)\n         * 参数说明：\n         *      1. exchange 指定交换机名称，如果不指定将使用mq的默认交换机（需要设置为&quot;&quot;）\n         *      2. routingKey 指定路由key，交换机根据路由key来将消息转发到指定的队列，如果使用默认交换机，routingKey设置为队列的名称\n         *      3. mandatory\n         *      4. immediate\n         *      5. props 消息属性\n         *      6. body 要发送的消息\n         *\n         * 注意：\n         *  1. 这里使用的是basicPublish方法的重载形式，只需要参数 1 2 5 6\n         *  2. 使用默认交换机，所以交换机名称设置为 &quot;&quot;\n         *  3. 使用默认交换机，所以路由key设置为队列名称\n         */&lt;/span&gt;\n        channel.basicPublish(&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;,QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE.getBytes());\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;2__279&quot;&gt;&lt;/a&gt;2. 消费者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 启动这个类后，可以在RabbitMQ控制台的Channels项下看到一个新的Channel\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 基本消息模型-消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.basic\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 15:51\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;BasicConsumer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;basic_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建连接通道，没有通道就无法进行消息处理&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明消息队列\n         *      假如没有指定消息队列，就会自动创建\n         *      如果生产者已经创建了指定队列，就可以不在此处进行声明\n         * 此处不再进行声明\n         *\n         * 注意：\n         *  如果在生产者中声明了队列，而在消费者中没有声明队列\n         *  那么，不要先启动消费者，否则会因为不存在指定队列而抛出异常\n         */&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写处理消息的方法（消费方法）&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-comment&quot;&gt;/**\n             * 消费方法\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; consumerTag 消费者标签，用来标识消费者\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; envelope 信封 封装了DeliveryTag、exchange(交换机)、RoutingKey(路由key) 三个信息\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; properties 消息属性，这里生产者没有进行设置，所以很多为null\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; body 接收的消息\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@throws&lt;/span&gt; IOException\n             */&lt;/span&gt;\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;consumerTag---&amp;gt;&quot;&lt;/span&gt;+consumerTag);\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;DeliveryTag---&amp;gt;&quot;&lt;/span&gt;+envelope.getDeliveryTag());\n                &lt;span class=&quot;hljs-comment&quot;&gt;// 交换机&lt;/span&gt;\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;exchange------&amp;gt;&quot;&lt;/span&gt;+envelope.getExchange());\n                &lt;span class=&quot;hljs-comment&quot;&gt;//路由key&lt;/span&gt;\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;RoutingKey----&amp;gt;&quot;&lt;/span&gt;+envelope.getRoutingKey());\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;properties----&amp;gt;&quot;&lt;/span&gt;+properties);\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;接受的消息是---&amp;gt;&quot;&lt;/span&gt;+&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 设置监听队列\n         * 参数明细：\n         * 1、queue 队列名称\n         * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n         * 3、callback，消费方法，当消费者接收到消息要执行的方法\n         */&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * 注意：\n         *  消费者要一直监听生产者的动作，所以在此不要关闭连接！\n         *  不要关闭连接！\n         */&lt;/span&gt;\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;2_Work_359&quot;&gt;&lt;/a&gt;2. Work工作模式&lt;/h2&gt;\n&lt;h4&gt;&lt;a id=&quot;1__361&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h4&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144041.png&quot; alt=&quot;Work工作模式&quot; /&gt;&lt;/p&gt;\n&lt;h4&gt;&lt;a id=&quot;2__365&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h4&gt;\n&lt;ol&gt;\n&lt;li&gt;生产者向消息队列发送消息&lt;/li&gt;\n&lt;li&gt;多个消费者通过监听同一个指定的消息队列获取消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;注意：这些消费者之间是竞争关系！&lt;/p&gt;\n&lt;h4&gt;&lt;a id=&quot;3__372&quot;&gt;&lt;/a&gt;3. 应用&lt;/h4&gt;\n&lt;p&gt;可以通过创建多个消费者的方式提高消息处理效率。&lt;/p&gt;\n&lt;h4&gt;&lt;a id=&quot;4__376&quot;&gt;&lt;/a&gt;4. 代码编写&lt;/h4&gt;\n&lt;h5&gt;&lt;a id=&quot;1__378&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h5&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示Work工作模式\n *  案例：\n *      叶子在游戏上发布了一系列任务，任务完成数量越多，奖励越多\n *\n * Work工作模式\n *  组成：一个生产者 + 多个消费者 + 一个消息队列\n *  多个消费者共同竞争一个消息队列中待处理的消息，提高了处理效率\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; Work模式-生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.work\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 17:24\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WorkProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;work_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 发送多条消息&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;; i &amp;lt;= &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;; i++) {\n            String message = &lt;span class=&quot;hljs-string&quot;&gt;&quot;第&quot;&lt;/span&gt; + i + &lt;span class=&quot;hljs-string&quot;&gt;&quot;条消息&quot;&lt;/span&gt;;\n            channel.basicPublish(&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;,QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,message.getBytes());\n        }\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h5&gt;&lt;a id=&quot;2__423&quot;&gt;&lt;/a&gt;2. 两个消费者&lt;/h5&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; Work模式-①号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.work\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 17:34\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WorkConsumer1&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;work_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;一号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; Work模式-②号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.work\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 17:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WorkConsumer2&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;work_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;二号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;3_PublishSubscribe__502&quot;&gt;&lt;/a&gt;3. Publish/Subscribe（发布/订阅模式，也称 广播模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__504&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144047.png&quot; alt=&quot;PublishSubscribe&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__508&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;创建交换机 + 声明队列&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;交换机绑定队列 （泛式绑定，没有指定路由key）&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;生产者发送消息给交换机，交换机将消息转发给所有绑定的消息队列&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;消费者通过监听消息队列获取消息&lt;/p&gt;\n&lt;p&gt;​	因为在这里消息会被同等转发给所有消息队列，不存在差异（即部分消息队列可以收到消息，部分收不到），类似于广播，所以被称为&lt;strong&gt;广播/订阅模式&lt;/strong&gt;。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;3__520&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__522&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.BuiltinExchangeType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示发布/订阅模式（广播模式）\n *  案例：\n *      叶子的个人博客更新时，所有订阅用户都会收到推送\n * 发布/订阅 模式\n * 组成：\n *      1. 一个交换机，类型为 fanout\n *      2. 多个消息队列 ，和交换机进行绑定（routingKey 设置为 &quot;&quot;）\n *      3. 多个消费者\n * 信息发送给交换机，交换机将信息转发给所有绑定的消息队列，所有 &quot;订阅&quot; 绑定消息队列的消费者都能接收到消息\n * 注意：\n *      1. 这里的 消息队列和交换机 之间属于任意绑定模式，不存在路由分发，所以所有绑定的消息队列可以接收到相同消息\n *      2. 路由模式采用路由分发的方式实现：不同的信息交给不同的消息队列\n *\n * 尚不了解的问题：\n *      1. 订阅者处理消息是否有先后顺序，能否同时处理同一个消息？\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 发布/订阅模式 - 生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.publish_subscribe\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 18:23\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;PublishProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;exchange_fanout&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_1 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_1&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_2 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_2&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子博客更新了！&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明exchange（交换机），指定类型为fanout\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */&lt;/span&gt;\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 声明队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME_1,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        channel.queueDeclare(QUEUE_NAME_2,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 &quot;&quot;\n         *      4. arguments 参数\n         */&lt;/span&gt;\n        channel.queueBind(QUEUE_NAME_1,EXCHANGE_NAME,&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;);\n        channel.queueBind(QUEUE_NAME_2,EXCHANGE_NAME,&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */&lt;/span&gt;\n        channel.basicPublish(EXCHANGE_NAME,&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE.getBytes());\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑥ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;2__607&quot;&gt;&lt;/a&gt;2. 两个消费者&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 发布/订阅模式 - ①号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 18:53\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;SubscribeConsumer1&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_1 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_1&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;一号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_1,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 发布/订阅模式 - ②号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 18:53\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;SubscribeConsumer2&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_2 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_2&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;二号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_2,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;4_Routing_685&quot;&gt;&lt;/a&gt;4. Routing（路由模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__687&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144054.png&quot; alt=&quot;Routing&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__691&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;创建交换机 + 消息队列&lt;/li&gt;\n&lt;li&gt;交换机通过不同的 &lt;mark&gt;routingkey&lt;/mark&gt; 绑定到不同的消息队列（路由key）&lt;/li&gt;\n&lt;li&gt;生产者将消息发送给交换机，指定 &lt;mark&gt;routingkey&lt;/mark&gt;&lt;/li&gt;\n&lt;li&gt;交换机通过 &lt;mark&gt;routingkey&lt;/mark&gt; 确定将消息发送给哪些消息队列&lt;/li&gt;\n&lt;li&gt;不同消费者通过监听不同消息队列可能收到不同的消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;核心：&lt;strong&gt;依据 routingkey 实现了消息的选择性发送&lt;/strong&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;3__701&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__703&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.BuiltinExchangeType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示路由模式：\n *  案例：\n *      叶子开辟了个人的付费专栏，该专栏发布的博客只有VIP用户可以查看\n *      免费博客所有人都可以查看\n *\n * 路由模式：\n *  组成：\n *      1. 一个生产者\n *      2. 一个交换机\n *      3. 多个消息队列 （通过不同的routingKey绑定到交换机上）\n *      4. 多个消费者\n *  流程分析：\n *      1. 生产者发送消息时指定交换机+routingKey\n *      2. 交换机根据 routingKey 将消息发送到对应的消息队列\n *      3. 消费者接收绑定消息队列的消息\n *  核心：根据 routingKey 实现路由分发\n *      消息指定的 routingKey 和消息队列绑定的 routingKey 匹配时，该消息队列才能收到该消息\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 路由模式 - 生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:28\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RoutingProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;exchange_direct&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user_vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;user&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;user_vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的免费博客！&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的vip付费专栏博客！&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明exchange（交换机），指定类型为direct\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */&lt;/span&gt;\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 声明队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 &quot;&quot;\n         *      4. arguments 参数\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         */&lt;/span&gt;\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */&lt;/span&gt;\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER_VIP.getBytes());\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑥ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;1__811&quot;&gt;&lt;/a&gt;1. 两个消费者&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 路由模式 - ①号消费者（普通用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RoutingConsumerUser&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;普通用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 路由模式 - ②号消费者（VIP用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RoutingConsumerUserVip&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user_vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;VIP用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;5_topic_890&quot;&gt;&lt;/a&gt;5. topic（通配符模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__892&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144101.png&quot; alt=&quot;topic&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__896&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;p&gt;topic的处理流程和routing的处理流程其实差不多，只是topic的 &lt;mark&gt;routingkey&lt;/mark&gt; 使用了更强大、更灵活的通配符&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;mark&gt;*&lt;/mark&gt; ：恰好匹配一个&lt;strong&gt;单词&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;mark&gt;#&lt;/mark&gt; ：匹配一个或多个&lt;strong&gt;单词&lt;/strong&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;例如：*.user 可以匹配 admin.user 但不能匹配 vip.admin.user。  而 #.user 就可以匹配。&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;创建交换机 + 消息队列&lt;/li&gt;\n&lt;li&gt;交换机通过不同的 &lt;mark&gt;routingkey&lt;/mark&gt; 绑定到不同的消息队列（路由key）&lt;/li&gt;\n&lt;li&gt;生产者将消息发送给交换机，指定 &lt;mark&gt;routingkey&lt;/mark&gt;&lt;/li&gt;\n&lt;li&gt;交换机通过 &lt;mark&gt;routingkey&lt;/mark&gt; 确定将消息发送给哪些消息队列&lt;/li&gt;\n&lt;li&gt;不同消费者通过监听不同消息队列可能收到不同的消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;3__911&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__913&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.BuiltinExchangeType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示通配符模式\n * 实现routing模式的案例\n *\n * 其实通配符和路由模式都是基于路由分发实现的，只是通配符模式引入了两个通配符\n * 使用起来更加方便，功能更强大\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 通配符匹配模式 - 生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.topic\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 20:12\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TopicProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.direct&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user.vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;*.user&quot;&lt;/span&gt;;    &lt;span class=&quot;hljs-comment&quot;&gt;//可以匹配到普通用户和VIP用户&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;#.vip&quot;&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;//只能匹配到VIP用户&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的免费博客！&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的vip付费专栏博客！&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明exchange（交换机），指定类型为topic&lt;/span&gt;\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 声明队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 队列绑定交换机\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         *\n         *  * 恰好匹配一个单词\n         *  # 匹配一个及以上的单词\n         */&lt;/span&gt;\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */&lt;/span&gt;\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER_VIP.getBytes());\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑥ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;2__993&quot;&gt;&lt;/a&gt;2. 两个消费者&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 通配符匹配模式 - ①号消费者（普通用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TopicConsumerUser&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;普通用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 通配符匹配模式 - ②号消费者（VIP用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TopicConsumerUserVip&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user.vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;VIP用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;6__1071&quot;&gt;&lt;/a&gt;6. &lt;strong&gt;工作模式总结&lt;/strong&gt;&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__1073&quot;&gt;&lt;/a&gt;1. 分类&lt;/h3&gt;\n&lt;p&gt;其实，依据前面的介绍，我们可以将5种工作模式大致分为两类：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;非路由模式&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;基本消息模型&lt;/li&gt;\n&lt;li&gt;work工作模式&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;路由模式&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;Publish/subscribe&lt;/li&gt;\n&lt;li&gt;routing&lt;/li&gt;\n&lt;li&gt;topic&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;\n&lt;p&gt;非路由模式和路由模式的区别&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;非路由模式不使用交换机，直接向消息队列发送消息（其实内部使用了默认的交换机）。而路由模式使用交换机，信息发送给交换机，由交换机负责转发给消息队列&lt;/li&gt;\n&lt;li&gt;非路由模式会将消息发给所有绑定的监听队列，而路由模式会由交换机根据&lt;mark&gt;rongtingkey&lt;/mark&gt;来确定将消息发送给哪个消息队列。即：就消息发送而言&lt;strong&gt;路由模式具有选择差异性&lt;/strong&gt;（Publish/subscribe除外，它使用了默认的&lt;mark&gt;rongtingkey&lt;/mark&gt;，也是将消息推送给所有绑定的消息队列）&lt;/li&gt;\n&lt;li&gt;路由模式由于使用了&lt;mark&gt;rongtingkey&lt;/mark&gt;分发模式而更加灵活&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h1&gt;&lt;a id=&quot;SpringBootRabbitMQ_1092&quot;&gt;&lt;/a&gt;四、SpringBoot整合RabbitMQ&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;1__1094&quot;&gt;&lt;/a&gt;1. 项目搭建&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;分别创建两个Spring Boot项目，一个作为生产者，一个作为消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144109.png&quot; alt=&quot;SpringBootxiao消息队列&quot; /&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;导入依赖&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-amqp&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;2__1109&quot;&gt;&lt;/a&gt;2. 编写生产者代码&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;yml文件配置&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=&quot;lang-yaml&quot;&gt;spring:\n  rabbitmq:\n    host: 主机IP地址\n    port: 5672\n    username: 叶子\n    password: 密码\n    virtual-host: /test\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;RabbitMQ配置类&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.amqp.core.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.beans.factory.annotation.Qualifier;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.context.annotation.Bean;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.context.annotation.Configuration;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; RabbitMQ - 生产者配置类\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.producer.conig\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/20 星期五 16:07\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Configuration&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitMQConfig&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.exchange&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.queue&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;(name = EXCHANGE)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Exchange &lt;span class=&quot;hljs-title&quot;&gt;exchange&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; ExchangeBuilder.topicExchange(EXCHANGE).durable(&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;).autoDelete().build();\n    }\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;(name = QUEUE)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Queue &lt;span class=&quot;hljs-title&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; QueueBuilder.durable(QUEUE).build();\n    }\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Binding &lt;span class=&quot;hljs-title&quot;&gt;binding&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(@Qualifier(EXCHANGE)&lt;/span&gt; Exchange exchange, @&lt;span class=&quot;hljs-title&quot;&gt;Qualifier&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(QUEUE)&lt;/span&gt; Queue queue)&lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; BindingBuilder.bind(queue).to(exchange).with(&lt;span class=&quot;hljs-string&quot;&gt;&quot;vip.*&quot;&lt;/span&gt;).noargs();\n    }\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在测试类中进行测试&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@SpringBootTest&lt;/span&gt;\n&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ProducerApplicationTests&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Autowired&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; RabbitTemplate rabbitTemplate;\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Test&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;contextLoads&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{\n        rabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE,&lt;span class=&quot;hljs-string&quot;&gt;&quot;vip.user&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;Hello,SpringBoot and RabbitMQ!&quot;&lt;/span&gt;);\n    }\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;3__1177&quot;&gt;&lt;/a&gt;3. 编写消费者代码&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;yml文件配置和生产者一样&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;blockquote&gt;\n&lt;p&gt;编写消息队列监听类&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.amqp.core.Message;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.amqp.rabbit.annotation.RabbitListener;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.stereotype.Component;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; RabbitMQ - 消息队列监听类\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.consumer.listener\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/20 星期五 16:20\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Component&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitMQListener&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@RabbitListener&lt;/span&gt;(queues = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.queue&quot;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;listenerQueue&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Message message)&lt;/span&gt;&lt;/span&gt;{\n        System.out.println(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(message.getBody()));\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;注意：消费者可以不添加配置类&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;4__1207&quot;&gt;&lt;/a&gt;4. 总结&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;生产者&lt;/li&gt;\n&lt;/ul&gt;\n&lt;ol&gt;\n&lt;li&gt;配置yml文件&lt;/li&gt;\n&lt;li&gt;编写配置类&lt;/li&gt;\n&lt;li&gt;编写测试类&lt;/li&gt;\n&lt;/ol&gt;\n&lt;ul&gt;\n&lt;li&gt;消费者&lt;/li&gt;\n&lt;/ul&gt;\n&lt;ol&gt;\n&lt;li&gt;配置yml文件&lt;/li&gt;\n&lt;li&gt;编写消息队列监听类&lt;/li&gt;\n&lt;/ol&gt;\n&lt;blockquote&gt;\n&lt;p&gt;入门学习笔记，如有错误，请于评论区指出，非常感谢！&lt;/p&gt;\n&lt;/blockquote&gt;\n',0,0,'2021-03-29 21:34:52','2021-03-29 21:34:52',0),('1376528596510687234','1369634113126825985','RabbitMQ高级特性第一篇——消息确认机制','# RabbitMQ高级特性第一篇——消息确认机制\n\n> 本文代码在RabbitMQ基础篇的基础上进行配置\n\n## 一、为什么需要消息确认机制\n\n​		在RabbitMQ基础篇中，我们介绍了使用MQ的优势，但是MQ的引入同时也会给整个项目项目带来一些其他的问题，其中一个问题就是：\n\n> 如何保证消息的可靠性以及如何确保消息被成功消费了？（常见面试题）。\n\n为了解决这个问题，RabbitMQ提供了消息确认机制。\n\n## 二、RabbitMQ消息确认机制概述\n\n> 注意：这是在生产端实现的\n\nRabbitMQ的消息确认机制分为两个部分：\n\n1. 消息发送确认\n2. 消息消费确认\n\n至于为什么会分成这两个部分，我们可以通过分析RabbitMQ消息传递流程得出答案\n\n> RabbitMQ组成\n\n![RabbitMQ组成](https://gitee.com/yezio/images/raw/master/img/20210112143942.png)\n\n各组成部分介绍：\n\n- Producer：消息生产者\n- Channel：消息通道\n- Broker：消息队列服务进程，此进程包括两个部分：Exchange和Queue。\n- Exchange：交换机，按照一定规则叫不同的消息分发给不同的消息队列，过滤消息\n- Queue：消息队列，存储消息的队列，消息到达队列并转发给指定的消费方。（未被处理的消息都放在这）\n- Consumer：消费者，负责处理消息。\n\n> RabbitMQ工作流程\n\n1. 生产者发送消息到Channel\n2. Channel将消息发送给Exchange\n3. Exchange按照指定的匹配规则分发消息\n4. Queue收到消息后存储起来，慢慢发给Consumer进行处理\n\n在这个过程中，Queue是实际上的消息中转站和消息储存者。那么在这个过程中造成消息丢失的原因就有两个：\n\n1. 消息没有成功发送给Queue\n2. Queue将消息转发给Consumer后，Consumer发生异常没有处理消息，但Queue已经将消息出队了\n\n针对这两个原因，所以RabbitMQ就将消息确认机制分为两部分了\n\n1. 消息发送确认：确认消息发送给Queue了，即Queue反馈成功获取了消息\n2. 消息消费确认：消息发送给Consumer后，由Consumer反馈的消息确认是否出队该消息\n\n通过这两步，就可以实现：确保消息可靠性以及确保消息被成功消费的要求。\n\n## 三、消息发送确认\n\n消息发送确认通过两步实现\n\n1. 确认消息发送到了Exchange（Confirm机制）\n2. 确认消息发送到了Queue（Return机制）\n\n### 1. Confirm机制\n\n#### 1. 实现原理\n\n>生产者将信道设置成confirm模式，一旦信道进入confirm模式，\n>	所有在该信道上面发布的消息都会被指派一个唯一的ID(从1开始)，\n>	一旦消息被投递到所有匹配的队列之后，broker就会发送一个确认给生产者（包含消息的唯一ID）,\n>	这就使得生产者知道消息已经正确到达目的队列了，如果消息和队列是可持久化的，\n>那么确认消息会将消息写入磁盘之后发出，broker回传给生产者的确认消息中deliver-tag域包含了确认消息的序列号，\n>此外broker也可以设置basic.ack的multiple域，表示到这个序列号之前的所有消息都已经得到了处理。\n\n#### 2. 代码实现\n\n> 创建ConfirmCallback处理器，实现RabbitTemplate.ConfirmCallback接口\n\n```java\n/**\n * 消息发送到exchange时会触发这个方法\n *\n * @author 叶子\n * @Description ConfirmCallback实现类\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.producer.handel\n * @Data 2020/11/21 星期六 15:34\n */\npublic class ConfirmCallbackHandel implements RabbitTemplate.ConfirmCallback {\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        System.out.println(\"消息唯一标识：\"+correlationData);\n        System.out.println(\"确认结果：\"+b);\n        System.out.println(\"失败原因：\"+s+\"(如果没有失败则此项为null)\");\n    }\n}\n```\n\n> 创建ReturnCallBack处理类，实现RabbitTemplate.ReturnsCallback接口\n\n```java\n/**\n * 当消息从交换器发送到对应队列失败时触发\n * （比如根据发送消息时指定的routingKey找不到队列时会触发）\n *\n * @author 叶子\n * @Description ReturnsCallback实现类\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.producer.handel\n * @Data 2020/11/21 星期六 15:38\n */\npublic class ReturnCallbackHandel implements RabbitTemplate.ReturnsCallback {\n    @Override\n    public void returnedMessage(ReturnedMessage returnedMessage) {\n        System.out.println(\"消息内容 body：\"+new String(returnedMessage.getMessage().getBody()));\n        System.out.println(\"应答码 replyCode: ：\"+returnedMessage.getReplyCode());\n        System.out.println(\"原因描述 replyText：\"+returnedMessage.getReplyText());\n        System.out.println(\"交换机 exchange：\"+returnedMessage.getExchange());\n        System.out.println(\"消息使用的路由键 routingKey：\"+returnedMessage.getRoutingKey());\n    }\n}\n```\n\n#### 3. 在配置类中进行配置\n\n```java\n//初始化加载方法，对RabbitTemplate进行配置\n    @PostConstruct\n    void rabbitTemplate(){\n        //消息发送确认，发送到交换器Exchange后触发回调\n        rabbitTemplate.setConfirmCallback(new ConfirmCallbackHandel());\n        //消息发送确认，如果消息从交换器发送到对应队列失败时触发（比如根据发送消息时指定的routingKey找不到队列时会触发）\n        rabbitTemplate.setReturnCallback(new ReturnCallbackHandel());\n    }\n```\n\n#### 4. 在yml文件中进行配置\n\n```yaml\nspring:\n  rabbitmq:\n    host: localhost\n    port: 5672\n    username: 叶子\n    password: 123456789\n    virtual-host: /test\n    publisher-returns: true # 消息发送交换机确认\n    publisher-confirm-type: correlated # 消息发送队列回调 none代表不开启\n```\n\n\n\n## 四、消息消费确认\n\n> 注意：这个是在消费端进行配置\n\n### 1. ACK确认机制\n\n有两种确认模式：\n\n1. none 自动确认\n2. manual 手动确认\n\n注意：一般不采用自动确认模式，\n原因：自动确认模式下，当消费者接受消息后，消息队列会自动删除该消息。\n     此时，如果消费者消费失败，那么该条消息就丢失了\n\n### 2. 在yml文件中配置ACK为手动模式\n\n```yaml\nspring:\n  rabbitmq:\n    host: localhost\n    port: 5672\n    username: 叶子\n    password: 123456789\n    virtual-host: /test\n    listener:\n      simple:\n        acknowledge-mode: manual  # 手动\n```\n\n### 3. 在配置类中进行配置\n\n````java\n/**\n * @author 叶子\n * @Description RabbitMQ配置类(消费者)\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.consumer.config\n * @Data 2020/11/25 星期三 11:20\n */\n@Configuration\npublic class RabbitMQConfig {\n\n    //RabbitMQ监听容器\n    @Bean\n    public SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory(ConnectionFactory connectionFactory){\n        SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();\n        factory.setConnectionFactory(connectionFactory);\n        //设置并发\n        factory.setConcurrentConsumers(1);\n        SimpleMessageListenerContainer s=new SimpleMessageListenerContainer();\n        //最大并发\n        factory.setMaxConcurrentConsumers(1);\n        //消息接收——手动确认\n        factory.setAcknowledgeMode(AcknowledgeMode.MANUAL);\n        //设置超时\n        factory.setReceiveTimeout(2000L);\n        //设置重试间隔\n        factory.setFailedDeclarationRetryInterval(3000L);\n        //监听自定义格式转换\n        //factory.setMessageConverter(jsonMessageConverter);\n        return factory;\n    }\n\n}\n````\n\n### 4. 消息确认常用方法\n\n#### 1. 确认消费的方法\n\n> void basicAck(long deliveryTag, boolean multiple) throws IOException\n\n参数说明：\n\n1. deliveryTag：消息ID，从1开始\n2. multiple：是否批量，将一次性ack所有小于deliveryTag的消息。\n\n#### 2. 反馈消息消费失败的方法\n\n> void basicNack(long deliveryTag, boolean multiple, boolean requeue) throws IOException\n>\n> basicReject(long deliveryTag, boolean requeue) throws IOException\n\n参数说明：\n\n1. deliveryTag：消息ID，从1开始\n2. multiple：是否批量，将一次性拒绝所有小于deliveryTag的消息。\n3. requeue：被拒绝的是否重新入队列。\n\n### 5. 代码编写\n\n```java\n/**\n * @author 叶子\n * @Description RabbitMQ - 消息队列监听类\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.consumer.listener\n * @Data 2020/11/20 星期五 16:20\n */\n@Component\npublic class RabbitMQListener {\n\n    /**\n     *\n     * 确认消费成功的方法\n     *  void basicAck(long deliveryTag, boolean multiple) throws IOException\n     *\n     * 参数说明：index\n     *      1. deliveryTag：消息ID，从1开始\n     *      2. multiple：是否批量，将一次性ack所有小于deliveryTag的消息。\n     *\n     * @param message\n     * @param channel\n     */\n    @RabbitListener(queues = \"boot.queue.user\")\n    public void listenerQueueUser(Message message, Channel channel){\n        System.out.println(\"普通用户阅读了\"+new String(message.getBody()));\n        System.out.println(message.getMessageProperties().getDeliveryTag());\n        try {\n            channel.basicAck(message.getMessageProperties().getDeliveryTag(),true);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 失败确认\n     *  方法一：void basicNack(long deliveryTag, boolean multiple, boolean requeue) throws IOException\n     *  方法二：basicReject(long deliveryTag, boolean requeue) throws IOException\n     * 参数说明：\n     *      1. deliveryTag：消息ID，从1开始\n     *      2. multiple：是否批量，将一次性拒绝所有小于deliveryTag的消息。\n     *      3. requeue：被拒绝的是否重新入队列。\n     *\n     * @param message\n     * @param channel\n     */\n    @RabbitListener(queues = \"boot.queue.user.vip\")\n    public void listenerQueueUserVip(Message message,Channel channel){\n        System.out.println(\"VIP用户阅读了\"+new String(message.getBody()));\n        try {\n            channel.basicNack(message.getMessageProperties().getDeliveryTag(),true,true);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n','&lt;h1&gt;&lt;a id=&quot;RabbitMQ_0&quot;&gt;&lt;/a&gt;RabbitMQ高级特性第一篇&mdash;&mdash;消息确认机制&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;本文代码在RabbitMQ基础篇的基础上进行配置&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2&gt;&lt;a id=&quot;_4&quot;&gt;&lt;/a&gt;一、为什么需要消息确认机制&lt;/h2&gt;\n&lt;p&gt;​		在RabbitMQ基础篇中，我们介绍了使用MQ的优势，但是MQ的引入同时也会给整个项目项目带来一些其他的问题，其中一个问题就是：&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;如何保证消息的可靠性以及如何确保消息被成功消费了？（常见面试题）。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;为了解决这个问题，RabbitMQ提供了消息确认机制。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;RabbitMQ_12&quot;&gt;&lt;/a&gt;二、RabbitMQ消息确认机制概述&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;注意：这是在生产端实现的&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;RabbitMQ的消息确认机制分为两个部分：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;消息发送确认&lt;/li&gt;\n&lt;li&gt;消息消费确认&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;至于为什么会分成这两个部分，我们可以通过分析RabbitMQ消息传递流程得出答案&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;RabbitMQ组成&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112143942.png&quot; alt=&quot;RabbitMQ组成&quot; /&gt;&lt;/p&gt;\n&lt;p&gt;各组成部分介绍：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Producer：消息生产者&lt;/li&gt;\n&lt;li&gt;Channel：消息通道&lt;/li&gt;\n&lt;li&gt;Broker：消息队列服务进程，此进程包括两个部分：Exchange和Queue。&lt;/li&gt;\n&lt;li&gt;Exchange：交换机，按照一定规则叫不同的消息分发给不同的消息队列，过滤消息&lt;/li&gt;\n&lt;li&gt;Queue：消息队列，存储消息的队列，消息到达队列并转发给指定的消费方。（未被处理的消息都放在这）&lt;/li&gt;\n&lt;li&gt;Consumer：消费者，负责处理消息。&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;\n&lt;p&gt;RabbitMQ工作流程&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;生产者发送消息到Channel&lt;/li&gt;\n&lt;li&gt;Channel将消息发送给Exchange&lt;/li&gt;\n&lt;li&gt;Exchange按照指定的匹配规则分发消息&lt;/li&gt;\n&lt;li&gt;Queue收到消息后存储起来，慢慢发给Consumer进行处理&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;在这个过程中，Queue是实际上的消息中转站和消息储存者。那么在这个过程中造成消息丢失的原因就有两个：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;消息没有成功发送给Queue&lt;/li&gt;\n&lt;li&gt;Queue将消息转发给Consumer后，Consumer发生异常没有处理消息，但Queue已经将消息出队了&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;针对这两个原因，所以RabbitMQ就将消息确认机制分为两部分了&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;消息发送确认：确认消息发送给Queue了，即Queue反馈成功获取了消息&lt;/li&gt;\n&lt;li&gt;消息消费确认：消息发送给Consumer后，由Consumer反馈的消息确认是否出队该消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;通过这两步，就可以实现：确保消息可靠性以及确保消息被成功消费的要求。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;_55&quot;&gt;&lt;/a&gt;三、消息发送确认&lt;/h2&gt;\n&lt;p&gt;消息发送确认通过两步实现&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;确认消息发送到了Exchange（Confirm机制）&lt;/li&gt;\n&lt;li&gt;确认消息发送到了Queue（Return机制）&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;1_Confirm_62&quot;&gt;&lt;/a&gt;1. Confirm机制&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__64&quot;&gt;&lt;/a&gt;1. 实现原理&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;生产者将信道设置成confirm模式，一旦信道进入confirm模式，&lt;br /&gt;\n所有在该信道上面发布的消息都会被指派一个唯一的ID(从1开始)，&lt;br /&gt;\n一旦消息被投递到所有匹配的队列之后，broker就会发送一个确认给生产者（包含消息的唯一ID）,&lt;br /&gt;\n这就使得生产者知道消息已经正确到达目的队列了，如果消息和队列是可持久化的，&lt;br /&gt;\n那么确认消息会将消息写入磁盘之后发出，broker回传给生产者的确认消息中deliver-tag域包含了确认消息的序列号，&lt;br /&gt;\n此外broker也可以设置basic.ack的multiple域，表示到这个序列号之前的所有消息都已经得到了处理。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4&gt;&lt;a id=&quot;2__73&quot;&gt;&lt;/a&gt;2. 代码实现&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;创建ConfirmCallback处理器，实现RabbitTemplate.ConfirmCallback接口&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 消息发送到exchange时会触发这个方法\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; ConfirmCallback实现类\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.producer.handel\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/21 星期六 15:34\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ConfirmCallbackHandel&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitTemplate&lt;/span&gt;.&lt;span class=&quot;hljs-title&quot;&gt;ConfirmCallback&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;confirm&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(CorrelationData correlationData, &lt;span class=&quot;hljs-keyword&quot;&gt;boolean&lt;/span&gt; b, String s)&lt;/span&gt; &lt;/span&gt;{\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;消息唯一标识：&quot;&lt;/span&gt;+correlationData);\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;确认结果：&quot;&lt;/span&gt;+b);\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;失败原因：&quot;&lt;/span&gt;+s+&lt;span class=&quot;hljs-string&quot;&gt;&quot;(如果没有失败则此项为null)&quot;&lt;/span&gt;);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;创建ReturnCallBack处理类，实现RabbitTemplate.ReturnsCallback接口&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 当消息从交换器发送到对应队列失败时触发\n * （比如根据发送消息时指定的routingKey找不到队列时会触发）\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; ReturnsCallback实现类\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.producer.handel\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/21 星期六 15:38\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ReturnCallbackHandel&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitTemplate&lt;/span&gt;.&lt;span class=&quot;hljs-title&quot;&gt;ReturnsCallback&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;returnedMessage&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ReturnedMessage returnedMessage)&lt;/span&gt; &lt;/span&gt;{\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;消息内容 body：&quot;&lt;/span&gt;+&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(returnedMessage.getMessage().getBody()));\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;应答码 replyCode: ：&quot;&lt;/span&gt;+returnedMessage.getReplyCode());\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;原因描述 replyText：&quot;&lt;/span&gt;+returnedMessage.getReplyText());\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;交换机 exchange：&quot;&lt;/span&gt;+returnedMessage.getExchange());\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;消息使用的路由键 routingKey：&quot;&lt;/span&gt;+returnedMessage.getRoutingKey());\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;3__122&quot;&gt;&lt;/a&gt;3. 在配置类中进行配置&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;//初始化加载方法，对RabbitTemplate进行配置&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@PostConstruct&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;rabbitTemplate&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;//消息发送确认，发送到交换器Exchange后触发回调&lt;/span&gt;\n        rabbitTemplate.setConfirmCallback(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ConfirmCallbackHandel());\n        &lt;span class=&quot;hljs-comment&quot;&gt;//消息发送确认，如果消息从交换器发送到对应队列失败时触发（比如根据发送消息时指定的routingKey找不到队列时会触发）&lt;/span&gt;\n        rabbitTemplate.setReturnCallback(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ReturnCallbackHandel());\n    }\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;4_yml_135&quot;&gt;&lt;/a&gt;4. 在yml文件中进行配置&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=&quot;lang-yaml&quot;&gt;spring:\n  rabbitmq:\n    host: localhost\n    port: 5672\n    username: 叶子\n    password: 123456789\n    virtual-host: /test\n    publisher-returns: true # 消息发送交换机确认\n    publisher-confirm-type: correlated # 消息发送队列回调 none代表不开启\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;_151&quot;&gt;&lt;/a&gt;四、消息消费确认&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;注意：这个是在消费端进行配置&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3&gt;&lt;a id=&quot;1_ACK_155&quot;&gt;&lt;/a&gt;1. ACK确认机制&lt;/h3&gt;\n&lt;p&gt;有两种确认模式：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;none 自动确认&lt;/li&gt;\n&lt;li&gt;manual 手动确认&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;注意：一般不采用自动确认模式，&lt;br /&gt;\n原因：自动确认模式下，当消费者接受消息后，消息队列会自动删除该消息。&lt;br /&gt;\n此时，如果消费者消费失败，那么该条消息就丢失了&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2_ymlACK_166&quot;&gt;&lt;/a&gt;2. 在yml文件中配置ACK为手动模式&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=&quot;lang-yaml&quot;&gt;spring:\n  rabbitmq:\n    host: localhost\n    port: 5672\n    username: 叶子\n    password: 123456789\n    virtual-host: /test\n    listener:\n      simple:\n        acknowledge-mode: manual  # 手动\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;3__181&quot;&gt;&lt;/a&gt;3. 在配置类中进行配置&lt;/h3&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; RabbitMQ配置类(消费者)\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.consumer.config\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/25 星期三 11:20\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Configuration&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitMQConfig&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;//RabbitMQ监听容器&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; SimpleRabbitListenerContainerFactory &lt;span class=&quot;hljs-title&quot;&gt;rabbitListenerContainerFactory&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ConnectionFactory connectionFactory)&lt;/span&gt;&lt;/span&gt;{\n        SimpleRabbitListenerContainerFactory factory = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; SimpleRabbitListenerContainerFactory();\n        factory.setConnectionFactory(connectionFactory);\n        &lt;span class=&quot;hljs-comment&quot;&gt;//设置并发&lt;/span&gt;\n        factory.setConcurrentConsumers(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;);\n        SimpleMessageListenerContainer s=&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; SimpleMessageListenerContainer();\n        &lt;span class=&quot;hljs-comment&quot;&gt;//最大并发&lt;/span&gt;\n        factory.setMaxConcurrentConsumers(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;);\n        &lt;span class=&quot;hljs-comment&quot;&gt;//消息接收&mdash;&mdash;手动确认&lt;/span&gt;\n        factory.setAcknowledgeMode(AcknowledgeMode.MANUAL);\n        &lt;span class=&quot;hljs-comment&quot;&gt;//设置超时&lt;/span&gt;\n        factory.setReceiveTimeout(&lt;span class=&quot;hljs-number&quot;&gt;2000L&lt;/span&gt;);\n        &lt;span class=&quot;hljs-comment&quot;&gt;//设置重试间隔&lt;/span&gt;\n        factory.setFailedDeclarationRetryInterval(&lt;span class=&quot;hljs-number&quot;&gt;3000L&lt;/span&gt;);\n        &lt;span class=&quot;hljs-comment&quot;&gt;//监听自定义格式转换&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;//factory.setMessageConverter(jsonMessageConverter);&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; factory;\n    }\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;4__218&quot;&gt;&lt;/a&gt;4. 消息确认常用方法&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__220&quot;&gt;&lt;/a&gt;1. 确认消费的方法&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;void basicAck(long deliveryTag, boolean multiple) throws IOException&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;参数说明：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;deliveryTag：消息ID，从1开始&lt;/li&gt;\n&lt;li&gt;multiple：是否批量，将一次性ack所有小于deliveryTag的消息。&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h4&gt;&lt;a id=&quot;2__229&quot;&gt;&lt;/a&gt;2. 反馈消息消费失败的方法&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;void basicNack(long deliveryTag, boolean multiple, boolean requeue) throws IOException&lt;/p&gt;\n&lt;p&gt;basicReject(long deliveryTag, boolean requeue) throws IOException&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;参数说明：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;deliveryTag：消息ID，从1开始&lt;/li&gt;\n&lt;li&gt;multiple：是否批量，将一次性拒绝所有小于deliveryTag的消息。&lt;/li&gt;\n&lt;li&gt;requeue：被拒绝的是否重新入队列。&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;5__241&quot;&gt;&lt;/a&gt;5. 代码编写&lt;/h3&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; RabbitMQ - 消息队列监听类\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.consumer.listener\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/20 星期五 16:20\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Component&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitMQListener&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     *\n     * 确认消费成功的方法\n     *  void basicAck(long deliveryTag, boolean multiple) throws IOException\n     *\n     * 参数说明：index\n     *      1. deliveryTag：消息ID，从1开始\n     *      2. multiple：是否批量，将一次性ack所有小于deliveryTag的消息。\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; message\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; channel\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@RabbitListener&lt;/span&gt;(queues = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.queue.user&quot;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;listenerQueueUser&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Message message, Channel channel)&lt;/span&gt;&lt;/span&gt;{\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;普通用户阅读了&quot;&lt;/span&gt;+&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(message.getBody()));\n        System.out.println(message.getMessageProperties().getDeliveryTag());\n        &lt;span class=&quot;hljs-keyword&quot;&gt;try&lt;/span&gt; {\n            channel.basicAck(message.getMessageProperties().getDeliveryTag(),&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;);\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 失败确认\n     *  方法一：void basicNack(long deliveryTag, boolean multiple, boolean requeue) throws IOException\n     *  方法二：basicReject(long deliveryTag, boolean requeue) throws IOException\n     * 参数说明：\n     *      1. deliveryTag：消息ID，从1开始\n     *      2. multiple：是否批量，将一次性拒绝所有小于deliveryTag的消息。\n     *      3. requeue：被拒绝的是否重新入队列。\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; message\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; channel\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@RabbitListener&lt;/span&gt;(queues = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.queue.user.vip&quot;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;listenerQueueUserVip&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Message message,Channel channel)&lt;/span&gt;&lt;/span&gt;{\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;VIP用户阅读了&quot;&lt;/span&gt;+&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(message.getBody()));\n        &lt;span class=&quot;hljs-keyword&quot;&gt;try&lt;/span&gt; {\n            channel.basicNack(message.getMessageProperties().getDeliveryTag(),&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;);\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n',0,0,'2021-03-29 21:36:06','2021-03-29 21:36:06',0),('1377587134804758530','1369634113126825985','RabbitMQ基础学习','# RabbitMQ基础学习\n\n> 参考资料：黑马RabbitMQ\n\n# 一、 消息队列概述\n\n## 1. 什么是消息中间件\n\n​		MQ全称为Message Queue，消息队列是应用程序和应用程序之间的通信方法。消息队列是一种异步的服务间通信方式，适用于无服务器和微服务架构。消息在被处理和删除之前一直存储在队列上。每条消息仅可被一位用户处理一次。消息队列可被用于分离重量级处理、缓冲或批处理工作以及缓解高峰期工作负载。是一种典型的生产者-消费者模型。\n\n## 2. 为什么使用消息中间件\n\n​		在项目中，可将一些无需即时返回且耗时的操作提取出来，进行**异步处理**，而这种异步处理的方式大大的节省了服务器的请求响应时间，从而**提高**了**系统**的**吞吐量**。\n\n## 3. MQ常用应用场景\n\n### 1. 任务异步处理\n\n​		将不需要同步处理的并且耗时长的操作由消息队列通知消息接收方进行异步处理。提高了应用程序的响应时间。\n\n### 2. 应用程序解耦合\n\n​		MQ相当于一个中介，生产方通过MQ与消费方交互，它将应用程序进行解耦合。\n\n### 3. 削峰填谷\n\n​		如订单系统，在下单的时候就会往数据库写数据。但是数据库只能支撑每秒1000左右的并发写入，并发量再高就容易宕机。低峰期的时候并发也就100多个，但是在高峰期时候，并发量会突然激增到5000以上，这个时候数据库肯定卡死了。此时，我们可以采用MQ来进行**削峰填谷**，具体就是：\n​		由MQ来将消息存储起来，服务器根据自己的处理能力慢慢处理，这样，服务器就不会因为突发的高并发访问而挂掉了。**削峰**：高并发时期的处理请求被保存，没有立即执行。**填谷**：高并发后，服务器慢慢处理MQ保存的请求。\n\n- 使用MQ前\n\n![削峰填谷前](https://gitee.com/yezio/images/raw/master/img/20210112144011.jpg)\n\n- 使用MQ后\n\n![削峰填谷后](https://gitee.com/yezio/images/raw/master/img/20210112144016.jpg)\n\n- **削峰填谷**图解\n\n![03](https://gitee.com/yezio/images/raw/master/img/20210112144022.jpg)\n\n## 4. AMQP 和 JMS\n\n​		MQ是消息通信的模型；实现MQ的大致有两种主流方式：AMQP、JMS。\n\n### 1. AMQP\n\n​		AMQP是一种协议，更准确的说是一种binary wire-level protocol（链接协议）。这是其和JMS的**本质差别**，AMQP不从API层进行限定，而是直接定义网络交换的数据格式。\n\n### 2. JMS\n\n​	JMS即Java消息服务（JavaMessage Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。\n\n### 3. AMQP 和 JMS 的区别\n\n- JMS是定义了统一的接口，来对消息操作进行统一；AMQP是通过规定协议来统一数据交互的格式\n- JMS限定了必须使用Java语言；AMQP只是协议，不规定实现方式，因此是跨语言的。\n- JMS规定了两种消息模式；而AMQP的消息模式更加丰富\n\n## 5. 常见的MQ产品\n\n目前市场上常见的消息队列产品如下：\n\n- ActiveMQ：基于JMS\n- ZeroMQ：基于C语言开发\n- RabbitMQ：基于AMQP协议，erlang语言开发，稳定性好\n- RocketMQ：基于JMS，阿里巴巴产品\n- Kafka：类似MQ的产品；分布式消息系统，高吞吐量\n\n## 6. RabbitMQ\n\n​		RabbitMQ是由erlang语言开发，基于AMQP（Advanced Message Queue 高级消息队列协议）协议实现的消息队列，它是一种应用程序之间的通信方法，消息队列在分布式系统开发中应用非常广泛。\n\n> [RabbitMQ官方地址]: http://www.rabbitmq.com/\n\nRabbitMQ提供了6种模式：\n\n- 基本消息模型\n- work工作模式\n- publish/subscribe（发布/订阅模式，也称 广播模式）\n- routing（路由模式）\n- Topics（通配符模式）\n- RPC远程调用模式（暂不作记录）\n\n> [官网对应模式介绍]: https://www.rabbitmq.com/getstarted.html\n\n# 二、安装及配置RabbitMQ\n\n> [参考博客]: https://blog.csdn.net/qq_39246334/article/details/109486441?biz_id=102&amp;utm_term=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85RabbitMQ&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-109486441&amp;spm=1018.2118.3001.4449\n>\n> \n\n# 三、RabbitMQ六种工作模式\n\n## 入门项目搭建\n\n### 1. 创建项目\n\n​		分别创建两个项目，一个作为生产者，一个作为消费者。项目结构如下：\n\n![RabbitMQ入门环境搭建](https://gitee.com/yezio/images/raw/master/img/20210112144027.png)\n\n### 2. 导入依赖\n\n> 在两个项目中分别导入以下依赖\n\n```xml\n    <dependency>\n        <groupId>com.rabbitmq</groupId>\n        <artifactId>amqp-client</artifactId>\n        <version>5.7.1</version>\n    </dependency>\n```\n\n### 3. 编写获取连接工具类\n\n> 两个工程都需要这个工具类，复制一份即可\n\n```java\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n\n/**\n * @author 叶子\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.util\n * @Data 2020/11/19 星期四 14:49\n */\npublic class ConnectionUtil {\n    /**\n     * RabbitMQ主机地址\n     */\n    private static final String HOSt = \"Linux主机地址\";\n    /**\n     * 端口\n     */\n    private static final Integer PORT = 5672;\n    /**\n     * 虚拟机\n     * 一个RabbitMQ服务可以设置多个虚拟机\n     */\n    private static final String VIRTUALHOST = \"/test\";\n    /**\n     * 用户名\n     */\n    private static final String USERNAME = \"叶子\";\n    /**\n     * 密码\n     */\n    private static final String PASSWORD = \"yezi\";\n\n\n    /**\n     * 创建连接\n     * @return\n     * @throws Exception\n     */\n    public static Connection getConnection(){\n        ConnectionFactory factory = new ConnectionFactory();\n\n        factory.setHost(HOSt);\n        factory.setPort(PORT);\n        factory.setVirtualHost(VIRTUALHOST);\n        factory.setUsername(USERNAME);\n        factory.setPassword(PASSWORD);\n        Connection connection = null;\n        try {\n            connection = factory.newConnection();\n        } catch (IOException e) {\n            e.printStackTrace();\n        } catch (TimeoutException e) {\n            e.printStackTrace();\n        }\n\n        return connection;\n    }\n}\n\n```\n\n注意导包是否正确！！！\n\n## 1. 基本消息模型（简单模式）\n\n### 1. 官网图解\n\n![基本消息模型](https://gitee.com/yezio/images/raw/master/img/20210112144034.png)\n\n- ==P== ：生产者\n- 红格：消息队列\n- ==C== ：消费者\n\n### 2. 处理流程\n\n1. 生产者向消息队列发送消息\n2. 消费者通过监听指定消息队列获取消息\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n\n/**\n * 演示基本消息模型\n * 案例：\n *      叶子给A用户发了一条私聊消息\n *\n *  基本消息模型：\n *      组成：\n *          1. 一个生产者\n *          2. 一个消费者\n *          3. 一个消息队列\n *      生产者 和 消费者 通过消息队列进行消息处理\n *      这个模型实际上使用了默认的交换机\n *\n * 这里使用的是部署在阿里云上的RabbitMQ服务，所以记得开放使用到的端口！！！\n *  启动这个类后可以在RabbitMQ控制面板上看到一个新的消息队列\n *\n * @author 叶子\n * @Description 基本消息模型-生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.basic\n * @Data 2020/11/19 星期四 15:02\n */\npublic class BasicProducer {\n    private static final String QUEUE_NAME = \"basic_test\";\n    private static final String MESSAGE = \"Hello,RabbitMQ!\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建连接通道，只有使用通道才能完成消息相关操作\n        Channel channel = conn.createChannel();\n        /**\n         * ③ 声明消息队列，假如没有这个消息队列，就会自动创建\n         * queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. durable 是否持久化（关闭后消息不丢失）\n         *      3. exclusive 是否独占连接，队列只允许在该连接中访问，如果connection连接关闭队列则自动删除,如果将此参数设置true可用于临时队列的创建\n         *      4. autoDelete 是否自动删除，队列不再使用时是否自动删除此队列，如果将此参数和exclusive参数设置为true就可以实现临时队列（队列不用了就自动删除）\n         *      5. arguments 参数，可以设置一个队列的扩展参数，比如：可设置存活时间\n         */\n        channel.queueDeclare(QUEUE_NAME,false,false,true,null);\n\n        /**\n         * ④ 向指定消息队列中发送消息\n         * basicPublish(String exchange, String routingKey, boolean mandatory, boolean immediate, BasicProperties props, byte[] body)\n         * 参数说明：\n         *      1. exchange 指定交换机名称，如果不指定将使用mq的默认交换机（需要设置为\"\"）\n         *      2. routingKey 指定路由key，交换机根据路由key来将消息转发到指定的队列，如果使用默认交换机，routingKey设置为队列的名称\n         *      3. mandatory\n         *      4. immediate\n         *      5. props 消息属性\n         *      6. body 要发送的消息\n         *\n         * 注意：\n         *  1. 这里使用的是basicPublish方法的重载形式，只需要参数 1 2 5 6\n         *  2. 使用默认交换机，所以交换机名称设置为 \"\"\n         *  3. 使用默认交换机，所以路由key设置为队列名称\n         */\n        channel.basicPublish(\"\",QUEUE_NAME,null,MESSAGE.getBytes());\n\n        // ⑤ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n#### 2. 消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * 启动这个类后，可以在RabbitMQ控制台的Channels项下看到一个新的Channel\n *\n * @author 叶子\n * @Description 基本消息模型-消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.basic\n * @Data 2020/11/19 星期四 15:51\n */\npublic class BasicConsumer {\n    private static final String QUEUE_NAME = \"basic_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建连接通道，没有通道就无法进行消息处理\n        Channel channel = conn.createChannel();\n\n        /**\n         * ③ 声明消息队列\n         *      假如没有指定消息队列，就会自动创建\n         *      如果生产者已经创建了指定队列，就可以不在此处进行声明\n         * 此处不再进行声明\n         *\n         * 注意：\n         *  如果在生产者中声明了队列，而在消费者中没有声明队列\n         *  那么，不要先启动消费者，否则会因为不存在指定队列而抛出异常\n         */\n\n        // ④ 重写处理消息的方法（消费方法）\n        Consumer consumer = new DefaultConsumer(channel){\n            /**\n             * 消费方法\n             * @param consumerTag 消费者标签，用来标识消费者\n             * @param envelope 信封 封装了DeliveryTag、exchange(交换机)、RoutingKey(路由key) 三个信息\n             * @param properties 消息属性，这里生产者没有进行设置，所以很多为null\n             * @param body 接收的消息\n             * @throws IOException\n             */\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"consumerTag--->\"+consumerTag);\n                System.out.println(\"DeliveryTag--->\"+envelope.getDeliveryTag());\n                // 交换机\n                System.out.println(\"exchange------>\"+envelope.getExchange());\n                //路由key\n                System.out.println(\"RoutingKey---->\"+envelope.getRoutingKey());\n                System.out.println(\"properties---->\"+properties);\n                System.out.println(\"接受的消息是--->\"+new String(body));\n            }\n        };\n\n        /**\n         * ⑤ 设置监听队列\n         * 参数明细：\n         * 1、queue 队列名称\n         * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n         * 3、callback，消费方法，当消费者接收到消息要执行的方法\n         */\n        channel.basicConsume(QUEUE_NAME,true,consumer);\n\n        /**\n         * 注意：\n         *  消费者要一直监听生产者的动作，所以在此不要关闭连接！\n         *  不要关闭连接！\n         */\n    }\n}\n\n```\n\n## 2. Work工作模式\n\n#### 1. 官网图解\n\n![Work工作模式](https://gitee.com/yezio/images/raw/master/img/20210112144041.png)\n\n#### 2. 处理流程\n\n1. 生产者向消息队列发送消息\n2. 多个消费者通过监听同一个指定的消息队列获取消息\n\n注意：这些消费者之间是竞争关系！\n\n#### 3. 应用\n\n可以通过创建多个消费者的方式提高消息处理效率。\n\n#### 4. 代码编写\n\n##### 1. 生产者\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示Work工作模式\n *  案例：\n *      叶子在游戏上发布了一系列任务，任务完成数量越多，奖励越多\n *\n * Work工作模式\n *  组成：一个生产者 + 多个消费者 + 一个消息队列\n *  多个消费者共同竞争一个消息队列中待处理的消息，提高了处理效率\n *\n * @author 叶子\n * @Description Work模式-生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.work\n * @Data 2020/11/19 星期四 17:24\n */\npublic class WorkProducer {\n    private static final String QUEUE_NAME = \"work_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n        channel.queueDeclare(QUEUE_NAME,false,false,true,null);\n        // ④ 发送多条消息\n        for (int i = 1; i <= 20; i++) {\n            String message = \"第\" + i + \"条消息\";\n            channel.basicPublish(\"\",QUEUE_NAME,null,message.getBytes());\n        }\n\n        // ⑤ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n##### 2. 两个消费者\n\n> ①号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description Work模式-①号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.work\n * @Data 2020/11/19 星期四 17:34\n */\npublic class WorkConsumer1 {\n    private static final String QUEUE_NAME = \"work_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"一号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME,true,consumer);\n    }\n}\n\n```\n\n> ②号消费者\n\n````java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description Work模式-②号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.work\n * @Data 2020/11/19 星期四 17:39\n */\npublic class WorkConsumer2 {\n    private static final String QUEUE_NAME = \"work_test\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"二号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME,true,consumer);\n    }\n}\n````\n\n## 3. Publish/Subscribe（发布/订阅模式，也称 广播模式）\n\n### 1. 官网图解\n\n![PublishSubscribe](https://gitee.com/yezio/images/raw/master/img/20210112144047.png)\n\n### 2. 处理流程\n\n1. 创建交换机 + 声明队列\n\n2. 交换机绑定队列 （泛式绑定，没有指定路由key）\n\n3. 生产者发送消息给交换机，交换机将消息转发给所有绑定的消息队列\n\n4. 消费者通过监听消息队列获取消息\n\n   ​	因为在这里消息会被同等转发给所有消息队列，不存在差异（即部分消息队列可以收到消息，部分收不到），类似于广播，所以被称为**广播/订阅模式**。\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n```java\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示发布/订阅模式（广播模式）\n *  案例：\n *      叶子的个人博客更新时，所有订阅用户都会收到推送\n * 发布/订阅 模式\n * 组成：\n *      1. 一个交换机，类型为 fanout\n *      2. 多个消息队列 ，和交换机进行绑定（routingKey 设置为 \"\"）\n *      3. 多个消费者\n * 信息发送给交换机，交换机将信息转发给所有绑定的消息队列，所有 \"订阅\" 绑定消息队列的消费者都能接收到消息\n * 注意：\n *      1. 这里的 消息队列和交换机 之间属于任意绑定模式，不存在路由分发，所以所有绑定的消息队列可以接收到相同消息\n *      2. 路由模式采用路由分发的方式实现：不同的信息交给不同的消息队列\n *\n * 尚不了解的问题：\n *      1. 订阅者处理消息是否有先后顺序，能否同时处理同一个消息？\n * @author 叶子\n * @Description 发布/订阅模式 - 生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.publish_subscribe\n * @Data 2020/11/19 星期四 18:23\n */\npublic class PublishProducer {\n    private static final String EXCHANGE_NAME = \"exchange_fanout\";\n    private static final String QUEUE_NAME_1 = \"fanout_test_1\";\n    private static final String QUEUE_NAME_2 = \"fanout_test_2\";\n    private static final String MESSAGE = \"叶子博客更新了！\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n\n        /**\n         * ③ 声明exchange（交换机），指定类型为fanout\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);\n\n        // ④ 声明队列\n        channel.queueDeclare(QUEUE_NAME_1,false,false,true,null);\n        channel.queueDeclare(QUEUE_NAME_2,false,false,true,null);\n\n        /**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 \"\"\n         *      4. arguments 参数\n         */\n        channel.queueBind(QUEUE_NAME_1,EXCHANGE_NAME,\"\");\n        channel.queueBind(QUEUE_NAME_2,EXCHANGE_NAME,\"\");\n\n        /**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */\n        channel.basicPublish(EXCHANGE_NAME,\"\",null,MESSAGE.getBytes());\n        // ⑥ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n#### 2. 两个消费者\n\n> ①号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 发布/订阅模式 - ①号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * @Data 2020/11/19 星期四 18:53\n */\npublic class SubscribeConsumer1 {\n    private static final String QUEUE_NAME_1 = \"fanout_test_1\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"一号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_1,true,consumer);\n    }\n}\n```\n\n> ②号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 发布/订阅模式 - ②号消费者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * @Data 2020/11/19 星期四 18:53\n */\npublic class SubscribeConsumer2 {\n    private static final String QUEUE_NAME_2 = \"fanout_test_2\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"二号消费者 处理了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_2,true,consumer);\n    }\n}\n```\n\n## 4. Routing（路由模式）\n\n### 1. 官网图解\n\n![Routing](https://gitee.com/yezio/images/raw/master/img/20210112144054.png)\n\n### 2. 处理流程\n\n1. 创建交换机 + 消息队列\n2. 交换机通过不同的 ==routingkey== 绑定到不同的消息队列（路由key）\n3. 生产者将消息发送给交换机，指定 ==routingkey==\n4. 交换机通过 ==routingkey== 确定将消息发送给哪些消息队列\n5. 不同消费者通过监听不同消息队列可能收到不同的消息\n\n核心：**依据 routingkey 实现了消息的选择性发送**\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n````java\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示路由模式：\n *  案例：\n *      叶子开辟了个人的付费专栏，该专栏发布的博客只有VIP用户可以查看\n *      免费博客所有人都可以查看\n *\n * 路由模式：\n *  组成：\n *      1. 一个生产者\n *      2. 一个交换机\n *      3. 多个消息队列 （通过不同的routingKey绑定到交换机上）\n *      4. 多个消费者\n *  流程分析：\n *      1. 生产者发送消息时指定交换机+routingKey\n *      2. 交换机根据 routingKey 将消息发送到对应的消息队列\n *      3. 消费者接收绑定消息队列的消息\n *  核心：根据 routingKey 实现路由分发\n *      消息指定的 routingKey 和消息队列绑定的 routingKey 匹配时，该消息队列才能收到该消息\n *\n * @author 叶子\n * @Description 路由模式 - 生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.routing\n * @Data 2020/11/19 星期四 19:28\n */\npublic class RoutingProducer {\n    private static final String EXCHANGE_NAME = \"exchange_direct\";\n\n    private static final String QUEUE_NAME_USER = \"direct_user\";\n    private static final String QUEUE_NAME_USER_VIP = \"direct_user_vip\";\n\n    private static final String ROUTING_KEY_USER = \"user\";\n    private static final String ROUTING_KEY_USER_VIP = \"user_vip\";\n\n    private static final String MESSAGE_USER = \"叶子的免费博客！\";\n    private static final String MESSAGE_USER_VIP = \"叶子的vip付费专栏博客！\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n\n        /**\n         * ③ 声明exchange（交换机），指定类型为direct\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n\n        // ④ 声明队列\n        channel.queueDeclare(QUEUE_NAME_USER,false,false,true,null);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,false,false,true,null);\n\n        /**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map<String, Object> arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 \"\"\n         *      4. arguments 参数\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         */\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        /**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,null,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,null,MESSAGE_USER_VIP.getBytes());\n        // ⑥ 关闭连接\n        channel.close();\n        conn.close();\n    }\n\n}\n\n````\n\n#### 1. 两个消费者\n\n> ①号消费者\n\n````java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 路由模式 - ①号消费者（普通用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class RoutingConsumerUser {\n    private static final String QUEUE_NAME_USER = \"direct_user\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"普通用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER,true,consumer);\n    }\n}\n\n````\n\n> ②号消费者\n\n````java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 路由模式 - ②号消费者（VIP用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class RoutingConsumerUserVip {\n    private static final String QUEUE_NAME_USER_VIP = \"direct_user_vip\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"VIP用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER_VIP,true,consumer);\n    }\n}\n````\n\n## 5. topic（通配符模式）\n\n### 1. 官网图解\n\n![topic](https://gitee.com/yezio/images/raw/master/img/20210112144101.png)\n\n### 2. 处理流程\n\ntopic的处理流程和routing的处理流程其实差不多，只是topic的 ==routingkey== 使用了更强大、更灵活的通配符\n\n- ==*== ：恰好匹配一个**单词**\n- ==#== ：匹配一个或多个**单词**\n\n例如：*.user 可以匹配 admin.user 但不能匹配 vip.admin.user。  而 #.user 就可以匹配。\n\n1. 创建交换机 + 消息队列\n2. 交换机通过不同的 ==routingkey== 绑定到不同的消息队列（路由key）\n3. 生产者将消息发送给交换机，指定 ==routingkey==\n4. 交换机通过 ==routingkey== 确定将消息发送给哪些消息队列\n5. 不同消费者通过监听不同消息队列可能收到不同的消息\n\n### 3. 代码编写\n\n#### 1. 生产者\n\n```java\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n/**\n * 演示通配符模式\n * 实现routing模式的案例\n *\n * 其实通配符和路由模式都是基于路由分发实现的，只是通配符模式引入了两个通配符\n * 使用起来更加方便，功能更强大\n *\n * @author 叶子\n * @Description 通配符匹配模式 - 生产者\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.producer.messageModel.topic\n * @Data 2020/11/19 星期四 20:12\n */\npublic class TopicProducer {\n    private static final String EXCHANGE_NAME = \"topic.direct\";\n\n    private static final String QUEUE_NAME_USER = \"topic.user\";\n    private static final String QUEUE_NAME_USER_VIP = \"topic.user.vip\";\n\n    private static final String ROUTING_KEY_USER = \"*.user\";    //可以匹配到普通用户和VIP用户\n    private static final String ROUTING_KEY_USER_VIP = \"#.vip\"; //只能匹配到VIP用户\n\n    private static final String MESSAGE_USER = \"叶子的免费博客！\";\n    private static final String MESSAGE_USER_VIP = \"叶子的vip付费专栏博客！\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n\n        // ③ 声明exchange（交换机），指定类型为topic\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);\n\n        // ④ 声明队列\n        channel.queueDeclare(QUEUE_NAME_USER,false,false,true,null);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,false,false,true,null);\n\n        /**\n         * ⑤ 队列绑定交换机\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         *\n         *  * 恰好匹配一个单词\n         *  # 匹配一个及以上的单词\n         */\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        /**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,null,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,null,MESSAGE_USER_VIP.getBytes());\n        // ⑥ 关闭连接\n        channel.close();\n        conn.close();\n    }\n}\n```\n\n### 2. 两个消费者\n\n> ①号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 通配符匹配模式 - ①号消费者（普通用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class TopicConsumerUser {\n    private static final String QUEUE_NAME_USER = \"topic.user\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"普通用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER,true,consumer);\n    }\n}\n```\n\n>②号消费者\n\n```java\nimport com.rabbitmq.client.*;\nimport icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\nimport java.io.IOException;\n\n/**\n * @author 叶子\n * @Description 通配符匹配模式 - ②号消费者（VIP用户）\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.rabbitmq.consumer.messageModel.routing\n * @Data 2020/11/19 星期四 19:39\n */\npublic class TopicConsumerUserVip {\n    private static final String QUEUE_NAME_USER_VIP = \"topic.user.vip\";\n\n    public static void main(String[] args) throws Exception {\n        // ① 获取连接\n        Connection conn = ConnectionUtil.getConnection();\n        // ② 创建通道\n        Channel channel = conn.createChannel();\n        // ③ 声明消息队列\n\n        // ④ 重写消费消息的方法\n        Consumer consumer = new DefaultConsumer(channel){\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {\n                System.out.println(\"VIP用户阅读了\" + new String(body));\n            }\n        };\n        // ⑤ 设置监听队列\n        channel.basicConsume(QUEUE_NAME_USER_VIP,true,consumer);\n    }\n}\n```\n\n## 6. **工作模式总结**\n\n### 1. 分类\n\n其实，依据前面的介绍，我们可以将5种工作模式大致分为两类：\n\n- 非路由模式\n\n  1. 基本消息模型\n  2. work工作模式\n- 路由模式\n  1. Publish/subscribe\n  2. routing\n  3. topic\n\n> 非路由模式和路由模式的区别\n\n1. 非路由模式不使用交换机，直接向消息队列发送消息（其实内部使用了默认的交换机）。而路由模式使用交换机，信息发送给交换机，由交换机负责转发给消息队列\n2. 非路由模式会将消息发给所有绑定的监听队列，而路由模式会由交换机根据==rongtingkey==来确定将消息发送给哪个消息队列。即：就消息发送而言**路由模式具有选择差异性**（Publish/subscribe除外，它使用了默认的==rongtingkey==，也是将消息推送给所有绑定的消息队列）\n3. 路由模式由于使用了==rongtingkey==分发模式而更加灵活\n\n# 四、SpringBoot整合RabbitMQ\n\n## 1. 项目搭建\n\n> 分别创建两个Spring Boot项目，一个作为生产者，一个作为消费者\n\n![SpringBootxiao消息队列](https://gitee.com/yezio/images/raw/master/img/20210112144109.png)\n\n> 导入依赖\n\n````xml\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-amqp</artifactId>\n</dependency>\n````\n\n## 2. 编写生产者代码\n\n> yml文件配置\n\n```yaml\nspring:\n  rabbitmq:\n    host: 主机IP地址\n    port: 5672\n    username: 叶子\n    password: 密码\n    virtual-host: /test\n```\n\n> RabbitMQ配置类\n\n```java\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author 叶子\n * @Description RabbitMQ - 生产者配置类\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.producer.conig\n * @Data 2020/11/20 星期五 16:07\n */\n@Configuration\npublic class RabbitMQConfig {\n    public static final String EXCHANGE = \"boot.exchange\";\n    private static final String QUEUE = \"boot.queue\";\n\n    @Bean(name = EXCHANGE)\n    public Exchange exchange(){\n        return ExchangeBuilder.topicExchange(EXCHANGE).durable(false).autoDelete().build();\n    }\n\n    @Bean(name = QUEUE)\n    public Queue queue(){\n        return QueueBuilder.durable(QUEUE).build();\n    }\n\n    @Bean\n    public Binding binding(@Qualifier(EXCHANGE) Exchange exchange, @Qualifier(QUEUE) Queue queue){\n        return BindingBuilder.bind(queue).to(exchange).with(\"vip.*\").noargs();\n    }\n\n}\n```\n\n> 在测试类中进行测试\n\n````java\n@SpringBootTest\nclass ProducerApplicationTests {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @Test\n    void contextLoads() {\n        rabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE,\"vip.user\",\"Hello,SpringBoot and RabbitMQ!\");\n    }\n\n}\n````\n\n## 3. 编写消费者代码\n\n> yml文件配置和生产者一样\n\n> 编写消息队列监听类\n\n````java\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author 叶子\n * @Description RabbitMQ - 消息队列监听类\n * @DevelopmentTools IntelliJ IDEA\n * @PackageName icu.yezi.consumer.listener\n * @Data 2020/11/20 星期五 16:20\n */\n@Component\npublic class RabbitMQListener {\n\n    @RabbitListener(queues = \"boot.queue\")\n    public void listenerQueue(Message message){\n        System.out.println(new String(message.getBody()));\n    }\n}\n````\n\n注意：消费者可以不添加配置类\n\n## 4. 总结\n\n- 生产者\n\n1. 配置yml文件\n2. 编写配置类\n3. 编写测试类\n\n- 消费者\n\n1. 配置yml文件\n2. 编写消息队列监听类\n\n> 入门学习笔记，如有错误，请于评论区指出，非常感谢！','&lt;h1&gt;&lt;a id=&quot;RabbitMQ_0&quot;&gt;&lt;/a&gt;RabbitMQ基础学习&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;参考资料：黑马RabbitMQ&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h1&gt;&lt;a id=&quot;__4&quot;&gt;&lt;/a&gt;一、 消息队列概述&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;1__6&quot;&gt;&lt;/a&gt;1. 什么是消息中间件&lt;/h2&gt;\n&lt;p&gt;​		MQ全称为Message Queue，消息队列是应用程序和应用程序之间的通信方法。消息队列是一种异步的服务间通信方式，适用于无服务器和微服务架构。消息在被处理和删除之前一直存储在队列上。每条消息仅可被一位用户处理一次。消息队列可被用于分离重量级处理、缓冲或批处理工作以及缓解高峰期工作负载。是一种典型的生产者-消费者模型。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;2__10&quot;&gt;&lt;/a&gt;2. 为什么使用消息中间件&lt;/h2&gt;\n&lt;p&gt;​		在项目中，可将一些无需即时返回且耗时的操作提取出来，进行&lt;strong&gt;异步处理&lt;/strong&gt;，而这种异步处理的方式大大的节省了服务器的请求响应时间，从而&lt;strong&gt;提高&lt;/strong&gt;了&lt;strong&gt;系统&lt;/strong&gt;的&lt;strong&gt;吞吐量&lt;/strong&gt;。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;3_MQ_14&quot;&gt;&lt;/a&gt;3. MQ常用应用场景&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__16&quot;&gt;&lt;/a&gt;1. 任务异步处理&lt;/h3&gt;\n&lt;p&gt;​		将不需要同步处理的并且耗时长的操作由消息队列通知消息接收方进行异步处理。提高了应用程序的响应时间。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__20&quot;&gt;&lt;/a&gt;2. 应用程序解耦合&lt;/h3&gt;\n&lt;p&gt;​		MQ相当于一个中介，生产方通过MQ与消费方交互，它将应用程序进行解耦合。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;3__24&quot;&gt;&lt;/a&gt;3. 削峰填谷&lt;/h3&gt;\n&lt;p&gt;​		如订单系统，在下单的时候就会往数据库写数据。但是数据库只能支撑每秒1000左右的并发写入，并发量再高就容易宕机。低峰期的时候并发也就100多个，但是在高峰期时候，并发量会突然激增到5000以上，这个时候数据库肯定卡死了。此时，我们可以采用MQ来进行&lt;strong&gt;削峰填谷&lt;/strong&gt;，具体就是：&lt;br /&gt;\n​		由MQ来将消息存储起来，服务器根据自己的处理能力慢慢处理，这样，服务器就不会因为突发的高并发访问而挂掉了。&lt;strong&gt;削峰&lt;/strong&gt;：高并发时期的处理请求被保存，没有立即执行。&lt;strong&gt;填谷&lt;/strong&gt;：高并发后，服务器慢慢处理MQ保存的请求。&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;使用MQ前&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144011.jpg&quot; alt=&quot;削峰填谷前&quot; /&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;使用MQ后&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144016.jpg&quot; alt=&quot;削峰填谷后&quot; /&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;削峰填谷&lt;/strong&gt;图解&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144022.jpg&quot; alt=&quot;03&quot; /&gt;&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;4_AMQP__JMS_41&quot;&gt;&lt;/a&gt;4. AMQP 和 JMS&lt;/h2&gt;\n&lt;p&gt;​		MQ是消息通信的模型；实现MQ的大致有两种主流方式：AMQP、JMS。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;1_AMQP_45&quot;&gt;&lt;/a&gt;1. AMQP&lt;/h3&gt;\n&lt;p&gt;​		AMQP是一种协议，更准确的说是一种binary wire-level protocol（链接协议）。这是其和JMS的&lt;strong&gt;本质差别&lt;/strong&gt;，AMQP不从API层进行限定，而是直接定义网络交换的数据格式。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2_JMS_49&quot;&gt;&lt;/a&gt;2. JMS&lt;/h3&gt;\n&lt;p&gt;​	JMS即Java消息服务（JavaMessage Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;3_AMQP__JMS__53&quot;&gt;&lt;/a&gt;3. AMQP 和 JMS 的区别&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;JMS是定义了统一的接口，来对消息操作进行统一；AMQP是通过规定协议来统一数据交互的格式&lt;/li&gt;\n&lt;li&gt;JMS限定了必须使用Java语言；AMQP只是协议，不规定实现方式，因此是跨语言的。&lt;/li&gt;\n&lt;li&gt;JMS规定了两种消息模式；而AMQP的消息模式更加丰富&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2&gt;&lt;a id=&quot;5_MQ_59&quot;&gt;&lt;/a&gt;5. 常见的MQ产品&lt;/h2&gt;\n&lt;p&gt;目前市场上常见的消息队列产品如下：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;ActiveMQ：基于JMS&lt;/li&gt;\n&lt;li&gt;ZeroMQ：基于C语言开发&lt;/li&gt;\n&lt;li&gt;RabbitMQ：基于AMQP协议，erlang语言开发，稳定性好&lt;/li&gt;\n&lt;li&gt;RocketMQ：基于JMS，阿里巴巴产品&lt;/li&gt;\n&lt;li&gt;Kafka：类似MQ的产品；分布式消息系统，高吞吐量&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2&gt;&lt;a id=&quot;6_RabbitMQ_69&quot;&gt;&lt;/a&gt;6. RabbitMQ&lt;/h2&gt;\n&lt;p&gt;​		RabbitMQ是由erlang语言开发，基于AMQP（Advanced Message Queue 高级消息队列协议）协议实现的消息队列，它是一种应用程序之间的通信方法，消息队列在分布式系统开发中应用非常广泛。&lt;/p&gt;\n&lt;blockquote&gt;&lt;/blockquote&gt;\n&lt;p&gt;RabbitMQ提供了6种模式：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;基本消息模型&lt;/li&gt;\n&lt;li&gt;work工作模式&lt;/li&gt;\n&lt;li&gt;publish/subscribe（发布/订阅模式，也称 广播模式）&lt;/li&gt;\n&lt;li&gt;routing（路由模式）&lt;/li&gt;\n&lt;li&gt;Topics（通配符模式）&lt;/li&gt;\n&lt;li&gt;RPC远程调用模式（暂不作记录）&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;&lt;/blockquote&gt;\n&lt;h1&gt;&lt;a id=&quot;RabbitMQ_86&quot;&gt;&lt;/a&gt;二、安装及配置RabbitMQ&lt;/h1&gt;\n&lt;blockquote&gt;&lt;/blockquote&gt;\n&lt;h1&gt;&lt;a id=&quot;RabbitMQ_92&quot;&gt;&lt;/a&gt;三、RabbitMQ六种工作模式&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;_94&quot;&gt;&lt;/a&gt;入门项目搭建&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__96&quot;&gt;&lt;/a&gt;1. 创建项目&lt;/h3&gt;\n&lt;p&gt;​		分别创建两个项目，一个作为生产者，一个作为消费者。项目结构如下：&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144027.png&quot; alt=&quot;RabbitMQ入门环境搭建&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__102&quot;&gt;&lt;/a&gt;2. 导入依赖&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在两个项目中分别导入以下依赖&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-xml&quot;&gt;    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.rabbitmq&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;amqp-client&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n        &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;5.7.1&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;3__114&quot;&gt;&lt;/a&gt;3. 编写获取连接工具类&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;两个工程都需要这个工具类，复制一份即可&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.ConnectionFactory;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.TimeoutException;\n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.util\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 14:49\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ConnectionUtil&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * RabbitMQ主机地址\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String HOSt = &lt;span class=&quot;hljs-string&quot;&gt;&quot;Linux主机地址&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 端口\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; Integer PORT = &lt;span class=&quot;hljs-number&quot;&gt;5672&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 虚拟机\n     * 一个RabbitMQ服务可以设置多个虚拟机\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String VIRTUALHOST = &lt;span class=&quot;hljs-string&quot;&gt;&quot;/test&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 用户名\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String USERNAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 密码\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String PASSWORD = &lt;span class=&quot;hljs-string&quot;&gt;&quot;yezi&quot;&lt;/span&gt;;\n\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * 创建连接\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt;\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@throws&lt;/span&gt; Exception\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Connection &lt;span class=&quot;hljs-title&quot;&gt;getConnection&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n        ConnectionFactory factory = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ConnectionFactory();\n\n        factory.setHost(HOSt);\n        factory.setPort(PORT);\n        factory.setVirtualHost(VIRTUALHOST);\n        factory.setUsername(USERNAME);\n        factory.setPassword(PASSWORD);\n        Connection connection = &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;try&lt;/span&gt; {\n            connection = factory.newConnection();\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {\n            e.printStackTrace();\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt; (TimeoutException e) {\n            e.printStackTrace();\n        }\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; connection;\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;注意导包是否正确！！！&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;1__186&quot;&gt;&lt;/a&gt;1. 基本消息模型（简单模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__188&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144034.png&quot; alt=&quot;基本消息模型&quot; /&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;mark&gt;P&lt;/mark&gt; ：生产者&lt;/li&gt;\n&lt;li&gt;红格：消息队列&lt;/li&gt;\n&lt;li&gt;&lt;mark&gt;C&lt;/mark&gt; ：消费者&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3&gt;&lt;a id=&quot;2__196&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;生产者向消息队列发送消息&lt;/li&gt;\n&lt;li&gt;消费者通过监听指定消息队列获取消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;3__201&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__203&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示基本消息模型\n * 案例：\n *      叶子给A用户发了一条私聊消息\n *\n *  基本消息模型：\n *      组成：\n *          1. 一个生产者\n *          2. 一个消费者\n *          3. 一个消息队列\n *      生产者 和 消费者 通过消息队列进行消息处理\n *      这个模型实际上使用了默认的交换机\n *\n * 这里使用的是部署在阿里云上的RabbitMQ服务，所以记得开放使用到的端口！！！\n *  启动这个类后可以在RabbitMQ控制面板上看到一个新的消息队列\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 基本消息模型-生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.basic\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 15:02\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;BasicProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;basic_test&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;Hello,RabbitMQ!&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建连接通道，只有使用通道才能完成消息相关操作&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明消息队列，假如没有这个消息队列，就会自动创建\n         * queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. durable 是否持久化（关闭后消息不丢失）\n         *      3. exclusive 是否独占连接，队列只允许在该连接中访问，如果connection连接关闭队列则自动删除,如果将此参数设置true可用于临时队列的创建\n         *      4. autoDelete 是否自动删除，队列不再使用时是否自动删除此队列，如果将此参数和exclusive参数设置为true就可以实现临时队列（队列不用了就自动删除）\n         *      5. arguments 参数，可以设置一个队列的扩展参数，比如：可设置存活时间\n         */&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ④ 向指定消息队列中发送消息\n         * basicPublish(String exchange, String routingKey, boolean mandatory, boolean immediate, BasicProperties props, byte[] body)\n         * 参数说明：\n         *      1. exchange 指定交换机名称，如果不指定将使用mq的默认交换机（需要设置为&quot;&quot;）\n         *      2. routingKey 指定路由key，交换机根据路由key来将消息转发到指定的队列，如果使用默认交换机，routingKey设置为队列的名称\n         *      3. mandatory\n         *      4. immediate\n         *      5. props 消息属性\n         *      6. body 要发送的消息\n         *\n         * 注意：\n         *  1. 这里使用的是basicPublish方法的重载形式，只需要参数 1 2 5 6\n         *  2. 使用默认交换机，所以交换机名称设置为 &quot;&quot;\n         *  3. 使用默认交换机，所以路由key设置为队列名称\n         */&lt;/span&gt;\n        channel.basicPublish(&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;,QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE.getBytes());\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;2__279&quot;&gt;&lt;/a&gt;2. 消费者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 启动这个类后，可以在RabbitMQ控制台的Channels项下看到一个新的Channel\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 基本消息模型-消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.basic\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 15:51\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;BasicConsumer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;basic_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建连接通道，没有通道就无法进行消息处理&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明消息队列\n         *      假如没有指定消息队列，就会自动创建\n         *      如果生产者已经创建了指定队列，就可以不在此处进行声明\n         * 此处不再进行声明\n         *\n         * 注意：\n         *  如果在生产者中声明了队列，而在消费者中没有声明队列\n         *  那么，不要先启动消费者，否则会因为不存在指定队列而抛出异常\n         */&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写处理消息的方法（消费方法）&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-comment&quot;&gt;/**\n             * 消费方法\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; consumerTag 消费者标签，用来标识消费者\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; envelope 信封 封装了DeliveryTag、exchange(交换机)、RoutingKey(路由key) 三个信息\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; properties 消息属性，这里生产者没有进行设置，所以很多为null\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; body 接收的消息\n             * &lt;span class=&quot;hljs-doctag&quot;&gt;@throws&lt;/span&gt; IOException\n             */&lt;/span&gt;\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;consumerTag---&amp;gt;&quot;&lt;/span&gt;+consumerTag);\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;DeliveryTag---&amp;gt;&quot;&lt;/span&gt;+envelope.getDeliveryTag());\n                &lt;span class=&quot;hljs-comment&quot;&gt;// 交换机&lt;/span&gt;\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;exchange------&amp;gt;&quot;&lt;/span&gt;+envelope.getExchange());\n                &lt;span class=&quot;hljs-comment&quot;&gt;//路由key&lt;/span&gt;\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;RoutingKey----&amp;gt;&quot;&lt;/span&gt;+envelope.getRoutingKey());\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;properties----&amp;gt;&quot;&lt;/span&gt;+properties);\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;接受的消息是---&amp;gt;&quot;&lt;/span&gt;+&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 设置监听队列\n         * 参数明细：\n         * 1、queue 队列名称\n         * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n         * 3、callback，消费方法，当消费者接收到消息要执行的方法\n         */&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * 注意：\n         *  消费者要一直监听生产者的动作，所以在此不要关闭连接！\n         *  不要关闭连接！\n         */&lt;/span&gt;\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;2_Work_359&quot;&gt;&lt;/a&gt;2. Work工作模式&lt;/h2&gt;\n&lt;h4&gt;&lt;a id=&quot;1__361&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h4&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144041.png&quot; alt=&quot;Work工作模式&quot; /&gt;&lt;/p&gt;\n&lt;h4&gt;&lt;a id=&quot;2__365&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h4&gt;\n&lt;ol&gt;\n&lt;li&gt;生产者向消息队列发送消息&lt;/li&gt;\n&lt;li&gt;多个消费者通过监听同一个指定的消息队列获取消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;注意：这些消费者之间是竞争关系！&lt;/p&gt;\n&lt;h4&gt;&lt;a id=&quot;3__372&quot;&gt;&lt;/a&gt;3. 应用&lt;/h4&gt;\n&lt;p&gt;可以通过创建多个消费者的方式提高消息处理效率。&lt;/p&gt;\n&lt;h4&gt;&lt;a id=&quot;4__376&quot;&gt;&lt;/a&gt;4. 代码编写&lt;/h4&gt;\n&lt;h5&gt;&lt;a id=&quot;1__378&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h5&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示Work工作模式\n *  案例：\n *      叶子在游戏上发布了一系列任务，任务完成数量越多，奖励越多\n *\n * Work工作模式\n *  组成：一个生产者 + 多个消费者 + 一个消息队列\n *  多个消费者共同竞争一个消息队列中待处理的消息，提高了处理效率\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; Work模式-生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.work\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 17:24\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WorkProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;work_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 发送多条消息&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;; i &amp;lt;= &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;; i++) {\n            String message = &lt;span class=&quot;hljs-string&quot;&gt;&quot;第&quot;&lt;/span&gt; + i + &lt;span class=&quot;hljs-string&quot;&gt;&quot;条消息&quot;&lt;/span&gt;;\n            channel.basicPublish(&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;,QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,message.getBytes());\n        }\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h5&gt;&lt;a id=&quot;2__423&quot;&gt;&lt;/a&gt;2. 两个消费者&lt;/h5&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; Work模式-①号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.work\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 17:34\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WorkConsumer1&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;work_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;一号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; Work模式-②号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.work\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 17:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WorkConsumer2&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;work_test&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;二号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;3_PublishSubscribe__502&quot;&gt;&lt;/a&gt;3. Publish/Subscribe（发布/订阅模式，也称 广播模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__504&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144047.png&quot; alt=&quot;PublishSubscribe&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__508&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;创建交换机 + 声明队列&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;交换机绑定队列 （泛式绑定，没有指定路由key）&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;生产者发送消息给交换机，交换机将消息转发给所有绑定的消息队列&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;消费者通过监听消息队列获取消息&lt;/p&gt;\n&lt;p&gt;​	因为在这里消息会被同等转发给所有消息队列，不存在差异（即部分消息队列可以收到消息，部分收不到），类似于广播，所以被称为&lt;strong&gt;广播/订阅模式&lt;/strong&gt;。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;3__520&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__522&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.BuiltinExchangeType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示发布/订阅模式（广播模式）\n *  案例：\n *      叶子的个人博客更新时，所有订阅用户都会收到推送\n * 发布/订阅 模式\n * 组成：\n *      1. 一个交换机，类型为 fanout\n *      2. 多个消息队列 ，和交换机进行绑定（routingKey 设置为 &quot;&quot;）\n *      3. 多个消费者\n * 信息发送给交换机，交换机将信息转发给所有绑定的消息队列，所有 &quot;订阅&quot; 绑定消息队列的消费者都能接收到消息\n * 注意：\n *      1. 这里的 消息队列和交换机 之间属于任意绑定模式，不存在路由分发，所以所有绑定的消息队列可以接收到相同消息\n *      2. 路由模式采用路由分发的方式实现：不同的信息交给不同的消息队列\n *\n * 尚不了解的问题：\n *      1. 订阅者处理消息是否有先后顺序，能否同时处理同一个消息？\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 发布/订阅模式 - 生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.publish_subscribe\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 18:23\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;PublishProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;exchange_fanout&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_1 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_1&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_2 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_2&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子博客更新了！&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明exchange（交换机），指定类型为fanout\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */&lt;/span&gt;\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 声明队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME_1,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        channel.queueDeclare(QUEUE_NAME_2,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 &quot;&quot;\n         *      4. arguments 参数\n         */&lt;/span&gt;\n        channel.queueBind(QUEUE_NAME_1,EXCHANGE_NAME,&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;);\n        channel.queueBind(QUEUE_NAME_2,EXCHANGE_NAME,&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */&lt;/span&gt;\n        channel.basicPublish(EXCHANGE_NAME,&lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE.getBytes());\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑥ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;2__607&quot;&gt;&lt;/a&gt;2. 两个消费者&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 发布/订阅模式 - ①号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 18:53\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;SubscribeConsumer1&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_1 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_1&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;一号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_1,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 发布/订阅模式 - ②号消费者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.publish_subscribe\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 18:53\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;SubscribeConsumer2&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_2 = &lt;span class=&quot;hljs-string&quot;&gt;&quot;fanout_test_2&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;二号消费者 处理了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_2,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;4_Routing_685&quot;&gt;&lt;/a&gt;4. Routing（路由模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__687&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144054.png&quot; alt=&quot;Routing&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__691&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;创建交换机 + 消息队列&lt;/li&gt;\n&lt;li&gt;交换机通过不同的 &lt;mark&gt;routingkey&lt;/mark&gt; 绑定到不同的消息队列（路由key）&lt;/li&gt;\n&lt;li&gt;生产者将消息发送给交换机，指定 &lt;mark&gt;routingkey&lt;/mark&gt;&lt;/li&gt;\n&lt;li&gt;交换机通过 &lt;mark&gt;routingkey&lt;/mark&gt; 确定将消息发送给哪些消息队列&lt;/li&gt;\n&lt;li&gt;不同消费者通过监听不同消息队列可能收到不同的消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;核心：&lt;strong&gt;依据 routingkey 实现了消息的选择性发送&lt;/strong&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;3__701&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__703&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.BuiltinExchangeType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示路由模式：\n *  案例：\n *      叶子开辟了个人的付费专栏，该专栏发布的博客只有VIP用户可以查看\n *      免费博客所有人都可以查看\n *\n * 路由模式：\n *  组成：\n *      1. 一个生产者\n *      2. 一个交换机\n *      3. 多个消息队列 （通过不同的routingKey绑定到交换机上）\n *      4. 多个消费者\n *  流程分析：\n *      1. 生产者发送消息时指定交换机+routingKey\n *      2. 交换机根据 routingKey 将消息发送到对应的消息队列\n *      3. 消费者接收绑定消息队列的消息\n *  核心：根据 routingKey 实现路由分发\n *      消息指定的 routingKey 和消息队列绑定的 routingKey 匹配时，该消息队列才能收到该消息\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 路由模式 - 生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:28\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RoutingProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;exchange_direct&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user_vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;user&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;user_vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的免费博客！&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的vip付费专栏博客！&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ③ 声明exchange（交换机），指定类型为direct\n         * exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. exchange 交换机名称\n         *      2. type 交换机类型\n         *      3. durable 是否持久化\n         *      4. autoDelete 是否自动删除\n         *      5. internal\n         *      6. arguments 额外指定参数\n         */&lt;/span&gt;\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 声明队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 队列绑定交换机\n         * queueBind(String queue, String exchange, String routingKey, Map&amp;lt;String, Object&amp;gt; arguments)\n         * 参数说明：\n         *      1. queue 队列名称\n         *      2. exchange 交换机名称\n         *      3. routingKey 路由key\n         *          如果交换机类型为： fanout ，则routingKey设置为 &quot;&quot;\n         *      4. arguments 参数\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         */&lt;/span&gt;\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */&lt;/span&gt;\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER_VIP.getBytes());\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑥ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h4&gt;&lt;a id=&quot;1__811&quot;&gt;&lt;/a&gt;1. 两个消费者&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 路由模式 - ①号消费者（普通用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RoutingConsumerUser&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;普通用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 路由模式 - ②号消费者（VIP用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RoutingConsumerUserVip&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;direct_user_vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;VIP用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;5_topic_890&quot;&gt;&lt;/a&gt;5. topic（通配符模式）&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__892&quot;&gt;&lt;/a&gt;1. 官网图解&lt;/h3&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144101.png&quot; alt=&quot;topic&quot; /&gt;&lt;/p&gt;\n&lt;h3&gt;&lt;a id=&quot;2__896&quot;&gt;&lt;/a&gt;2. 处理流程&lt;/h3&gt;\n&lt;p&gt;topic的处理流程和routing的处理流程其实差不多，只是topic的 &lt;mark&gt;routingkey&lt;/mark&gt; 使用了更强大、更灵活的通配符&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;mark&gt;*&lt;/mark&gt; ：恰好匹配一个&lt;strong&gt;单词&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;mark&gt;#&lt;/mark&gt; ：匹配一个或多个&lt;strong&gt;单词&lt;/strong&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;例如：*.user 可以匹配 admin.user 但不能匹配 vip.admin.user。  而 #.user 就可以匹配。&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;创建交换机 + 消息队列&lt;/li&gt;\n&lt;li&gt;交换机通过不同的 &lt;mark&gt;routingkey&lt;/mark&gt; 绑定到不同的消息队列（路由key）&lt;/li&gt;\n&lt;li&gt;生产者将消息发送给交换机，指定 &lt;mark&gt;routingkey&lt;/mark&gt;&lt;/li&gt;\n&lt;li&gt;交换机通过 &lt;mark&gt;routingkey&lt;/mark&gt; 确定将消息发送给哪些消息队列&lt;/li&gt;\n&lt;li&gt;不同消费者通过监听不同消息队列可能收到不同的消息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3&gt;&lt;a id=&quot;3__911&quot;&gt;&lt;/a&gt;3. 代码编写&lt;/h3&gt;\n&lt;h4&gt;&lt;a id=&quot;1__913&quot;&gt;&lt;/a&gt;1. 生产者&lt;/h4&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.BuiltinExchangeType;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Channel;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.Connection;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.producer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * 演示通配符模式\n * 实现routing模式的案例\n *\n * 其实通配符和路由模式都是基于路由分发实现的，只是通配符模式引入了两个通配符\n * 使用起来更加方便，功能更强大\n *\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 通配符匹配模式 - 生产者\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.producer.messageModel.topic\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 20:12\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TopicProducer&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.direct&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user.vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;*.user&quot;&lt;/span&gt;;    &lt;span class=&quot;hljs-comment&quot;&gt;//可以匹配到普通用户和VIP用户&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String ROUTING_KEY_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;#.vip&quot;&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;//只能匹配到VIP用户&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的免费博客！&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String MESSAGE_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;叶子的vip付费专栏博客！&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明exchange（交换机），指定类型为topic&lt;/span&gt;\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 声明队列&lt;/span&gt;\n        channel.queueDeclare(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n        channel.queueDeclare(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         * ⑤ 队列绑定交换机\n         *\n         * 注意：对这里的处理逻辑做下简单的解释\n         *  MESSAGE_USER 信息发送给了 路由 ROUTING_KEY_USER，\n         *  而路由 ROUTING_KEY_USER 同时绑定了一般用户和VIP用户两个消息队列，所以他们都能收到消息\n         *  即实现：普通用户+VIP用户 都可以阅读 免费博客！\n         *\n         *  MESSAGE_USER_VIP 信息发送给了路由 ROUTING_KEY_USER_VIP，\n         *  而路由 ROUTING_KEY_USER_VIP 只绑定了 VIP用户的消息队列\n         *  所以实现了：只有VIP用户可以阅读付费专栏博客！\n         *\n         *  * 恰好匹配一个单词\n         *  # 匹配一个及以上的单词\n         */&lt;/span&gt;\n        channel.queueBind(QUEUE_NAME_USER,EXCHANGE_NAME,ROUTING_KEY_USER);\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER);\n\n        channel.queueBind(QUEUE_NAME_USER_VIP,EXCHANGE_NAME,ROUTING_KEY_USER_VIP);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;/**\n         *  发布消息到exchange\n         * 这里交换机会将\n         */&lt;/span&gt;\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER.getBytes());\n        channel.basicPublish(EXCHANGE_NAME,ROUTING_KEY_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;,MESSAGE_USER_VIP.getBytes());\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑥ 关闭连接&lt;/span&gt;\n        channel.close();\n        conn.close();\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h3&gt;&lt;a id=&quot;2__993&quot;&gt;&lt;/a&gt;2. 两个消费者&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;①号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 通配符匹配模式 - ①号消费者（普通用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TopicConsumerUser&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;普通用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;②号消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; com.rabbitmq.client.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; icu.yezi.rabbitmq.consumer.util.ConnectionUtil;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; 通配符匹配模式 - ②号消费者（VIP用户）\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.rabbitmq.consumer.messageModel.routing\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/19 星期四 19:39\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TopicConsumerUserVip&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE_NAME_USER_VIP = &lt;span class=&quot;hljs-string&quot;&gt;&quot;topic.user.vip&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ① 获取连接&lt;/span&gt;\n        Connection conn = ConnectionUtil.getConnection();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ② 创建通道&lt;/span&gt;\n        Channel channel = conn.createChannel();\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ③ 声明消息队列&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ④ 重写消费消息的方法&lt;/span&gt;\n        Consumer consumer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; DefaultConsumer(channel){\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handleDelivery&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, &lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;[] body)&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{\n                System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;VIP用户阅读了&quot;&lt;/span&gt; + &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(body));\n            }\n        };\n        &lt;span class=&quot;hljs-comment&quot;&gt;// ⑤ 设置监听队列&lt;/span&gt;\n        channel.basicConsume(QUEUE_NAME_USER_VIP,&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;,consumer);\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;6__1071&quot;&gt;&lt;/a&gt;6. &lt;strong&gt;工作模式总结&lt;/strong&gt;&lt;/h2&gt;\n&lt;h3&gt;&lt;a id=&quot;1__1073&quot;&gt;&lt;/a&gt;1. 分类&lt;/h3&gt;\n&lt;p&gt;其实，依据前面的介绍，我们可以将5种工作模式大致分为两类：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;非路由模式&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;基本消息模型&lt;/li&gt;\n&lt;li&gt;work工作模式&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;路由模式&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;Publish/subscribe&lt;/li&gt;\n&lt;li&gt;routing&lt;/li&gt;\n&lt;li&gt;topic&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;\n&lt;p&gt;非路由模式和路由模式的区别&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;非路由模式不使用交换机，直接向消息队列发送消息（其实内部使用了默认的交换机）。而路由模式使用交换机，信息发送给交换机，由交换机负责转发给消息队列&lt;/li&gt;\n&lt;li&gt;非路由模式会将消息发给所有绑定的监听队列，而路由模式会由交换机根据&lt;mark&gt;rongtingkey&lt;/mark&gt;来确定将消息发送给哪个消息队列。即：就消息发送而言&lt;strong&gt;路由模式具有选择差异性&lt;/strong&gt;（Publish/subscribe除外，它使用了默认的&lt;mark&gt;rongtingkey&lt;/mark&gt;，也是将消息推送给所有绑定的消息队列）&lt;/li&gt;\n&lt;li&gt;路由模式由于使用了&lt;mark&gt;rongtingkey&lt;/mark&gt;分发模式而更加灵活&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h1&gt;&lt;a id=&quot;SpringBootRabbitMQ_1092&quot;&gt;&lt;/a&gt;四、SpringBoot整合RabbitMQ&lt;/h1&gt;\n&lt;h2&gt;&lt;a id=&quot;1__1094&quot;&gt;&lt;/a&gt;1. 项目搭建&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;分别创建两个Spring Boot项目，一个作为生产者，一个作为消费者&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;img src=&quot;https://gitee.com/yezio/images/raw/master/img/20210112144109.png&quot; alt=&quot;SpringBootxiao消息队列&quot; /&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;导入依赖&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-amqp&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;2__1109&quot;&gt;&lt;/a&gt;2. 编写生产者代码&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;yml文件配置&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=&quot;lang-yaml&quot;&gt;spring:\n  rabbitmq:\n    host: 主机IP地址\n    port: 5672\n    username: 叶子\n    password: 密码\n    virtual-host: /test\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;RabbitMQ配置类&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.amqp.core.*;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.beans.factory.annotation.Qualifier;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.context.annotation.Bean;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.context.annotation.Configuration;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; RabbitMQ - 生产者配置类\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.producer.conig\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/20 星期五 16:07\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Configuration&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitMQConfig&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String EXCHANGE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.exchange&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String QUEUE = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.queue&quot;&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;(name = EXCHANGE)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Exchange &lt;span class=&quot;hljs-title&quot;&gt;exchange&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; ExchangeBuilder.topicExchange(EXCHANGE).durable(&lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;).autoDelete().build();\n    }\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;(name = QUEUE)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Queue &lt;span class=&quot;hljs-title&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; QueueBuilder.durable(QUEUE).build();\n    }\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Bean&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Binding &lt;span class=&quot;hljs-title&quot;&gt;binding&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(@Qualifier(EXCHANGE)&lt;/span&gt; Exchange exchange, @&lt;span class=&quot;hljs-title&quot;&gt;Qualifier&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(QUEUE)&lt;/span&gt; Queue queue)&lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; BindingBuilder.bind(queue).to(exchange).with(&lt;span class=&quot;hljs-string&quot;&gt;&quot;vip.*&quot;&lt;/span&gt;).noargs();\n    }\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在测试类中进行测试&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@SpringBootTest&lt;/span&gt;\n&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ProducerApplicationTests&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Autowired&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; RabbitTemplate rabbitTemplate;\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Test&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;contextLoads&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{\n        rabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE,&lt;span class=&quot;hljs-string&quot;&gt;&quot;vip.user&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;Hello,SpringBoot and RabbitMQ!&quot;&lt;/span&gt;);\n    }\n\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;h2&gt;&lt;a id=&quot;3__1177&quot;&gt;&lt;/a&gt;3. 编写消费者代码&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;yml文件配置和生产者一样&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;blockquote&gt;\n&lt;p&gt;编写消息队列监听类&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;div class=&quot;hljs&quot;&gt;&lt;code class=&quot;lang-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.amqp.core.Message;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.amqp.rabbit.annotation.RabbitListener;\n&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; org.springframework.stereotype.Component;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/**\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@author&lt;/span&gt; 叶子\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Description&lt;/span&gt; RabbitMQ - 消息队列监听类\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@DevelopmentTools&lt;/span&gt; IntelliJ IDEA\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@PackageName&lt;/span&gt; icu.yezi.consumer.listener\n * &lt;span class=&quot;hljs-doctag&quot;&gt;@Data&lt;/span&gt; 2020/11/20 星期五 16:20\n */&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Component&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RabbitMQListener&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@RabbitListener&lt;/span&gt;(queues = &lt;span class=&quot;hljs-string&quot;&gt;&quot;boot.queue&quot;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;listenerQueue&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Message message)&lt;/span&gt;&lt;/span&gt;{\n        System.out.println(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; String(message.getBody()));\n    }\n}\n&lt;/code&gt;&lt;/div&gt;&lt;/pre&gt;\n&lt;p&gt;注意：消费者可以不添加配置类&lt;/p&gt;\n&lt;h2&gt;&lt;a id=&quot;4__1207&quot;&gt;&lt;/a&gt;4. 总结&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;生产者&lt;/li&gt;\n&lt;/ul&gt;\n&lt;ol&gt;\n&lt;li&gt;配置yml文件&lt;/li&gt;\n&lt;li&gt;编写配置类&lt;/li&gt;\n&lt;li&gt;编写测试类&lt;/li&gt;\n&lt;/ol&gt;\n&lt;ul&gt;\n&lt;li&gt;消费者&lt;/li&gt;\n&lt;/ul&gt;\n&lt;ol&gt;\n&lt;li&gt;配置yml文件&lt;/li&gt;\n&lt;li&gt;编写消息队列监听类&lt;/li&gt;\n&lt;/ol&gt;\n&lt;blockquote&gt;\n&lt;p&gt;入门学习笔记，如有错误，请于评论区指出，非常感谢！&lt;/p&gt;\n&lt;/blockquote&gt;\n',0,0,'2021-04-01 19:42:21','2021-04-01 19:42:21',0);

/*Table structure for table `edu_blog_collect` */

DROP TABLE IF EXISTS `edu_blog_collect`;

CREATE TABLE `edu_blog_collect` (
  `id` varchar(255) NOT NULL COMMENT '主键',
  `blog_id` varchar(255) DEFAULT NULL COMMENT '博客主键',
  `member_id` varchar(255) DEFAULT NULL COMMENT '用户主键',
  `gmt_create` datetime DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `edu_blog_collect_id_uindex` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='博客收藏表';

/*Data for the table `edu_blog_collect` */

/*Table structure for table `edu_chapter` */

DROP TABLE IF EXISTS `edu_chapter`;

CREATE TABLE `edu_chapter` (
  `id` char(19) NOT NULL COMMENT '章节ID',
  `course_id` char(19) NOT NULL COMMENT '课程ID',
  `title` varchar(50) NOT NULL COMMENT '章节名称',
  `sort` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '显示排序',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_course_id` (`course_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT='课程章节';

/*Data for the table `edu_chapter` */

insert  into `edu_chapter`(`id`,`course_id`,`title`,`sort`,`gmt_create`,`gmt_modified`) values ('1314916025032048641','1314915972989124609','最终发布信息展示二次测试章节',1,'2020-10-10 21:09:44','2020-10-10 21:09:44'),('1314916718514024450','1314916674729684993','最终发布信息展示回退修改测试章节一',1,'2020-10-10 21:12:30','2020-10-10 21:12:30'),('1314917717790179329','1314917684898447361','课程发布信息展示回退测试二',1,'2020-10-10 21:16:28','2020-10-10 21:16:28'),('1314918932494172161','1314918891247386626','课程最终发布信息回显第三次测试',1,'2020-10-10 21:21:18','2020-10-10 21:21:18'),('1314919337336782849','1314919286954803202','课程最终发布信息回显第三次测试11',0,'2020-10-10 21:22:54','2020-10-10 21:22:54'),('1314919881744859138','1314919861578645506','回显继续测试！！',0,'2020-10-10 21:25:04','2020-10-10 21:25:04'),('1314921796159442945','1314921747421630466','课程最终发布章节一',1,'2020-10-10 21:32:40','2020-10-10 21:32:40'),('1315611473397018625','1315611425015721985','2020.10.12 第二次 第一章',1,'2020-10-12 19:13:12','2020-10-12 19:13:12'),('1315612711140323330','1315612663799214082','2020.10.12 第三次 第一章',1,'2020-10-12 19:18:07','2020-10-12 19:18:07'),('1315615348275408898','1315615202082942978','2020.10.12 第四次 第一章',1,'2020-10-12 19:28:36','2020-10-12 19:28:36'),('1315616114486669314','1315615202082942978','2020.10.12 第四次（回显测试成功，开始测试修改功能）第二章节',0,'2020-10-12 19:31:39','2020-10-12 19:31:39'),('1315620261134987265','1315620237164539906','章节修改测试213123',1,'2020-10-12 19:48:07','2020-10-12 19:48:22'),('1315620284404985858','1315620237164539906','章节修改测试1',0,'2020-10-12 19:48:13','2020-10-12 19:48:13'),('1315913433543086082','1315913408305958914','视频上传与删除测试',1,'2020-10-13 15:13:05','2020-10-13 15:13:05'),('1315914110273064962','1315914088181665794','视频上传与删除测试（前端测试）',0,'2020-10-13 15:15:47','2020-10-13 15:15:47'),('1315923990673362945','1315923967260758018','视频上传前端测试',0,'2020-10-13 15:55:02','2020-10-13 15:55:02'),('1315930188822921217','1315930166228205570','填写课程基本信息',0,'2020-10-13 16:19:40','2020-10-13 16:19:40'),('1315930740197736450','1315930721411448834','有问题的前端气到我了',0,'2020-10-13 16:21:51','2020-10-13 16:21:51'),('1315931052740493314','1315931026156994562','有问题的前端',0,'2020-10-13 16:23:06','2020-10-13 16:23:06'),('1315995084503691266','1314915972989124609','回显测试',0,'2020-10-13 20:37:32','2020-10-13 20:37:32'),('1316348311828967426','1316348284788289538','分布式跨服务调用测试',0,'2020-10-14 20:01:08','2020-10-14 20:01:08'),('1317657441301651458','1314831776845168641','999999999视频播放测试',1,'2020-10-18 10:43:09','2020-10-18 12:40:15'),('1326805576481378306','1326805526619492354','花花',1,'2020-11-12 16:34:34','2020-11-12 16:34:34'),('1373154140543197185','1192252213659774977','Java运行环境',1,'2021-03-20 14:07:13','2021-03-20 14:08:54'),('1380083480115712001','1314832173462716417','test',1,'2021-04-08 17:01:57','2021-04-08 17:01:57');

/*Table structure for table `edu_comment` */

DROP TABLE IF EXISTS `edu_comment`;

CREATE TABLE `edu_comment` (
  `id` char(19) NOT NULL COMMENT '讲师ID',
  `course_id` varchar(19) NOT NULL DEFAULT '' COMMENT '课程id',
  `teacher_id` char(19) NOT NULL DEFAULT '' COMMENT '讲师id',
  `member_id` varchar(19) NOT NULL DEFAULT '' COMMENT '会员id',
  `nickname` varchar(50) DEFAULT NULL COMMENT '会员昵称',
  `avatar` varchar(255) DEFAULT NULL COMMENT '会员头像',
  `content` varchar(500) DEFAULT NULL COMMENT '评论内容',
  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_course_id` (`course_id`),
  KEY `idx_teacher_id` (`teacher_id`),
  KEY `idx_member_id` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论';

/*Data for the table `edu_comment` */

insert  into `edu_comment`(`id`,`course_id`,`teacher_id`,`member_id`,`nickname`,`avatar`,`content`,`is_deleted`,`gmt_create`,`gmt_modified`) values ('1194499162790211585','1192252213659774977','1189389726308478977','1','小三123','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','课程很好',0,'2019-11-13 14:16:08','2019-11-13 14:16:08'),('1194898406466420738','1192252213659774977','1189389726308478977','1','小三123','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','11',0,'2019-11-14 16:42:35','2019-11-14 16:42:35'),('1194898484388200450','1192252213659774977','1189389726308478977','1','小三123','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','111',0,'2019-11-14 16:42:53','2019-11-14 16:42:53'),('1195252819177570306','1192252213659774977','1189389726308478977','1','小三1231','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','55',0,'2019-11-15 16:10:53','2019-11-15 16:10:53'),('1195252899448160258','1192252213659774977','1189389726308478977','1','小三1231','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','55',0,'2019-11-15 16:11:13','2019-11-15 16:11:13'),('1195252920587452417','1192252213659774977','1189389726308478977','1','小三1231','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','223344',0,'2019-11-15 16:11:18','2019-11-15 16:11:18'),('1195262128095559681','14','1189389726308478977','1','小三1231','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','11',0,'2019-11-15 16:47:53','2019-11-15 16:47:53'),('1196264505170767874','1192252213659774977','1189389726308478977','1','小三1231','http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132','666666',0,'2019-11-18 11:10:58','2019-11-18 11:10:58');

/*Table structure for table `edu_course` */

DROP TABLE IF EXISTS `edu_course`;

CREATE TABLE `edu_course` (
  `id` char(19) NOT NULL COMMENT '课程ID',
  `teacher_id` char(19) NOT NULL COMMENT '课程讲师ID',
  `subject_id` char(19) NOT NULL COMMENT '课程专业ID',
  `subject_parent_id` char(19) NOT NULL COMMENT '课程专业父级ID',
  `title` varchar(50) NOT NULL COMMENT '课程标题',
  `price` decimal(10,2) unsigned NOT NULL DEFAULT '0.00' COMMENT '课程销售价格，设置为0则可免费观看',
  `lesson_num` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '总课时',
  `cover` varchar(255) CHARACTER SET utf8 NOT NULL COMMENT '课程封面图片路径',
  `buy_count` bigint(10) unsigned NOT NULL DEFAULT '0' COMMENT '销售数量',
  `version` bigint(20) unsigned NOT NULL DEFAULT '1' COMMENT '乐观锁',
  `status` varchar(10) NOT NULL DEFAULT 'Draft' COMMENT '课程状态 Draft未发布  Normal已发布',
  `is_deleted` tinyint(3) DEFAULT NULL COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_title` (`title`),
  KEY `idx_subject_id` (`subject_id`),
  KEY `idx_teacher_id` (`teacher_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT='课程';

/*Data for the table `edu_course` */

insert  into `edu_course`(`id`,`teacher_id`,`subject_id`,`subject_parent_id`,`title`,`price`,`lesson_num`,`cover`,`buy_count`,`version`,`status`,`is_deleted`,`gmt_create`,`gmt_modified`) values ('1192252213659774977','1','1178214681626079234','1178214681613496321','JavaSE基础课程','1.21',20,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/7ca2c3887bee44c2b19f4e5d39b124cb.jfif',4,1,'Normal',0,'2019-11-07 09:27:33','2021-04-08 16:32:29'),('1314831776845168641','1189389726308478977','1178214681139539969','1178214681118568449','9999999999','1.11',5,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/e200f50725a1474490679868b5a435a3.jfif',0,1,'Normal',NULL,'2020-10-10 15:34:58','2021-03-29 16:44:32'),('1314832173462716417','1189390295668469762','1178214681139539969','1178214681118568449','二次测试','2.12',5,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-10 15:36:33','2021-04-08 17:01:46'),('1314838252561137665','1189390295668469762','1178214681252786178','1178214681231814658','修改测试成功了','0.00',5,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-10 16:00:42','2020-10-18 11:13:43'),('1314846072559898626','1189390295668469762','1178214681504444418','1178214681483472898','放大器','0.00',5,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-10 16:31:47','2020-10-18 11:13:54'),('1314915972989124609','1189389726308478977','1178214681139539969','1178214681118568449','最终发布信息展示二次测试','0.00',6,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-10 21:09:32','2020-10-18 11:14:05'),('1314916674729684993','1189389726308478977','1178214681139539969','1178214681118568449','最终发布信息展示回退修改测试','0.00',6,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-10 21:12:19','2020-10-18 11:14:15'),('1314917684898447361','1189389726308478977','1178214681210843137','1178214681181483010','课程发布信息展示回退测试二','0.00',5,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-10 21:16:20','2020-10-18 11:14:24'),('1314918891247386626','111111','1178214681139539969','1178214681118568449','课程最终发布信息回显第三次测试','0.00',5,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/bf209964d6ca40d096688660586864b6.jpg',0,1,'Normal',NULL,'2020-10-10 21:21:08','2021-03-22 17:37:23'),('1314919286954803202','1189389726308478977','1178214681428946945','1178214681399586817','课程最终发布信息回显第三次测试11','0.00',1,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/437ecbf9f05f4f20a6dcdda3601e6e60.jpg',0,1,'Normal',NULL,'2020-10-10 21:22:42','2021-03-22 17:37:47'),('1314919861578645506','1','1178214681139539969','1178214681118568449','回显继续测试！！','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-10 21:24:59','2020-10-17 21:24:47'),('1314921747421630466','1189389726308478977','1178214681584136193','1178214681554776066','课程最终发布','0.00',5,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-10 21:32:29','2020-10-15 13:55:12'),('1315611425015721985','1189389726308478977','1178214681504444418','1178214681483472898','2020.10.12 第二次','0.00',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-12 19:13:01','2020-10-18 11:16:02'),('1315612663799214082','111111','1178214681504444418','1178214681483472898','2020.10.12 第三次','0.00',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Draft',NULL,'2020-10-12 19:17:56','2020-10-12 19:17:56'),('1315615202082942978','1189390295668469762','1178214681428946945','1178214681399586817','2020.10.12 第四次（回显测试成功，开始测试修改功能）','0.00',1,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-12 19:28:01','2020-10-15 13:54:22'),('1315616768420605954','1','1178214681139539969','1178214681118568449','2020.10.12 删除章节测试','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-12 19:34:15','2020-10-15 13:50:12'),('1315620237164539906','1189426437876985857','1178214681139539969','1178214681118568449','章节修改测试','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-12 19:48:02','2020-10-15 13:49:50'),('1315913408305958914','1','1178214681139539969','1178214681118568449','视频上传与删除测试','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-13 15:12:59','2020-10-15 13:49:31'),('1315914088181665794','1','1178214681139539969','1178214681118568449','视频上传与删除测试（前端测试）','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-13 15:15:41','2020-10-15 13:49:05'),('1315923967260758018','1','1178214681139539969','1178214681118568449','视频上传前端测试','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-13 15:54:57','2020-10-15 13:48:44'),('1315930166228205570','111111','1178214681139539969','1178214681118568449','填写课程基本信息','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-13 16:19:35','2020-10-15 13:47:53'),('1315930721411448834','1189390295668469762','1178214681139539969','1178214681118568449','有问题的前端气到我了','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-13 16:21:47','2020-10-18 10:33:07'),('1315931026156994562','1','1178214681139539969','1178214681118568449','有问题的前端','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-13 16:23:00','2020-10-18 10:32:14'),('1316348284788289538','1192249914833055746','1178214681139539969','1178214681118568449','小节联动视频删除测试','0.00',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/221dcb452211446c9376a1fa03c75876.jpg',0,1,'Normal',NULL,'2020-10-14 20:01:02','2020-10-18 10:31:26'),('1326788468519358466','1189390295668469762','1178214681139539969','1178214681118568449','2020/11/12','0.00',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/11/12/79b99b255d554c299116c165bd371040.jpg',0,1,'Normal',NULL,'2020-11-12 15:26:36','2020-11-12 15:26:53'),('1326805526619492354','1311109174086586369','1178585108454121473','1178214681181483010','花花','0.00',0,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/11/12/dc4859a72ae943f8a5789ca12a18ee37.jpg',0,1,'Normal',NULL,'2020-11-12 16:34:23','2020-11-12 16:35:05');

/*Table structure for table `edu_course_collect` */

DROP TABLE IF EXISTS `edu_course_collect`;

CREATE TABLE `edu_course_collect` (
  `id` char(19) NOT NULL COMMENT '收藏ID',
  `course_id` char(19) NOT NULL COMMENT '课程讲师ID',
  `member_id` char(19) NOT NULL DEFAULT '' COMMENT '课程专业ID',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT='课程收藏';

/*Data for the table `edu_course_collect` */

insert  into `edu_course_collect`(`id`,`course_id`,`member_id`,`gmt_create`) values ('1378535024427491330','1314831776845168641','1340183806198362113','2021-04-04 10:28:56'),('1378538311381839874','1314918891247386626','1340183806198362113','2021-04-04 10:42:00'),('1378538311784493057','1314919286954803202','1340183806198362113','2021-04-04 10:42:00'),('1378557940808462338','1314921747421630466','1340183806198362113','2021-04-04 12:00:00'),('1378584125789573121','1315615202082942978','1340183806198362113','2021-04-04 13:44:03'),('1378648539591020545','1192252213659774977','1375442306159521793','2021-04-04 18:00:00'),('1378672444997287937','1314831776845168641','1375442306159521793','2021-04-04 19:35:00'),('1380095491532861441','1192252213659774977','1369634113126825985','2021-04-08 17:49:40'),('1381546585253363714','1192252213659774977','1340183806198362113','2021-04-12 17:55:48');

/*Table structure for table `edu_course_description` */

DROP TABLE IF EXISTS `edu_course_description`;

CREATE TABLE `edu_course_description` (
  `id` char(19) NOT NULL COMMENT '课程ID',
  `description` text COMMENT '课程简介',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程简介';

/*Data for the table `edu_course_description` */

insert  into `edu_course_description`(`id`,`description`,`gmt_create`,`gmt_modified`) values ('1192252213659774977','<p>JavaSE基础入门课程</p>\n<p><img class=\"wscnph\" src=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQEBUQDw8SEREPEhcWFhAWEBAVFhAYFREWGBYVExYYHCkiGBolGxMVIjUhJSkrLi8uFx8zODMtNyguLisBCgoKDg0OGhAQGzAlICU1MC0uLy01LS0vLzctLS0tLy8vMi01LS0tMC01LS0tLS0tLS0tLS0tLS0tLS0tLSstLf/AABEIAK4BIQMBEQACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAAAQMCBQYHBP/EAEgQAAIBAwEEBgYFBwoHAQAAAAECAAMEERIFBiExE0FRYXGBByIykaGxI0JigsEUQ1JykrLRFTNEU1RzdJOi8BY1Y5Szw+E0/8QAGgEBAAIDAQAAAAAAAAAAAAAAAAQFAQIDBv/EADYRAQACAQIDAwoGAgIDAAAAAAABAgMEEQUhMRJBURMUMmFxgZGx0fAVIkJSocEj4TQ1M1OS/9oADAMBAAIRAxEAPwD2gCBkFgTogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNEBogNECCsDEiAgZIIFgEDLEBiAxAYgMQGIDEBiAxAYgMQGIDEBiAxAYgMQGIDEBiAxAYgMQGIDEBiAxAYgMQGIDEBiBBECthAwgZpAtECYCAgICAgICBVc1hTRnb2UUsfADJ+AmJnaN21azaYrHesBmWqYCAgICAgICAgICAgICAgICAgICAgIEGBU8DCBmkC0QJgICAgICAgIGu3hqBbSuTy6F/ihAHvInPLO1Jn1JGlrNs9Ijxj5s9h1i9rRc83o0yfEoMzOOd6RLXUViua9Y7pn5vum7iQEBAQEBAQEBAQEBAQEBAQEBAQEBAgwKngYQM0gWiBMBAQEBAQEBA8/38230zCyoHUdYDkfWfPq0x4HBPfjsMgarL2v8AHVfcL0vYjzjJ7vZ3z9HcbPtxSpJSHKmir+yoH4SbWNoiFJkv27zbxnd9E2aEBAQEBAQEBAQEBAQEBAQEBAQEBAQIMCp4GEDNIFogTAQEBAQECCYHC727441ULRsnk9cHgvaKZ7ftdXV2iDn1O35afFd6DhkztkzRy7o+v0Nxd2mBF3XXB/NIRxGfzjD5Dz7I02Db89vccT10WjyOP3z/AFDu5OUipbhCxQMCw5gcdP62OXnMbwz2Z23WzLBAQEBAQEBAQEBAQEBAQEBAQEBAQIMCp4GEDNIFogTAQEBAQMalQKCzEAAZJJwABzJMTOzMRMztDzbejep7pvye11Ckx05AOuv3AcwvdzPwlbm1E3/LTp83otFw+uGPKZuv8R/v5NvuruatPFa6AaoOK0uBWn2Fv0m+A752waaK/mv1RNdxOcm9MXKPHvn6Q3O3d5re09Vm11OqkuC33upR4/GdsmetOvVD02hy5+dY2jxl8ljQvLz6S5Y21A8RbUyVdx/1antAdwwfCa1jJk525R4OmS2DB+XFHat+6enujp8XQ21ulNQlNQijkoAAE7xERyhBta1p3tO8rZlqQEBAQEBAQEBAQEBAQEBAQEBAQECDAqeBhAzSBaIEwEBAQEDz/wBIu2W1C0Q4UANU+1niqeHX5iQNXl/RHvX3CNLG3lreyP7lsdw9gLSpi5qDNWqMrn82h5Y7yOOew47Z002GKx2p6yj8U1k5Lzir6MfzP+jffeVrcChQOKrrln/q1PAY+0ePh7pnUZ+x+WvVjhuhjNPlL+jHd4/6a7cDYQqZvK3resejB45YH1qhzzOeA7wT2TnpcW/57e5J4rq5r/gpy8f6h6AJOUJAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgwKngYQM0gWiBMBAQEBA8k37ost9VJ+uFYd46MD5qfdKnVRtkl6vhdonTV27t4/nd6ta40Lp9nSMeGOEtY6PK233nd5Zv5RZb6oW5VFRl8NAX5q0rNTG2SXqeF2idNER3b7/AB3db6O79XtRRHt0GbI7Q7lg3hxI8pK0t4mnZ8FTxbDauft91v65OrkpVkBAQEBAQOQ23c7WFw4tqeaII0HTS4+oM8znnmRcls3ansxyWmnpopxxOW35u/r4+xqrLeS/F3Tt67KpNVFdNCZAYjrHcZzrnyduK2Ssuh03kLZce/SZjm9DEnKFMBAQEBAQEBAQEBAQECDAqeBhAzSBaIEwEBAQEDmd99gG6pCpSGa1EHA/rF618esf/ZG1OHt13jrCy4brPIX7NvRn+PWy3F2oK1sKbH6S39RgeeB7B9wx4qZnTZO1TbvhjiWn8nmm0dLc4/tO+uw/yqjqQfTUclPtj6yeeOHeB2xqMXbry6wxw/V+QybW9Gev1ebbG2m9rWWsn1eDL+mp9pT/AL5gSvx3mlu1D0mo09c+OaW93q9b2i3rK6K6nKuoYHtBGR85bxO8bvGWrNZms9yyZYICAgICAgeZ7T/50P8AEUf3acrrf8j3w9Fi/wCv90/OXpcsXnXCXm/Nc1GpULZSUZl5u5OlsZ0qBjlIVtVbeYrC7pwvH2Itkv19kfNUd8r+n61a0UL2mlXp/wCpiRMec5I61+baOG6a/KmTn7Yl027m8lK9BCgpUQZamTnh2qesSRizRkj1q7V6O+nnnzie9hvVtypZKjrRWojsVJLFdJxkcgeYDe6YzZZxxExDOi0tdRaazbaY5tjsbaAuaCVlGNa8RnOlgcMue4gzpjv26xZwz4Zw5JpPc+2buLlrbet6t6bWlRVkDkGrrPJB6zYx2ggcesSNGebZOxELK+gjHp/LWtz8NvHo+7erbxsqauKYqF304L6QPVJzyOeU3zZfJxvs46LSec3mu+23PxcyN8doPxp2ile0Ua7/ABBkfzjJPSvzWM8N0teVsn8xC+x39ZX0Xdvo7WXUCneUbjjz8jM11U77Xhpk4TE13w23+/GG/vWuzl7Zg6uRpz0WnQ1P2geBOGYHjzC465It2/0q7HGGOWSNvHr4/Tk3NLOkZ54GfHrnVGllAgwKngYQM0gWiBMBAQEBAiBodo7HanX/ACy0AFXlUo5AW5XrGeSv1g8sgZnC+OYt26de/wBabi1MWx+Ry9O6f2z9PFubauKihlzg9RBBU9YYHkR2TtE7xuiWrNZ2l5dt3ZDVNp1Le3HF3Dd1PWis7N2AFifMCVmXH2ss1q9PpdTFNHXJk7uXt2mYh6jZ0BTppTX2aaqo8FAA+Us6xtGzzF7ze02nv5rplqprXVNPbqKmeWpgM+GZmImejWbRHWVqsCMg5B6+2YbRO6YCAgIHme0/+dD/ABFH92nK63/I98PRYv8Ar59k/OXpcsXnWtuto2loMPUp0s8dAA1HPM6VGT44nO16U6zs70w5s/oxM/fi1dbfexxjU7g9lJuP7WJznU40qvC9TPdEe9y26dZP5UBogrTqGrpU8MKUZgCPIe6RsMx5bl05rPXVt5n+frG3x6O+3h2d+U21Sl9Zlyvcy8V+I+Mm5adukwotLm8jlrf4+zvcr6NdoH6S2bhj6RQerkrj93h3mRtJfrSVpxfD6OWPZP8ATqd5No/k1tUqg+sFwv6zcF+Jz5STlv2KTKs0uHy2atO7v9jm/Rrs3CPctzc6FP2VOWPm2B92R9JTlNpWPF829oxR3c5+/vq7G5SnwaoFxT4hmC4ThzBPLxkudu9UVm3Sve09zvfYocdOGP2Edx+0Bj4zlOoxx3pdOHai0ej8eTlN8dvWt3TUUlfpUbIcoB6uDlc5z2HykXPlpeOXVacP0mfBeZtttMdN3WbkVC1hRJ6gw8lqsB8AJK08744VfEIiNTfb75N7OyEQIMCp4GEDNIFogTAQPk2ptCnbUmrVTpSmMk4JPEgAADrJIHnNqUm9orXrLTJkrjrNrdIee3/pOqM2m1oIgJAFSsxPM8yqkBfeZaU4bERvefgqL8VmZ2pHxddsuwr1FD3F+1bVx0UClKkM9jINbeOoeEgXvWOVa7e3nP0/hYY8drRve+/s5R/HNu6NFUGFHmSST4k8T5zhMpMREM4ZVVn0g4KgntOB4mOfcbx3tVaVLK11M1zRFSq2qpVerTDOe/J4AdSjgIx6e3PsxMy2z6yLbRa0REcojfp996Km9tgCFF0jseS0w9UnwFMEmd402Xr2fjy+aLOrwx+rf2c/k2VvW6Zc6KiKw4agUYg9eM6l88GcZjadnas9qOn9NTf7mWFYHXQ9dvzod9ee0sSdR8czvTV5adJ+iPk0eG8c49/e4Xd++q7L2kbJqheg1UUyvV9Jjo6ij6p9Zc47+6WObHXUYPKRG09fh1VeDJbTajyUzvG+3x6PWpTL4gICB5ltHjtoY/tFH4LTldb/AJHvh6LF/wBf7p+cu73hvjb2tWsvtIvq9zMQqk+ZEm5LdmkzCk0uKMuatJ6S4jc/d5b3XcXLM4D6caiDUbSCS7c8YYcpDwYoyb2sutfrLabs48Ubcvh7HZ0t2rJeVrSOP0lDfvZkuMOOO6FPbW6iet5+LjNj01XbRVVCqtWqAoAAAFN+AA5SJjjbPy9fyXOotNuH7z12j5w9Jlg868022psNprXUYpu3SeTZWqvxY+Yldk/xZu13fe70WmnzrRzjnrHL4dH2ekG9NarRtKXrE4bA62f1aY9xJ+8JvqrdqYpDjwrHFKXzX9nw5y7XZtmtCilJeVNQue3HM+ZyfOTKV7NYhT5ck5Lzee9wm/V3Ur3aWathAUGOovUIwzdoAI+Mham02vFF3w3HTHhnPMc+fwjwdHs/c2zpKNVPpW62ck5+6DgDykiumxx1jdX5OJai88p2j1fe7Wb9bKt6Npqo0KVNulUalpqDjDcMjjOeopWtOUJPDc+XJn2vaZ5T1lttxP8A8FLxqf8AmedNN/44ReJf8m3u+UN/O6CQIMCp4GEDNIFogTAQMalNWBVgGVhgqQCCDzBB5xE7c4YmImNpcxfbg7PqkkUmpE9dNyo8lOVHkJLprs1e/f2od+H4L89tvY01f0bWqMAt5Vps5woboyWOM4XAGeAJnaOI3nrWJR54ZjiY2tMJb0b1Pq7SqAf3bH/2CZ/EK/8Arj79xPDbd2Sfv3sR6M2Pt7Qdh/dH8ahmfxGI6Uj79zX8LmeuSfv3raXottvr3FZvAU1+YM1niWTuiG8cKx99pbO09Huzk4mk9Qjreq/xC4BnK2vz279navDsFe7f2ugsNm0KAxQo06Q+wirnxIHGRb3tf0p3S6YqU9GNn1zVuruK600Z3YKiAszHkoAySZmImZ2hi1orG8vHtkq+0tr9MqkJ0wqsf0KdMjSG7yFVfEy7yTGDTdmfDb4vPYonU6rtx033+D2WUb0RA0u9W1KlrRFWkgc9IAVIYjSVYk8OXIcZyzXmld4S9Hgpmydi87cnLv6RKhGlbZA56zVZhn9UKCffI3nk90LOODVjnN+Xs/2z3R2JXq3P5bcqVAYuNQwajtnjp6lGfliMGK1rduzXXarHTF5DF7PZH1dltmxFxQqUScdIuAewjip94El5K9qswqMGXyWSt/B5zsvbFzst3pVaOQxyUYlckcNSPggggDt5DlIFMlsEzWYehzabFroi9LffhMNr/wAY3l19HZ2oVjw16jU09+SAq+JnTzi9+VIRZ4bgwfmzX5eHT6z8HwbtWtVNqKKupnV6mqphiGbo3ydRHHjNMNbRm5u+ryY7aOex05bR74emyxeccvv/ALMNa26RRl6DauAySp4OPkfuyNqadqm8dyy4Xn8nm7M9Lcvp9Pe5/cTZz1bo16obFugwWBGW06EHHnhVPuE4aak2v2p7k7ieatMPk6fq8PjPxl6RLB59wW/ex6wrC8oAnAXVpGSjJ7L47MY8MSFqcc9rtwu+Gamk0nBk9e3r37lVD0iOFAa2Rn/SFUqCf1dJ+cxGsnvhvbg1d94vy9n+3w7erbQuqPTVkNOgHAWkFYFic+tp5nh1nhx4TTJOW9d56OulrpcOTydJ3t3z98vg7LcdSLCkCCD9JwIwf555L0/LHCp4jMTqbber5Q307IRAgwKngYQM0gWiBMBAQIMDya+obXtb43j0mrsCwDKrVKZQ/VCrxQY8OPb13FLafJi8nE7ff8qHJGqxZvKTG/8AMbf026ek4Lwr2VRG7qn4MonH8O39G0JH4pEelSYS/pTodVrUPjUQfxj8Mv8Auhn8Vp+2XyVvSo31LNR3tXJ+AQTpHDPG38OU8Wnup/L5Tv3tStwo26jPLRQqufiSD7pt5lp6+lb+Yhp+Iam/o1/iW33YvttmrmvQNSk+NXSCnRKd6YAPlg+U4aiml7P5J5+reUjS31k2/PHL18nb3l6lFdTk9yhWZm7lVQSx8BK+tZtO0LK14rG8uO2xZbQ2oej0GzswQT0mOlq45FkB4fqkjt48MTsV8On/ADelb+IV+bHn1M9n0a+vrLpdgbBoWVPo6K8+LOcFqh7WP4chIubNbLbeybgwUw17NW1nJ2ICBGkdkCYCBi9NW4MAR2EAxszE7dEqoAwAAOwCGEwEBAQEBAwFFQchVz24GffMbM7yzmWCAgIEGBU8DCBmkC0QJgICAga7bW2rezTpLioFB4KuCWc9iqOc6YsV8k7VhyzZ6Yq9q8stmbUoXVMPSqK4YA6cqWXI5MOo90xfHbHO1o2MeWmSu9Z3fSban+gv7I/hNN3Tsx4MgiLxwq+QEzvJtEPiutuWlLhUuqKnsNVM+7M3rhyW9Gsuds+OvW0PvRgQCCCDxBHEHwnN1hliAgICAgICAgICAgICAgICAgICAgICBBgVPAwgZpAtECYCBRdXlKkM1aqUx2u6qPeTM1rNuURu1tetedp2VUdpUqn82xqA8mRXZT94DHxmZpNerEZK26c3wby7tUL9FFXUrU86KikZXOMgg8CDge6dcGovhnerjqNNTPG1nD3fowuFOaFzSfs1B6Z+GqWFeJUnlav9qu3Crxzpb+nyvuTtZeAfI+zckD44m8azT+H8NZ0GqjpP8vnbcLab+2invaup/EzaNdgjp8mk8O1NuvzfXa+jK7Y/SVaFMdxdz7tIHxmluI446RMt68Kyz6UxDvN1N3DYoU/KatUH6rYCKe1F4lffK7UZ/LTvtELXTabyFdu1M/JvpHSiBCsCMg5B6+2BMBAQEBAQEBAQEBAQEBAQEBAQECDAqeBhAzSBaIEwOZ34ttoVKSiwfTz6RVYJUccMaGPLrzxB5SVpbYa2/wAsfRD1lc9qf4p9vi862RXrbPuDWvLB6pxjVVVsoc+0jsCCf95EtMtaZ6dnHfb2KjFa+nvNstJn2u3tfSVYt7YrUz30ww8tJPylfbh2aOm0rKvE8M9d4bGjvzs1uV0B406q/NZynR54/S7RrsE/qfSm9ezzyvKPm4Hzmvm2X9st/OsP7oWDeaw/ttv/AJyfxmPN8v7Z+DPnWH90fFB3nsB/Tbf/ADU/jHm+X9s/A86w/uj4qn3u2eOd5S8iT8hM+a5v2y1nV4I/VD5K2/uzV/pBb9WlWPx04m8aLPP6fk5zxDTx+r5tdX9JdrnTRo16rHkNKqD8SfhOscPybb2mIcp4ni32rEyJfbWv/VSiNn0G9qq2TVx9gHBz5DxmJpp8POZ7U+HcRk1OflEdiPHvbu/2vQsaaUFOuqFWnRtwcvUIAVAewcssZwpivlmbd3WZ7km+WmGsUjnPSI728E4JKYCAgICAgICAgICAgICAgICAgQYFTwMIGaQLRAmAgRiBo9v7NLANSs7W4xnXTqqqs3LGhyCAefAjr5jHHvivtym0x7EbNjmfRrE+qXN16diOFzsOvSPWUo60H36TfhJUTln0MsT7/qiWjD0vimPd9Hxv/wAOZ9dHpnsIvR/GdI897uf/AMuUxoO+Nvifk+7Z/OkfeuvxEdvW+HyOxoPH5sTQ3bH51j4G7PyEz2tbPd8mJrw+O/5sDW3bXklR/wDuuPvIjbWz9wxvoI7vmJt7YqnFDZj1T300b95mPwicGpn0sm3vI1Gk6Vx7+5sLfeW9I02OxeiHUxRgvwVB8ZynT4o/8mXf797tGpzTyxYtvv3Lf5N25d/z1yloh5qhGoeGjj/rmPKaTH6NZtPr+/6Z8nrMvpWiser7/tvN3d0bezPSDVVrnnWfiePPSPq/PvnDNqr5Y26R4QlYNHTDO/WfGXQyMlEBAQEBAQEBAQEBAQEBAQEBAQIMCp4GEDNIFogTAQEBAQIZQeYB8RBs+d7CiedGmfGmh/CbRa0dJazSs9zD+Srb+z0f8qn/AAmfKX8ZY8nTwhYlhRXlRpjwpoPwmJvaessxSsdIXqoHIAeU1bbJgICAgICAgICAgICAgICAgICAgICAgQYFTwMIGaQLRAmAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQYFTwMIGSmBYDAnMBmAzAZgMwGYDMBmAzAZgMwGYDMBmAzAZgMwGYDMBmAzAZgMwGYDMBmAzAZgMwGYDMBmBBMCtjAxgRAy1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqA1QGqBBgIH//Z\" /></p>','2019-11-07 09:27:33','2021-04-08 16:32:21'),('1314831776845168641','<p>9999999999999999999999999</p>','2020-10-10 15:34:58','2021-03-29 16:44:29'),('1314832173462716417','<p>二次测试</p>','2020-10-10 15:36:33','2021-04-08 17:01:46'),('1314838252561137665','<p>修改测试成功了</p>','2020-10-10 16:00:42','2020-10-18 11:13:43'),('1314846072559898626','<p>放大器</p>','2020-10-10 16:31:47','2020-10-18 11:13:54'),('1314915972989124609','<p>最终发布信息展示二次测试</p>','2020-10-10 21:09:32','2020-10-18 11:14:05'),('1314916674729684993','<p>最终发布信息展示回退修改测试</p>','2020-10-10 21:12:19','2020-10-18 11:14:15'),('1314917684898447361','<p>课程发布信息展示回退测试二</p>','2020-10-10 21:16:20','2020-10-18 11:14:24'),('1314918891247386626','<p>课程最终发布信息回显第三次测试</p>','2020-10-10 21:21:08','2021-03-22 17:37:20'),('1314919286954803202','<p>课程最终发布信息回显第三次测试11</p>','2020-10-10 21:22:42','2021-03-22 17:37:43'),('1314919861578645506','<p>回显继续测试！！</p>','2020-10-10 21:24:59','2020-10-17 21:24:44'),('1314921747421630466','<p>课程最终发布</p>','2020-10-10 21:32:29','2020-10-15 13:54:57'),('1315611425015721985','<p>2020.10.12 第二次</p>','2020-10-12 19:13:01','2020-10-18 11:16:02'),('1315612663799214082','<p>2020.10.12 第三次</p>','2020-10-12 19:17:56','2020-10-12 19:17:56'),('1315615202082942978','<p>2020.10.12 第四次（回显测试成功，开始测试修改功能）</p>','2020-10-12 19:28:01','2020-10-15 13:54:19'),('1315616768420605954','<p>2020.10.12 删除章节测试</p>','2020-10-12 19:34:15','2020-10-15 13:50:09'),('1315620237164539906','<p>章节修改测试</p>','2020-10-12 19:48:02','2020-10-15 13:49:47'),('1315913408305958914','<p>视频上传与删除测试</p>','2020-10-13 15:12:59','2020-10-15 13:49:28'),('1315914088181665794','<p>视频上传与删除测试（前端测试）</p>','2020-10-13 15:15:41','2020-10-15 13:49:01'),('1315923967260758018','<p>视频上传前端测试</p>','2020-10-13 15:54:57','2020-10-15 13:48:17'),('1315930166228205570','<p>填写课程基本信息</p>','2020-10-13 16:19:35','2020-10-15 13:47:50'),('1315930721411448834','<p>有问题的前端气到我了</p>','2020-10-13 16:21:47','2020-10-18 10:32:41'),('1315931026156994562','<p>有问题的前端</p>','2020-10-13 16:23:00','2020-10-18 10:32:14'),('1316348284788289538','<p>分布式跨服务调用测试</p>','2020-10-14 20:01:02','2020-10-18 10:30:50'),('1326788468519358466','<p>2020/11/12</p>','2020-11-12 15:26:36','2020-11-12 15:26:36'),('1326805526619492354','','2020-11-12 16:34:23','2020-11-12 16:34:23');

/*Table structure for table `edu_subject` */

DROP TABLE IF EXISTS `edu_subject`;

CREATE TABLE `edu_subject` (
  `id` char(19) NOT NULL COMMENT '课程类别ID',
  `title` varchar(10) NOT NULL COMMENT '类别名称',
  `parent_id` char(19) NOT NULL DEFAULT '0' COMMENT '父ID',
  `sort` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '排序字段',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT='课程科目';

/*Data for the table `edu_subject` */

insert  into `edu_subject`(`id`,`title`,`parent_id`,`sort`,`gmt_create`,`gmt_modified`) values ('1178214681118568449','后端开发','0',1,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681139539969','Java','1178214681118568449',1,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681181483010','前端开发','0',3,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681210843137','JavaScript','1178214681181483010',4,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681231814658','云计算','0',5,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681252786178','Docker','1178214681231814658',5,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681294729217','Linux','1178214681231814658',6,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681324089345','系统/运维','0',7,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681353449473','Linux','1178214681324089345',7,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681382809602','Windows','1178214681324089345',8,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681399586817','数据库','0',9,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681428946945','MySQL','1178214681399586817',9,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681454112770','MongoDB','1178214681399586817',10,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681483472898','大数据','0',11,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681504444418','Hadoop','1178214681483472898',11,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681529610242','Spark','1178214681483472898',12,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681554776066','人工智能','0',13,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681584136193','Python','1178214681554776066',13,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681613496321','编程语言','0',14,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178214681626079234','Java','1178214681613496321',14,'2019-09-29 15:47:25','2019-09-29 15:47:25'),('1178585108407984130','Python','1178214681118568449',2,'2019-09-30 16:19:22','2019-09-30 16:19:22'),('1178585108454121473','HTML/CSS','1178214681181483010',3,'2019-09-30 16:19:22','2019-09-30 16:19:22');

/*Table structure for table `edu_teacher` */

DROP TABLE IF EXISTS `edu_teacher`;

CREATE TABLE `edu_teacher` (
  `id` char(19) NOT NULL COMMENT '讲师ID',
  `name` varchar(20) NOT NULL COMMENT '讲师姓名',
  `intro` varchar(500) NOT NULL DEFAULT '' COMMENT '讲师简介',
  `career` varchar(500) DEFAULT NULL COMMENT '讲师资历,一句话说明讲师',
  `level` int(10) unsigned NOT NULL COMMENT '头衔 1高级讲师 2首席讲师',
  `avatar` varchar(255) DEFAULT NULL COMMENT '讲师头像',
  `sort` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '排序',
  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='讲师';

/*Data for the table `edu_teacher` */

insert  into `edu_teacher`(`id`,`name`,`intro`,`career`,`level`,`avatar`,`sort`,`is_deleted`,`gmt_create`,`gmt_modified`) values ('1','张思海','近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','高级',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/31/571b578988b64c5bb5160ddb228f18c9.png',1,0,'2019-10-30 14:18:46','2021-03-31 20:39:56'),('111111','孙建业','	\n近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','郑大教授',1,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/11/10/978b20a694344de7b87a2f36cde00673.png',7,0,'2020-09-30 08:53:06','2021-03-20 13:43:05'),('1189389726308478977','王刚','	\n近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','二十年授课经验',2,'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/10/30/de47ee9b-7fec-43c5-8173-13c5f7f689b2.png',3,0,'2019-10-30 11:53:03','2021-03-20 13:41:38'),('1189390295668469762','李刚','高级讲师简介','高级讲师',2,'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/10/30/b8aa36a2-db50-4eca-a6e3-cc6e608355e0.png',5,0,'2019-10-30 11:55:19','2021-03-20 13:39:34'),('1189426437876985857','王声韵','近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','高级讲师',1,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/12/02/c5ba56b4d6a24512a9d7143b3ab1e719.png',6,0,'2019-10-30 14:18:56','2021-03-20 13:39:39'),('1189426464967995393','刻晴','	\n近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','高级讲师',1,'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/10/30/65423f14-49a9-4092-baf5-6d0ef9686a85.png',9,0,'2019-10-30 14:19:02','2021-03-20 13:43:38'),('1192249914833055746','李立成','	\n近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','高级讲师',1,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/11/10/d5a7c7665fc744dfaa25e9dca6e062b4.png',8,0,'2019-11-07 09:18:25','2021-03-20 13:43:27'),('1311109174086586369','甘雨','	\n近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','厦大教师',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/10/15/9325e3da68f44c55bc07ec1b879c825a.png',10,0,'2020-09-30 09:02:40','2021-03-20 13:44:03'),('1313093934322397185','赵孟','	\n近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站','北京大学教授',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2020/11/10/0cbc2df8ed174ffa8a9058f6c709d86d.png',4,0,'2020-10-05 20:29:24','2021-03-31 20:40:26'),('1369942275537227778','张三丰','1111','111',1,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/11/4f0866c1df1c41868fd5862ba517816b.png',121,1,'2021-03-11 17:24:25','2021-03-11 17:24:25'),('1377241174509531138','肖战','肖战','测试',2,'https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/31/ec10d573205c4655a117febda07ad2d0.png',23,0,'2021-03-31 20:47:38','2021-04-08 17:00:25');

/*Table structure for table `edu_video` */

DROP TABLE IF EXISTS `edu_video`;

CREATE TABLE `edu_video` (
  `id` char(19) NOT NULL COMMENT '视频ID',
  `course_id` char(19) NOT NULL COMMENT '课程ID',
  `chapter_id` char(19) NOT NULL COMMENT '章节ID',
  `title` varchar(50) NOT NULL COMMENT '节点名称',
  `video_source_id` varchar(100) DEFAULT NULL COMMENT '云端视频资源',
  `video_original_name` varchar(100) DEFAULT NULL COMMENT '原始文件名称',
  `sort` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '排序字段',
  `play_count` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '播放次数',
  `is_free` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否可以试听：0收费 1免费',
  `duration` float NOT NULL DEFAULT '0' COMMENT '视频时长（秒）',
  `status` varchar(20) NOT NULL DEFAULT 'Empty' COMMENT 'Empty未上传 Transcoding转码中  Normal正常',
  `size` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '视频源文件大小（字节）',
  `version` bigint(20) unsigned NOT NULL DEFAULT '1' COMMENT '乐观锁',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_course_id` (`course_id`),
  KEY `idx_chapter_id` (`chapter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT='课程视频';

/*Data for the table `edu_video` */

insert  into `edu_video`(`id`,`course_id`,`chapter_id`,`title`,`video_source_id`,`video_original_name`,`sort`,`play_count`,`is_free`,`duration`,`status`,`size`,`version`,`gmt_create`,`gmt_modified`) values ('1314916086218555393','1314915972989124609','1314916025032048641','最终发布信息展示二次测试章节下小节','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-10 21:09:59','2020-10-10 21:09:59'),('1314916781902540802','1314916674729684993','1314916718514024450','最终发布信息展示回退修改测试章节一下的小节一','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-10 21:12:45','2020-10-10 21:12:45'),('1314921857022988290','1314921747421630466','1314921796159442945','课程最终发布章节一下的小节一','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-10 21:32:55','2020-10-10 21:32:55'),('1315611522558455810','1315611425015721985','1315611473397018625','2020.10.12 第二次 第一小节','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-12 19:13:24','2020-10-12 19:13:24'),('1315612769998991361','1315612663799214082','1315612711140323330','2020.10.12 第三次 第一小节','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-12 19:18:21','2020-10-12 19:18:21'),('1315615387395682306','1315615202082942978','1315615348275408898','2020.10.12 第四次 第一小节','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-12 19:28:45','2020-10-12 19:28:45'),('1315913589680246786','1315913408305958914','1315913433543086082','视频上传与删除测试','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-13 15:13:42','2020-10-13 15:13:42'),('1317654471814111234','1316348284788289538','1316348311828967426','视频播放','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-10-18 10:31:21','2020-10-18 10:31:21'),('1317654897166868481','1315930721411448834','1315930740197736450','测试','708b444522804a6abcb9151d355e8dd4','6 - What If I Want to Move Faster.mp4',0,0,0,0,'Empty',0,1,'2020-10-18 10:33:02','2020-10-18 10:33:02'),('1326805689509482498','1326805526619492354','1326805576481378306','花花','3c8ab4229f6848e28ef5392ea3f671b5','6 - What If I Want to Move Faster.mp4',1,0,0,0,'Empty',0,1,'2020-11-12 16:35:01','2020-11-12 16:35:01'),('1373155726573117441','1192252213659774977','1373154140543197185','Java语言发展史','7bf0b398d8684292aa6d1e06e5e0b278','01-Java语言发展史.mp4',1,0,0,0,'Empty',0,1,'2021-03-20 14:13:31','2021-03-20 14:13:31'),('1373158130194522114','1192252213659774977','1373154140543197185','计算机进制转换','26279129255f4eef8272474da692a16a','02-计算机进制转换.mp4',2,0,0,0,'Empty',0,1,'2021-03-20 14:23:04','2021-03-20 14:23:04'),('1373170258859204610','1192252213659774977','1373154140543197185','计算机存储单元','69c4c004a1694a028c75c8e89ccaf9db','03-计算机存储单元.mp4',3,0,0,0,'Empty',0,1,'2021-03-20 15:11:16','2021-03-20 15:11:16'),('1373578254743453697','1314831776845168641','1317657441301651458','test2','3310a911d7454464be22d89a9261cd47','6 - What If I Want to Move Faster.mp4',1,0,1,0,'Empty',0,1,'2021-03-21 18:12:30','2021-03-21 18:12:30'),('1373937463997739009','1192252213659774977','1373154140543197185','播放测试','e3864dc25eb640b4a30939980aa96e7f','6 - What If I Want to Move Faster.mp4',4,0,1,0,'Empty',0,1,'2021-03-22 17:59:52','2021-03-22 17:59:52');

/*Table structure for table `history` */

DROP TABLE IF EXISTS `history`;

CREATE TABLE `history` (
  `id` varchar(255) NOT NULL DEFAULT '' COMMENT '主键',
  `course_id` varchar(255) DEFAULT NULL COMMENT '课程主键',
  `user_id` varchar(255) DEFAULT NULL COMMENT '用户主键',
  `gmt_create` datetime DEFAULT NULL COMMENT '浏览时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='浏览记录';

/*Data for the table `history` */

insert  into `history`(`id`,`course_id`,`user_id`,`gmt_create`) values ('0cfbb98a-9d2c-4274-9746-779ea1103dd9','1192252213659774977','1340183806198362113','2021-04-13 00:00:00'),('4e10a318-1e6b-4b80-84ce-018331ff72ec','1192252213659774977','1369634113126825985','2021-04-11 00:00:00'),('56e324bb-2c96-4753-af93-75070a248f09','1192252213659774977','1340183806198362113','2021-04-13 00:00:00'),('7661040f-1cef-470a-81a6-04a7ae69775c','1192252213659774977','1369634113126825985','2021-04-09 00:00:00'),('92364471-851a-4a0c-b244-9413fa28c882','1192252213659774977','1369634113126825985','2021-04-11 00:00:00'),('b5c3184b-a090-4c77-8088-0764d01aee11','1192252213659774977','1369634113126825985','2021-04-16 00:00:00'),('f33a2306-003f-4abf-8bc1-6271ceac2c24','1314831776845168641','1369634113126825985','2021-04-08 06:03:04');

/*Table structure for table `menu` */

DROP TABLE IF EXISTS `menu`;

CREATE TABLE `menu` (
  `menu_id` varchar(255) NOT NULL DEFAULT '' COMMENT '主键',
  `menu_parent_id` varchar(255) DEFAULT NULL COMMENT '父级菜单id',
  `icon` varchar(255) DEFAULT NULL COMMENT '图标class属性',
  `menu_index` varchar(255) DEFAULT NULL COMMENT '路由',
  `title` varchar(255) DEFAULT NULL COMMENT '标题',
  `menu_status` int(11) DEFAULT NULL COMMENT '菜单状态（1可用，0禁用）',
  PRIMARY KEY (`menu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='菜单';

/*Data for the table `menu` */

/*Table structure for table `role` */

DROP TABLE IF EXISTS `role`;

CREATE TABLE `role` (
  `role_id` varchar(255) NOT NULL DEFAULT '' COMMENT '主键',
  `role_name` varchar(255) DEFAULT NULL COMMENT '角色名',
  `role_status` int(11) DEFAULT NULL COMMENT '状态（1可用，0禁用）',
  `gmt_create` datetime DEFAULT NULL COMMENT '创建时间',
  `role_code` varchar(255) DEFAULT NULL COMMENT '角色代码',
  PRIMARY KEY (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='角色表';

/*Data for the table `role` */

insert  into `role`(`role_id`,`role_name`,`role_status`,`gmt_create`,`role_code`) values ('33c2da41f6ec46459cf0f4c41d32c4e3','超级管理员',1,'2021-01-05 21:00:00','admin');

/*Table structure for table `role_menu` */

DROP TABLE IF EXISTS `role_menu`;

CREATE TABLE `role_menu` (
  `role_menu_id` varchar(255) NOT NULL DEFAULT '' COMMENT '主键',
  `role_id` varchar(255) DEFAULT NULL COMMENT '角色ID',
  `menu_id` varchar(255) DEFAULT NULL COMMENT '菜单ID',
  `role_menu_status` int(11) DEFAULT NULL COMMENT '状态（1可用，0禁用）',
  PRIMARY KEY (`role_menu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='角色菜单表';

/*Data for the table `role_menu` */

/*Table structure for table `statistics_daily` */

DROP TABLE IF EXISTS `statistics_daily`;

CREATE TABLE `statistics_daily` (
  `id` char(19) NOT NULL COMMENT '主键',
  `date_calculated` varchar(20) NOT NULL COMMENT '统计日期',
  `register_num` int(11) NOT NULL DEFAULT '0' COMMENT '注册人数',
  `login_num` int(11) NOT NULL DEFAULT '0' COMMENT '登录人数',
  `video_view_num` int(11) NOT NULL DEFAULT '0' COMMENT '每日播放视频数',
  `course_num` int(11) NOT NULL DEFAULT '0' COMMENT '每日新增课程数',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `statistics_day` (`date_calculated`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='网站统计日数据';

/*Data for the table `statistics_daily` */

insert  into `statistics_daily`(`id`,`date_calculated`,`register_num`,`login_num`,`video_view_num`,`course_num`,`gmt_create`,`gmt_modified`) values ('1078490017163833345','2018-12-28',0,0,154,170,'2018-12-28 11:17:12','2019-09-09 12:12:12'),('1087142127818768386','2019-01-02',2,0,167,177,'2019-01-21 08:17:36','2019-09-09 12:12:12'),('1087198321809457153','2019-01-01',1,0,130,189,'2019-01-21 12:00:54','2019-09-09 12:12:12'),('1087198383973236738','2019-01-03',0,0,114,130,'2019-01-21 12:01:09','2019-09-09 12:12:12'),('1087451681764982785','2019-01-04',0,0,118,155,'2019-01-22 04:47:39','2019-09-09 12:12:12'),('1087455336471785473','2019-01-05',0,0,184,186,'2019-01-22 05:02:11','2019-09-09 12:12:12'),('1105339962460491777','2019-03-01',0,143,168,136,'2019-03-12 13:29:18','2019-03-12 13:29:18'),('1105339977027309569','2019-03-02',0,165,171,158,'2019-03-12 13:29:21','2019-03-12 13:29:21'),('1105339990738489346','2019-03-03',0,143,147,194,'2019-03-12 13:29:25','2019-03-12 13:29:25'),('1105340000544772098','2019-03-04',0,155,106,153,'2019-03-12 13:29:27','2019-03-12 13:29:27'),('1105340011244441602','2019-03-05',0,186,102,155,'2019-03-12 13:29:30','2019-03-12 13:29:30'),('1105340020929089538','2019-03-06',0,140,192,129,'2019-03-12 13:29:32','2019-03-12 13:29:32'),('1105340029800042497','2019-03-07',0,186,139,116,'2019-03-12 13:29:34','2019-03-12 13:29:34'),('1105340038696161282','2019-03-08',0,120,166,112,'2019-03-12 13:29:36','2019-03-12 13:29:36'),('1105340049441968129','2019-03-09',0,182,147,119,'2019-03-12 13:29:39','2019-03-12 13:29:39'),('1105340059738984449','2019-03-10',0,199,141,103,'2019-03-12 13:29:41','2019-03-12 13:29:41'),('1105340070438653953','2019-03-11',0,127,137,156,'2019-03-12 13:29:44','2019-03-12 13:29:44'),('1105340080307851266','2019-03-12',0,167,123,132,'2019-03-12 13:29:46','2019-03-12 13:29:46'),('1105340090047025153','2019-03-13',0,106,132,103,'2019-03-12 13:29:48','2019-03-12 13:29:48'),('1105340100075606017','2019-03-14',0,166,180,118,'2019-03-12 13:29:51','2019-03-12 13:29:51'),('1105340110511034370','2019-03-15',0,114,151,185,'2019-03-12 13:29:53','2019-03-12 13:29:53'),('1105340121412030466','2019-03-16',0,134,105,126,'2019-03-12 13:29:56','2019-03-12 13:29:56'),('1105340132833120258','2019-03-17',0,169,106,131,'2019-03-12 13:29:59','2019-03-12 13:29:59'),('1105340145659301890','2019-03-18',0,120,106,163,'2019-03-12 13:30:02','2019-03-12 13:30:02'),('1105340153578147842','2019-03-19',0,146,155,153,'2019-03-12 13:30:03','2019-03-12 13:30:03'),('1105340162436517890','2019-03-20',0,127,181,186,'2019-03-12 13:30:06','2019-03-12 13:30:06'),('1105340171517186050','2019-03-21',0,106,134,145,'2019-03-12 13:30:08','2019-03-12 13:30:08'),('1105340181034061825','2019-03-22',0,161,182,143,'2019-03-12 13:30:10','2019-03-12 13:30:10'),('1105340190072786946','2019-03-23',0,183,101,182,'2019-03-12 13:30:12','2019-03-12 13:30:12'),('1105340199426084865','2019-03-24',0,117,100,102,'2019-03-12 13:30:14','2019-03-12 13:30:14'),('1105340209261727745','2019-03-25',0,116,103,160,'2019-03-12 13:30:17','2019-03-12 13:30:17'),('1105340217935548418','2019-03-26',0,101,119,150,'2019-03-12 13:30:19','2019-03-12 13:30:19'),('1105340225967640577','2019-03-27',0,129,141,181,'2019-03-12 13:30:21','2019-03-12 13:30:21'),('1105340234075230209','2019-03-28',0,113,179,158,'2019-03-12 13:30:23','2019-03-12 13:30:23'),('1105340242837131265','2019-03-29',0,117,131,101,'2019-03-12 13:30:25','2019-03-12 13:30:25'),('1105340252395950082','2019-03-30',0,153,187,174,'2019-03-12 13:30:27','2019-03-12 13:30:27'),('1105340261958963201','2019-03-31',0,179,135,199,'2019-03-12 13:30:29','2019-03-12 13:30:29'),('1105372743634898945','2019-01-06',0,113,143,148,'2019-03-12 15:39:34','2019-03-12 15:39:34'),('1105372754380705793','2019-01-07',0,173,158,153,'2019-03-12 15:39:36','2019-03-12 15:39:36'),('1105372762526044162','2019-01-08',0,135,199,131,'2019-03-12 15:39:38','2019-03-12 15:39:38'),('1105372771229224961','2019-01-09',0,161,107,162,'2019-03-12 15:39:40','2019-03-12 15:39:40'),('1105372780922261505','2019-01-10',0,182,196,135,'2019-03-12 15:39:42','2019-03-12 15:39:42'),('1105372790103592961','2019-01-11',0,123,194,102,'2019-03-12 15:39:45','2019-03-12 15:39:45'),('1105372798626418689','2019-01-12',0,185,106,180,'2019-03-12 15:39:47','2019-03-12 15:39:47'),('1165','2018-01-01',583,26,236,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1166','2018-01-02',583,26,236,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1167','2018-01-03',584,26,236,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1168','2018-01-04',584,26,237,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1169','2018-01-05',585,26,237,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1170','2018-01-06',585,26,237,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1171','2018-01-07',586,26,237,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1172','2018-01-08',586,26,237,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1173','2018-01-09',587,26,238,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1174','2018-01-10',587,26,238,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1175','2018-01-11',588,27,238,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1176','2018-01-12',588,27,238,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1177','2018-01-13',589,27,238,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1178','2018-01-14',589,27,239,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1179','2018-01-15',590,27,239,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1180','2018-01-16',590,27,239,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1181','2018-01-17',591,27,239,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1182','2018-01-18',591,27,239,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1183','2018-01-19',592,27,240,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1183991737299263490','2019-10-01',0,145,149,153,'2019-10-15 14:23:22','2019-10-15 14:23:22'),('1183999299272904705','2019-10-03',0,125,102,153,'2019-10-15 14:53:25','2019-10-15 14:53:25'),('1183999309477646338','2019-10-04',0,103,194,161,'2019-10-15 14:53:28','2019-10-15 14:53:28'),('1183999318919024642','2019-10-05',0,173,174,147,'2019-10-15 14:53:30','2019-10-15 14:53:30'),('1183999331409661954','2019-10-06',0,129,197,173,'2019-10-15 14:53:33','2019-10-15 14:53:33'),('1183999342897860610','2019-10-07',0,184,125,169,'2019-10-15 14:53:36','2019-10-15 14:53:36'),('1183999351588458498','2019-10-08',0,173,143,138,'2019-10-15 14:53:38','2019-10-15 14:53:38'),('1183999360316805122','2019-10-09',0,161,158,117,'2019-10-15 14:53:40','2019-10-15 14:53:40'),('1183999367480676353','2019-10-10',0,190,166,135,'2019-10-15 14:53:42','2019-10-15 14:53:42'),('1184','2018-01-20',592,27,240,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1184030117693284353','2019-10-11',0,182,199,193,'2019-10-15 16:55:53','2019-10-15 16:55:53'),('1185','2018-01-21',593,27,240,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1185373213064482818','2019-01-19',6,135,126,167,'2019-10-19 09:52:52','2019-10-19 09:52:52'),('1186','2018-01-22',593,27,240,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1186536619937435650','2019-10-02',0,187,183,108,'2019-10-22 14:55:50','2019-10-22 14:55:50'),('1187','2018-01-23',594,27,240,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1188','2018-01-24',594,27,241,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1189','2018-01-25',595,27,241,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1190','2018-01-26',595,27,241,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1191','2018-01-27',596,27,241,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1192','2018-01-28',596,27,241,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1192253597226455042','2019-11-01',0,129,122,167,'2019-11-07 09:33:03','2019-11-07 09:33:03'),('1192253902756335617','2019-11-02',0,170,192,192,'2019-11-07 09:34:16','2019-11-07 09:34:16'),('1193','2018-01-29',597,27,242,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1194','2018-01-30',597,27,242,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1194060032935493633','2019-11-11',0,121,121,122,'2019-11-12 09:11:11','2019-11-12 09:11:11'),('1194060301425475585','2019-11-10',0,155,187,140,'2019-11-12 09:12:15','2019-11-12 09:12:15'),('1195','2018-01-31',598,27,242,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1196','2018-02-01',598,27,242,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1197','2018-02-02',599,27,242,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1198','2018-02-03',599,27,243,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1199','2018-02-04',600,27,243,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1200','2018-02-05',600,27,243,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1201','2018-02-06',601,27,243,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1202','2018-02-07',601,27,243,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1203','2018-02-08',602,27,244,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1204','2018-02-09',602,27,244,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1205','2018-02-10',603,27,244,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1206','2018-02-11',603,27,244,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1207','2018-02-12',604,27,244,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1208','2018-02-13',604,27,245,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1209','2018-02-14',605,27,245,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1210','2018-02-15',605,27,245,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1211','2018-02-16',606,27,245,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1212','2018-02-17',606,27,245,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1213','2018-02-18',607,27,246,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1214','2018-02-19',607,27,246,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1215','2018-02-20',608,27,246,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1216','2018-02-21',608,27,246,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1217','2018-02-22',609,27,246,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1218','2018-02-23',609,27,247,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1219','2018-02-24',610,27,247,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1220','2018-02-25',610,27,247,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1221','2018-02-26',611,27,247,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1222','2018-02-27',611,27,247,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1223','2018-02-28',612,27,248,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1224','2018-03-01',612,27,248,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1225','2018-03-02',613,28,248,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1226','2018-03-03',613,28,248,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1227','2018-03-04',614,28,248,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1228','2018-03-05',614,28,249,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1229','2018-03-06',615,28,249,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1230','2018-03-07',615,28,249,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1231','2018-03-08',616,28,249,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1232','2018-03-09',616,28,249,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1233','2018-03-10',617,28,250,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1234','2018-03-11',617,28,250,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1235','2018-03-12',618,28,250,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1236','2018-03-13',618,28,250,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1237','2018-03-14',619,28,250,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1238','2018-03-15',619,28,251,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1239','2018-03-16',620,28,251,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1240','2018-03-17',620,28,251,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1241','2018-03-18',621,28,251,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1242','2018-03-19',621,28,251,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1243','2018-03-20',622,28,252,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1244','2018-03-21',622,28,252,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1245','2018-03-22',623,28,252,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1246','2018-03-23',623,28,252,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1247','2018-03-24',624,28,252,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1248','2018-03-25',624,28,253,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1249','2018-03-26',625,28,253,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1250','2018-03-27',625,28,253,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1251','2018-03-28',626,28,253,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1252','2018-03-29',626,28,253,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1253','2018-03-30',627,28,254,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1254','2018-03-31',627,28,254,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1255','2018-04-01',628,28,254,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1256','2018-04-02',628,28,254,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1257','2018-04-03',629,28,254,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1258','2018-04-04',629,28,255,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1259','2018-04-05',630,28,255,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1260','2018-04-06',630,28,255,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1261','2018-04-07',631,28,255,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1262','2018-04-08',631,28,255,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1263','2018-04-09',632,28,256,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1264','2018-04-10',632,28,256,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1265','2018-04-11',633,28,256,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1266','2018-04-12',633,28,256,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1267','2018-04-13',634,28,256,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1268','2018-04-14',634,28,257,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1269','2018-04-15',635,28,257,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1270','2018-04-16',635,28,257,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1271','2018-04-17',636,28,257,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1272','2018-04-18',636,28,257,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1273','2018-04-19',637,28,258,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1274','2018-04-20',637,28,258,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1275','2018-04-21',638,29,258,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1276','2018-04-22',638,29,258,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1277','2018-04-23',639,29,258,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1278','2018-04-24',639,29,259,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1279','2018-04-25',640,29,259,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1280','2018-04-26',640,29,259,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1281','2018-04-27',641,29,259,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1282','2018-04-28',641,29,259,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1283','2018-04-29',642,29,260,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1284','2018-04-30',642,29,260,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1285','2018-05-01',643,29,260,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1286','2018-05-02',643,29,260,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1287','2018-05-03',644,29,260,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1288','2018-05-04',644,29,261,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1289','2018-05-05',645,29,261,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1290','2018-05-06',645,29,261,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1291','2018-05-07',646,29,261,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1292','2018-05-08',646,29,261,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1293','2018-05-09',647,29,262,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1294','2018-05-10',647,29,262,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1295','2018-05-11',648,29,262,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1296','2018-05-12',648,29,262,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1297','2018-05-13',649,29,262,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1298','2018-05-14',649,29,263,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1299','2018-05-15',5,29,263,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1300','2018-05-16',650,29,263,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1301','2018-05-17',651,29,263,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1302','2018-05-18',651,29,263,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1303','2018-05-19',652,29,264,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1304','2018-05-20',652,29,264,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1305','2018-05-21',653,29,264,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1306','2018-05-22',1,29,264,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1307','2018-05-23',654,29,264,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1308','2018-05-24',654,29,265,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1309','2018-05-25',1,29,265,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1310','2018-05-26',655,29,265,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1311','2018-05-27',656,29,265,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1312','2018-05-28',656,29,265,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1313','2018-05-29',657,29,266,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1314','2018-05-30',657,29,266,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1315','2018-05-31',658,29,266,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1316','2018-06-01',658,29,266,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1317','2018-06-02',659,29,266,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1318','2018-06-03',659,29,267,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1319','2018-06-04',660,29,267,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1320','2018-06-05',660,29,267,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1321','2018-06-06',661,29,267,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1322','2018-06-07',661,29,267,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1323','2018-06-08',662,29,268,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1324','2018-06-09',662,29,268,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1325','2018-06-10',663,30,268,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1326','2018-06-11',663,30,268,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1327','2018-06-12',664,30,268,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1328','2018-06-13',664,30,269,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1329','2018-06-14',665,30,269,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1330','2018-06-15',665,30,269,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1331','2018-06-16',666,30,269,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1332','2018-06-17',666,30,269,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1333','2018-06-18',667,30,270,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1334','2018-06-19',667,30,270,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1335','2018-06-20',668,30,270,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1336','2018-06-21',668,30,270,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1337','2018-06-22',669,30,270,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1338','2018-06-23',669,30,271,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1339','2018-06-24',670,30,271,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1340','2018-06-25',670,30,271,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1341','2018-06-26',671,30,271,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1342','2018-06-27',671,30,271,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1343','2018-06-28',672,30,272,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1344','2018-06-29',672,30,272,14,'2018-01-25 06:38:19','2019-09-09 12:12:12'),('1345','2018-06-30',673,30,272,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1346','2018-07-01',673,30,272,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1347','2018-07-02',674,30,272,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1348','2018-07-03',674,30,273,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1349','2018-07-04',675,30,273,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1350','2018-07-05',675,30,273,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1351','2018-07-06',676,30,273,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1352','2018-07-07',676,30,273,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1353','2018-07-08',677,30,274,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1354','2018-07-09',677,30,274,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1355','2018-07-10',678,30,274,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1356','2018-07-11',678,30,274,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1357','2018-07-12',679,30,274,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1358','2018-07-13',679,30,275,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1359','2018-07-14',680,30,275,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1360','2018-07-15',680,30,275,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1361','2018-07-16',681,30,275,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1362','2018-07-17',681,30,275,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1363','2018-07-18',682,30,276,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1364','2018-07-19',682,30,276,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1365','2018-07-20',683,30,276,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1366','2018-07-21',683,30,276,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1367','2018-07-22',684,30,276,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1368','2018-07-23',684,30,277,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1369','2018-07-24',685,30,277,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1370','2018-07-25',685,30,277,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1371','2018-07-26',686,30,277,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1372','2018-07-27',686,30,277,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1373','2018-07-28',687,30,278,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1374','2018-07-29',687,30,278,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1375','2018-07-30',688,31,278,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1376','2018-07-31',688,31,278,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1377','2018-08-01',689,31,278,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1378','2018-08-02',689,31,279,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1379','2018-08-03',690,31,279,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1380','2018-08-04',690,31,279,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1381','2018-08-05',691,31,279,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1382','2018-08-06',691,31,279,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1383','2018-08-07',692,31,280,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1384','2018-08-08',692,31,280,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1385','2018-08-09',1,31,280,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1386','2018-08-10',693,31,280,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1387','2018-08-11',694,31,280,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1388','2018-08-12',694,31,281,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1389','2018-08-13',695,31,281,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1390','2018-08-14',695,31,281,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1391','2018-08-15',696,31,281,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1392','2018-08-16',696,31,281,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1393','2018-08-17',697,31,282,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1394','2018-08-18',697,31,282,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1395','2018-08-19',698,31,282,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1396','2018-08-20',698,31,282,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1397','2018-08-21',699,31,282,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1398','2018-08-22',699,31,283,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1399','2018-08-23',700,31,283,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1400','2018-08-24',700,31,283,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1401','2018-08-25',701,31,283,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1402','2018-08-26',701,31,283,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1403','2018-08-27',702,31,284,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1404','2018-08-28',702,31,284,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1405','2018-08-29',703,31,284,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1406','2018-08-30',703,31,284,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1407','2018-08-31',704,31,284,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1408','2018-09-01',1,31,285,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1409','2018-09-02',705,31,285,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1410','2018-09-03',705,31,285,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1411','2018-09-04',706,31,285,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1412','2018-09-05',706,31,285,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1413','2018-09-06',707,31,286,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1414','2018-09-07',707,31,1,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1415','2018-09-08',708,31,1,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1416','2018-09-09',1,31,1,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1417','2018-09-10',1,31,2,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1418','2018-09-11',709,31,287,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1419','2018-09-12',710,31,287,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1420','2018-09-13',710,31,287,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1421','2018-09-14',711,31,287,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1422','2018-09-15',711,31,287,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1423','2018-09-16',712,31,288,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1424','2018-09-17',712,31,288,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1425','2018-09-18',713,32,288,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1426','2018-09-19',713,32,288,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1427','2018-09-20',714,32,288,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1428','2018-09-21',714,32,289,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1429','2018-09-22',715,32,289,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1430','2018-09-23',715,32,289,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1431','2018-09-24',716,32,1,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1432','2018-09-25',716,32,289,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1433','2018-09-26',717,32,290,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1434','2018-09-27',717,32,290,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1435','2018-09-28',718,32,290,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1436','2018-09-29',718,32,1,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1437','2018-09-30',719,32,290,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1438','2018-10-01',719,32,291,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1439','2018-10-02',720,32,291,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1440','2018-10-03',720,32,291,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1441','2018-10-04',721,32,291,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1442','2018-10-05',721,32,291,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1443','2018-10-06',722,32,292,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1444','2018-10-07',722,32,292,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1445','2018-10-08',1,32,292,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1446','2018-10-09',723,32,292,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1447','2018-10-10',724,32,292,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1448','2018-10-11',724,32,293,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1449','2018-10-12',725,32,293,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1450','2018-10-13',725,32,293,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1451','2018-10-14',726,32,4,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1452','2018-10-15',726,32,293,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1453','2018-10-16',727,32,294,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1454','2018-10-17',727,32,294,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1455','2018-10-18',728,32,294,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1456','2018-10-19',728,32,294,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1457','2018-10-20',729,32,294,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1458','2018-10-21',729,32,295,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1459','2018-10-22',730,32,1,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1460','2018-10-23',730,32,295,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1461','2018-10-24',731,32,295,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1462','2018-10-25',731,32,295,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1463','2018-10-26',732,32,296,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1464','2018-10-27',732,32,296,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1465','2018-10-28',733,32,296,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1466','2018-10-29',2,32,3,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1467','2018-10-30',734,32,296,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1468','2018-10-31',734,32,297,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1469','2018-11-01',735,32,297,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1470','2018-11-02',735,32,297,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1471','2018-11-03',1,32,297,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1472','2018-11-04',736,32,1,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1473','2018-11-05',737,32,298,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1474','2018-11-06',737,32,298,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1475','2018-11-07',738,33,298,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1476','2018-11-08',738,33,169,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1477','2018-11-09',1,33,298,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1478','2018-11-10',739,33,78,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1479','2018-11-11',740,33,299,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1480','2018-11-12',740,33,299,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1481','2018-11-13',741,33,299,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1482','2018-11-14',741,33,299,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1483','2018-11-15',742,33,300,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1484','2018-11-16',742,33,35,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1485','2018-11-17',743,33,300,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1486','2018-11-18',743,33,300,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1487','2018-11-19',744,33,300,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1488','2018-11-20',744,33,301,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1489','2018-11-21',745,33,234,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1490','2018-11-22',456,33,301,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1491','2018-11-23',746,33,301,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1492','2018-11-24',746,33,301,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1493','2018-11-25',747,33,302,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1494','2018-11-26',747,4,302,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1495','2018-11-27',748,33,302,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1496','2018-11-28',748,33,36,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1497','2018-11-29',749,33,302,2,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1498','2018-11-30',749,3,303,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1499','2018-12-01',750,33,303,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1500','2018-12-02',234,33,303,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1501','2018-12-03',751,33,303,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1502','2018-12-04',751,33,303,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1503','2018-12-05',752,6,304,33,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1505','2018-12-07',753,33,55,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1506','2018-12-08',753,33,304,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1507','2018-12-09',754,33,304,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1508','2018-12-10',754,1,305,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1509','2018-12-11',755,33,305,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1510','2018-12-12',755,33,305,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1511','2018-12-13',756,33,305,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1512','2018-12-14',366,33,305,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1513','2018-12-15',757,33,66,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1514','2018-12-16',757,33,306,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1515','2018-12-17',758,33,306,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1516','2018-12-18',758,2,306,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1517','2018-12-19',759,33,306,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1518','2018-12-20',564,33,307,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1519','2018-12-21',760,33,307,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1520','2018-12-22',760,33,307,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1521','2018-12-23',761,33,307,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1522','2018-12-24',761,33,307,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1527','2018-12-29',764,34,308,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1528','2018-12-30',764,34,309,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1529','2018-12-31',765,34,309,14,'2018-01-25 06:38:20','2019-09-09 12:12:12'),('1554','2018-01-01',333,34,314,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1555','2018-01-02',778,34,314,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1556','2018-01-03',778,34,314,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1557','2018-01-04',779,34,314,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1558','2018-01-05',779,34,315,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1559','2018-01-06',780,34,315,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1560','2018-01-07',780,34,315,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1561','2018-01-08',781,34,315,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1562','2018-01-09',781,34,315,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1563','2018-01-10',782,34,316,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1564','2018-01-11',782,34,316,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1565','2018-01-12',783,34,316,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1566','2018-01-13',783,34,316,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1567','2018-01-14',784,34,316,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1568','2018-01-15',784,34,317,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1569','2018-01-16',23,34,317,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1570','2018-01-17',785,34,317,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1571','2018-01-18',786,34,317,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1572','2018-01-19',786,34,317,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1573','2018-01-20',787,2,318,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1574','2018-01-21',787,2,318,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1575','2018-01-22',788,1,318,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1576','2018-01-23',788,35,318,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1577','2018-01-24',789,35,318,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1578','2018-01-25',789,1,319,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1579','2018-01-26',790,1,319,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1580','2018-01-27',531,2,319,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1581','2018-01-28',791,2,319,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1582','2018-01-29',791,2,319,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1583','2018-01-30',2,4,2,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1584','2018-01-31',792,35,320,14,'2018-02-02 08:58:31','2019-09-09 12:12:12'),('1586','2018-02-01',793,4,3,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1587','2018-02-02',794,2,1,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1588','2018-02-03',794,1,4,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1589','2018-02-04',795,35,321,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1590','2018-02-05',795,35,321,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1591','2018-02-06',796,35,321,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1592','2018-02-07',796,35,321,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1593','2018-02-08',797,35,322,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1594','2018-02-09',797,35,322,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1595','2018-02-10',99,35,322,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1596','2018-02-11',798,35,322,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1597','2018-02-12',799,35,322,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1598','2018-02-13',799,35,323,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1599','2018-02-14',800,35,323,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1600','2018-02-15',800,35,323,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1601','2018-02-16',89,35,90,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1602','2018-02-17',801,35,323,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1603','2018-02-18',802,23,324,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1604','2018-02-19',802,2,324,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1605','2018-02-20',803,56,324,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1606','2018-02-21',45,35,89,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1607','2018-02-22',804,35,324,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1608','2018-02-23',804,35,325,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1609','2018-02-24',805,1,3,14,'2018-02-25 10:54:34','2019-09-09 12:12:12'),('1610','2018-05-15',0,0,0,7,'2018-05-16 00:25:27','2019-09-09 12:12:12'),('1611','2018-10-01',0,0,0,7,'2018-10-24 16:17:15','2019-09-09 12:12:12'),('1612','2018-10-02',0,0,0,7,'2018-10-24 16:17:15','2019-09-09 12:12:12'),('1613','2018-10-03',0,0,0,7,'2018-10-24 16:17:15','2019-09-09 12:12:12'),('1614','2018-10-04',0,0,0,7,'2018-10-24 16:17:15','2019-09-09 12:12:12'),('1615','2018-10-05',0,0,0,7,'2018-10-24 16:17:15','2019-09-09 12:12:12');

/*Table structure for table `t_order` */

DROP TABLE IF EXISTS `t_order`;

CREATE TABLE `t_order` (
  `id` char(19) NOT NULL DEFAULT '',
  `order_no` varchar(50) NOT NULL DEFAULT '' COMMENT '订单号',
  `course_id` varchar(19) NOT NULL DEFAULT '' COMMENT '课程id',
  `course_title` varchar(100) DEFAULT NULL COMMENT '课程名称',
  `course_cover` varchar(255) DEFAULT NULL COMMENT '课程封面',
  `teacher_name` varchar(20) DEFAULT NULL COMMENT '讲师名称',
  `member_id` varchar(19) NOT NULL DEFAULT '' COMMENT '会员id',
  `nickname` varchar(50) DEFAULT NULL COMMENT '会员昵称',
  `mobile` varchar(11) DEFAULT NULL COMMENT '会员手机',
  `total_fee` decimal(10,2) DEFAULT '1.11' COMMENT '订单金额（元）',
  `pay_type` tinyint(3) DEFAULT NULL COMMENT '支付类型（1：微信 2：支付宝 3：人工补单）',
  `status` tinyint(3) DEFAULT NULL COMMENT '订单状态（0：未支付 1：已支付）',
  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  `zfbuseridcode` varchar(255) DEFAULT NULL COMMENT '用户付款无需输入金额(二维码地址)',
  `wxcode` varchar(255) DEFAULT NULL COMMENT '微信收款码地址',
  `zfbcode` varchar(255) DEFAULT NULL COMMENT '支付宝收款码地址',
  `qrcode` varchar(255) DEFAULT NULL COMMENT '拉起支付宝使用',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_order_no` (`order_no`),
  KEY `idx_course_id` (`course_id`),
  KEY `idx_member_id` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单';

/*Data for the table `t_order` */

insert  into `t_order`(`id`,`order_no`,`course_id`,`course_title`,`course_cover`,`teacher_name`,`member_id`,`nickname`,`mobile`,`total_fee`,`pay_type`,`status`,`is_deleted`,`gmt_create`,`gmt_modified`,`zfbuseridcode`,`wxcode`,`zfbcode`,`qrcode`) values ('1376501552028467201','order-20210329194838-9048','1192252213659774977','JavaSE基础课程','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/7ca2c3887bee44c2b19f4e5d39b124cb.jfif','张思海','1369634113126825985','the star','15238564873','1.11',1,1,0,'2021-03-29 19:48:38','2021-03-29 19:51:25','https://admin.zhanzhangfu.com/common/zfbuserid?zfbuserid=2088622953656086&price=1.10','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/1111/627D49603F4A2BFB0192D0CC915032B4.jpg','http://zyphoto.itluntan.cn/20210329174720','alipayqr://platformapi/startapp?saId=10000007&qrcode=https%3A%2F%2Fqr.alipay.com%2Ffkx17755v0nte6md47owec5'),('1377257171379511297','order-20210331215112-5916','1192252213659774977','JavaSE基础课程','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/7ca2c3887bee44c2b19f4e5d39b124cb.jfif','张思海','1340183806198362113','叶子','13017562157','1.11',1,0,0,'2021-03-31 21:51:12','2021-03-31 21:51:12','https://admin.zhanzhangfu.com/common/zfbuserid?zfbuserid=2088622953656086&price=1.11','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/1111/627D49603F4A2BFB0192D0CC915032B4.jpg','http://zyphoto.itluntan.cn/20210329174720','alipayqr://platformapi/startapp?saId=10000007&qrcode=https%3A%2F%2Fqr.alipay.com%2Ffkx17755v0nte6md47owec5'),('1377257240531005441','order-20210331215128-1212','1192252213659774977','JavaSE基础课程','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/7ca2c3887bee44c2b19f4e5d39b124cb.jfif','张思海','1340183806198362113','叶子','13017562157','1.11',1,0,0,'2021-03-31 21:51:29','2021-03-31 21:51:29','https://admin.zhanzhangfu.com/common/zfbuserid?zfbuserid=2088622953656086&price=1.10','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/1111/627D49603F4A2BFB0192D0CC915032B4.jpg','http://zyphoto.itluntan.cn/20210329174720','alipayqr://platformapi/startapp?saId=10000007&qrcode=https%3A%2F%2Fqr.alipay.com%2Ffkx17755v0nte6md47owec5'),('1377257989612728322','order-20210331215427-4597','1192252213659774977','JavaSE基础课程','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/2021/03/22/7ca2c3887bee44c2b19f4e5d39b124cb.jfif','张思海','1340183806198362113','叶子','13017562157','1.11',1,1,0,'2021-03-31 21:54:27','2021-03-31 21:55:35','https://admin.zhanzhangfu.com/common/zfbuserid?zfbuserid=2088622953656086&price=1.09','https://edu-guli1020.oss-cn-beijing.aliyuncs.com/1111/627D49603F4A2BFB0192D0CC915032B4.jpg','http://zyphoto.itluntan.cn/20210329174720','alipayqr://platformapi/startapp?saId=10000007&qrcode=https%3A%2F%2Fqr.alipay.com%2Ffkx17755v0nte6md47owec5');

/*Table structure for table `t_pay_log` */

DROP TABLE IF EXISTS `t_pay_log`;

CREATE TABLE `t_pay_log` (
  `id` char(19) NOT NULL DEFAULT '',
  `order_no` varchar(100) NOT NULL DEFAULT '' COMMENT '订单号',
  `pay_time` datetime DEFAULT NULL COMMENT '支付完成时间',
  `total_fee` decimal(10,2) DEFAULT '0.01' COMMENT '支付金额（分）',
  `transaction_id` varchar(100) DEFAULT NULL COMMENT '交易流水号',
  `trade_state` char(20) DEFAULT 'WAIT' COMMENT '交易状态\n1. 交易成功 SUCCESS\n2. 等待支付 WAIT \n3. 订单关闭 CLOSE',
  `pay_type` tinyint(3) NOT NULL DEFAULT '0' COMMENT '支付类型（1：微信 2：支付宝 3:人工补单）',
  `attr` text COMMENT '其他属性',
  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='支付日志表';

/*Data for the table `t_pay_log` */

insert  into `t_pay_log`(`id`,`order_no`,`pay_time`,`total_fee`,`transaction_id`,`trade_state`,`pay_type`,`attr`,`is_deleted`,`gmt_create`,`gmt_modified`) values ('1376502252330434562','order-20210329194838-9048','2021-03-29 19:51:25','1.11','45548155-ede5-4272-a8f4-3803292fb84c','SUCCESS',1,'{\"transaction_id\":\"45548155-ede5-4272-a8f4-3803292fb84c\",\"out_trade_no\":\"order-20210329194838-9048\",\"trade_state\":\"SUCCESS\",\"paytype\":\"1\"}',0,'2021-03-29 19:51:25','2021-03-29 19:51:25'),('1377258274783457282','order-20210331215427-4597','2021-03-31 21:55:35','1.11','acdfd8d8-8059-4fef-a8d5-7dd00c9b28d6','SUCCESS',1,'{\"transaction_id\":\"acdfd8d8-8059-4fef-a8d5-7dd00c9b28d6\",\"out_trade_no\":\"order-20210331215427-4597\",\"trade_state\":\"SUCCESS\",\"paytype\":\"1\"}',0,'2021-03-31 21:55:35','2021-03-31 21:55:35');

/*Table structure for table `ucenter_member` */

DROP TABLE IF EXISTS `ucenter_member`;

CREATE TABLE `ucenter_member` (
  `id` char(19) NOT NULL COMMENT '会员id',
  `openid` varchar(128) DEFAULT NULL COMMENT '微信openid',
  `mobile` varchar(11) DEFAULT '' COMMENT '手机号',
  `password` varchar(255) DEFAULT NULL COMMENT '密码',
  `nickname` varchar(50) DEFAULT NULL COMMENT '昵称',
  `sex` tinyint(2) unsigned DEFAULT NULL COMMENT '性别 1 女，2 男',
  `age` tinyint(3) unsigned DEFAULT NULL COMMENT '年龄',
  `avatar` varchar(255) DEFAULT NULL COMMENT '用户头像',
  `sign` varchar(100) DEFAULT NULL COMMENT '用户签名',
  `is_disabled` tinyint(1) NOT NULL DEFAULT '0' COMMENT '是否禁用 1（true）已禁用，  0（false）未禁用',
  `is_deleted` tinyint(1) NOT NULL DEFAULT '0' COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='会员表';

/*Data for the table `ucenter_member` */

insert  into `ucenter_member`(`id`,`openid`,`mobile`,`password`,`nickname`,`sex`,`age`,`avatar`,`sign`,`is_disabled`,`is_deleted`,`gmt_create`,`gmt_modified`) values ('1080736474267144193',NULL,'13700000011','96e79218965eb72c92a549dd5a330112','用户XJtDfaYeKk',1,19,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-02 12:12:45','2019-01-02 12:12:56'),('1080736474355224577',NULL,'13700000002','96e79218965eb72c92a549dd5a330112','用户wUrNkzAPrc',1,27,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-02 12:13:56','2019-01-02 12:14:07'),('1086387099449442306',NULL,'13520191388','96e79218965eb72c92a549dd5a330112','用户XTMUeHDAoj',2,20,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-19 06:17:23','2019-01-19 06:17:23'),('1086387099520745473',NULL,'13520191389','96e79218965eb72c92a549dd5a330112','用户vSdKeDlimn',1,21,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-19 06:17:23','2019-01-19 06:17:23'),('1086387099608825858',NULL,'13520191381','96e79218965eb72c92a549dd5a330112','用户EoyWUVXQoP',1,18,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-19 06:17:23','2019-01-19 06:17:23'),('1086387099701100545',NULL,'13520191382','96e79218965eb72c92a549dd5a330112','用户LcAYbxLNdN',2,24,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-19 06:17:23','2019-01-19 06:17:23'),('1086387099776598018',NULL,'13520191383','96e79218965eb72c92a549dd5a330112','用户dZdjcgltnk',2,25,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-19 06:17:23','2019-01-19 06:17:23'),('1086387099852095490',NULL,'13520191384','96e79218965eb72c92a549dd5a330112','用户wNHGHlxUwX',2,23,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-01-19 06:17:23','2019-01-19 06:17:23'),('1106746895272849410','o1R-t5u2TfEVeVjO9CPGdHPNw-to',NULL,NULL,'檀梵\'',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 10:39:57','2019-03-16 10:39:57'),('1106822699956654081',NULL,NULL,NULL,NULL,NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 15:41:10','2019-03-16 15:41:10'),('1106823035660357634','o1R-t5i4gENwHYRb5lVFy98Z0bdk',NULL,NULL,'GaoSir',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 15:42:30','2019-03-16 15:42:30'),('1106823041599492098',NULL,NULL,NULL,NULL,NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 15:42:32','2019-03-16 15:42:32'),('1106823115788341250','o1R-t5l_3rnbZbn4jWwFdy6Gk6cg',NULL,NULL,'换个网名哇、',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 15:42:49','2019-03-16 15:42:49'),('1106826046730227714','o1R-t5gyxumyBqt0CWcnh0S6Ya1g',NULL,NULL,'我是Helen',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 15:54:28','2019-03-16 15:54:28'),('1106828185829490690','o1R-t5nNlou5lRwBVgGNJFm4rbc4',NULL,NULL,' 虎头',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 16:02:58','2019-03-16 16:02:58'),('1106830599651442689','o1R-t5hZHQB1cbX7HZJsiM727_SA',NULL,NULL,'是吴啊',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 16:12:34','2019-03-16 16:12:34'),('1106830976199278593','o1R-t5meKOoyEJ3-IhWRCBKFcvzU',NULL,NULL,'我才是Helen',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 16:14:03','2019-03-16 16:14:03'),('1106831936900415490','o1R-t5jXYSWakGtnUBnKbfVT5Iok',NULL,NULL,'文若姬',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 16:17:52','2019-03-16 16:17:52'),('1106832491064442882','o1R-t5sud081Qsa2Vb2xSKgGnf_g',NULL,NULL,'Peanut',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 16:20:04','2019-03-16 16:20:04'),('1106833021442510849','o1R-t5lsGc3I8P5bDpHj7m_AIRvQ',NULL,NULL,'食物链终结者',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-03-16 16:22:11','2019-03-16 16:22:11'),('1191600824445046786',NULL,'15210078344','96e79218965eb72c92a549dd5a330112','IT妖姬',1,5,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-11-05 14:19:10','2019-11-08 18:04:43'),('1191616288114163713',NULL,'17866603606','96e79218965eb72c92a549dd5a330112','xiaowu',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-11-05 15:20:37','2019-11-05 15:20:37'),('1195187659054329857',NULL,'15010546384','96e79218965eb72c92a549dd5a330112','qy',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2019-11-15 11:51:58','2019-11-15 11:51:58'),('1317433439777918977',NULL,'',NULL,NULL,NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2020-10-17 19:53:03','2020-10-17 19:53:03'),('1328626229761146881','o3_SC514BixVBVH_4_Hu1rW1RZkY','',NULL,'冰蓝',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2020-11-17 17:09:12','2020-11-17 17:09:12'),('1340183806198362113',NULL,'13017562157','827ccb0eea8a706c4c34a16891f84e7b','叶子',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2020-12-19 14:34:53','2020-12-19 14:34:53'),('1369634113126825985',NULL,'15238564873','96e79218965eb72c92a549dd5a330112','the star',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2021-03-10 20:59:53','2021-03-10 20:59:53'),('1371302086447108097','o3_SC51EzntcFcw2Wlkj5m9-OHBo','',NULL,'子鹿羽',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2021-03-15 11:27:49','2021-03-15 11:27:49'),('1375442306159521793',NULL,'19913877509','e10adc3949ba59abbe56e057f20f883e','雨',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2021-03-26 21:39:34','2021-03-26 21:39:34'),('1376364649518149634','o3_SC5-ImQDenPg9yyNT1_qMeHHs','',NULL,'LL',NULL,NULL,'https://office-yezi.oss-cn-beijing.aliyuncs.com/2021/01/05/203edbc0b9b04969a975706291bc1bff.jpg',NULL,0,0,'2021-03-29 10:44:38','2021-03-29 10:44:38');

/*Table structure for table `user_role` */

DROP TABLE IF EXISTS `user_role`;

CREATE TABLE `user_role` (
  `user_role_id` varchar(255) NOT NULL DEFAULT '' COMMENT '主键',
  `user_id` varchar(255) DEFAULT NULL COMMENT '用户主键',
  `role_id` varchar(255) DEFAULT NULL COMMENT '角色ID',
  `user_role_statu` int(11) DEFAULT NULL COMMENT '状态（1可用，0禁用）',
  `gmt_create` datetime DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`user_role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户角色表';

/*Data for the table `user_role` */

insert  into `user_role`(`user_role_id`,`user_id`,`role_id`,`user_role_statu`,`gmt_create`) values ('026b3e4982734663a16876745316c073','0cc70bb29e0541a7a2a261404e7adec5','33c2da41f6ec46459cf0f4c41d32c4e3',1,'2021-01-05 21:00:00');

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
